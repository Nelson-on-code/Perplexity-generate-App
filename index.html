<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADHD Focus Helper Pro Max</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-primary: #141b27;
            --bg-secondary: #1f2b3a;
            --text-primary: #e8eef7;
            --text-secondary: #8b98ad;
            --accent-blue: #4a90e2;
            --accent-teal: #50c4c4;
            --accent-rose: #d97a93;
            --success: #7ecfc0;
            --warning: #f7d794;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            flex: 1;
        }

        .nav-header {
            margin-top: 60px;
        }

        .home-page {
            display: flex;
            flex-direction: column;
            gap: 30px;
            padding: 40px 20px;
        }

        .home-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .home-header h1 {
            font-size: 2.8em;
            margin-bottom: 10px;
            color: var(--accent-blue);
            text-shadow: 0 2px 10px rgba(74, 144, 226, 0.2);
        }

        .home-header p {
            font-size: 1.1em;
            color: var(--text-secondary);
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .feature-card {
            background: linear-gradient(135deg, rgba(74, 144, 226, 0.1), rgba(80, 196, 196, 0.1));
            border: 1px solid rgba(80, 196, 196, 0.3);
            border-radius: 16px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-teal);
            box-shadow: 0 10px 30px rgba(80, 196, 196, 0.15);
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-teal), var(--accent-rose));
        }

        .feature-number {
            font-size: 2.5em;
            font-weight: bold;
            color: var(--accent-blue);
            margin-bottom: 10px;
            opacity: 0.3;
        }

        .feature-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
            color: var(--accent-teal);
        }

        .feature-card h3 {
            font-size: 1.3em;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .feature-card p {
            color: var(--text-secondary);
            line-height: 1.6;
            font-size: 0.95em;
            margin-bottom: 15px;
        }

        .feature-button {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-teal));
            color: var(--text-primary);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .feature-button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(74, 144, 226, 0.3);
        }

        .handwriting-note {
            background: rgba(217, 122, 147, 0.05);
            border-left: 4px solid var(--accent-rose);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-style: italic;
            color: var(--text-secondary);
            position: relative;
        }

        .handwriting-note::before {
            content: '‚úèÔ∏è';
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 1.5em;
            opacity: 0.3;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(31, 43, 58, 0.5);
            border-radius: 12px;
            border: 1px solid rgba(80, 196, 196, 0.2);
        }

        .nav-header h2 {
            font-size: 1.8em;
            color: var(--accent-blue);
        }

        .nav-back-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--accent-teal);
            color: var(--accent-teal);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .nav-back-btn:hover {
            background: var(--accent-teal);
            color: var(--bg-primary);
        }

        .section {
            background: linear-gradient(135deg, rgba(31, 43, 58, 0.6), rgba(20, 27, 39, 0.6));
            border: 1px solid rgba(80, 196, 196, 0.2);
            padding: 30px;
            margin: 20px 0;
            border-radius: 16px;
            backdrop-filter: blur(10px);
        }

        .section h3 {
            color: var(--accent-teal);
            margin-bottom: 20px;
            font-size: 1.4em;
        }

        .question-group {
            background: rgba(74, 144, 226, 0.08);
            padding: 20px;
            margin: 15px 0;
            border-radius: 12px;
            border-left: 4px solid var(--accent-blue);
        }

        .question-group label {
            display: block;
            color: var(--text-primary);
            margin-bottom: 12px;
            font-weight: 500;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: linear-gradient(to right, var(--accent-blue), var(--accent-teal));
            outline: none;
            cursor: pointer;
        }

        .btn {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-teal));
            color: var(--text-primary);
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 10px 0;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(74, 144, 226, 0.3);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            border: 1px solid var(--accent-teal);
            color: var(--accent-teal);
        }

        .score-card {
            background: linear-gradient(135deg, rgba(80, 196, 196, 0.15), rgba(74, 144, 226, 0.15));
            border: 1px solid rgba(80, 196, 196, 0.3);
            padding: 40px;
            border-radius: 16px;
            text-align: center;
            margin: 20px 0;
        }

        .score-number {
            font-size: 4em;
            font-weight: bold;
            color: var(--accent-teal);
            margin: 20px 0;
        }

        .score-level {
            font-size: 1.5em;
            color: var(--text-primary);
            margin-bottom: 15px;
        }

        .score-advice {
            color: var(--text-secondary);
            line-height: 1.8;
            font-size: 1.05em;
        }

        .emotional-feedback {
            background: linear-gradient(135deg, rgba(217, 122, 147, 0.1), rgba(127, 207, 192, 0.1));
            border-left: 4px solid var(--accent-rose);
            border-right: 4px solid var(--accent-teal);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            line-height: 1.8;
            display: none;
        }

        .emotional-feedback.positive {
            border-left-color: var(--accent-teal);
            border-right-color: var(--accent-teal);
        }

        .emotional-feedback.encouraging {
            border-left-color: var(--accent-rose);
            border-right-color: var(--accent-rose);
        }

        .feedback-icon {
            margin-right: 10px;
            font-size: 1.3em;
        }

        .skill-card {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: var(--text-primary);
            padding: 20px;
            border-radius: 12px;
            margin: 12px 0;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.2);
        }

        .skill-card:hover {
            transform: translateX(5px);
            box-shadow: 0 6px 20px rgba(80, 196, 196, 0.3);
        }

        .skill-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 1.05em;
        }

        .progress-bar {
            background: rgba(80, 196, 196, 0.2);
            height: 12px;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-teal), var(--accent-blue));
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .timer-display {
            text-align: center;
            font-size: 4em;
            font-weight: bold;
            color: var(--accent-teal);
            font-family: 'Courier New', monospace;
            margin: 30px 0;
            text-shadow: 0 2px 10px rgba(80, 196, 196, 0.2);
        }

        .breathing-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-teal), var(--accent-blue));
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(80, 196, 196, 0.2);
            transition: all 0.3s;
        }

        .breathing-circle:hover {
            box-shadow: 0 6px 25px rgba(80, 196, 196, 0.35);
        }

        .breathing-circle.animating {
            animation: breathing 8s ease-in-out infinite;
        }

        @keyframes breathing {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 4px 20px rgba(80, 196, 196, 0.2);
            }
            25% {
                transform: scale(1.1);
            }
            50% {
                transform: scale(1.3);
                box-shadow: 0 8px 30px rgba(80, 196, 196, 0.4);
            }
            75% {
                transform: scale(1.1);
            }
        }

        .breathing-text {
            color: var(--text-primary);
            text-align: center;
            font-size: 1.2em;
            font-weight: 600;
        }

        .xp-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-teal));
            color: var(--text-primary);
            padding: 20px 30px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(74, 144, 226, 0.3);
            animation: slideIn 0.5s ease, slideOut 0.5s ease 2.5s;
            z-index: 1000;
            font-weight: 600;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        .language-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 10px;
            z-index: 999;
        }

        .lang-btn {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-teal));
            color: var(--text-primary);
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .lang-btn.active {
            box-shadow: 0 4px 12px rgba(80, 196, 196, 0.4);
        }

        .lang-btn:not(.active) {
            background: var(--bg-secondary);
            border: 1px solid var(--accent-teal);
            color: var(--accent-teal);
        }

        .top-stats-card {
            background: linear-gradient(135deg, rgba(80, 196, 196, 0.15), rgba(74, 144, 226, 0.15));
            border: 1px solid rgba(80, 196, 196, 0.3);
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 25px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }

        .stat-mini {
            text-align: center;
        }

        .stat-mini-value {
            font-size: 2em;
            font-weight: bold;
            color: var(--accent-teal);
            margin-bottom: 5px;
        }

        .stat-mini-label {
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        .hidden {
            display: none !important;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            border: 1px solid var(--accent-teal);
            border-radius: 16px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            text-align: center;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-content h3 {
            color: var(--accent-teal);
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .modal-content p {
            color: var(--text-primary);
            line-height: 1.8;
            margin: 15px 0;
            font-size: 1.05em;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 30px;
        }

        .modal-buttons button {
            flex: 1;
            max-width: 200px;
        }

        .alarm-selection-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-secondary);
            border: 1px solid var(--accent-teal);
            border-radius: 16px;
            padding: 30px;
            z-index: 2001;
            min-width: 350px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .alarm-selection-modal h3 {
            color: var(--accent-teal);
            margin-bottom: 20px;
            text-align: center;
        }

        .alarm-option {
            background: rgba(80, 196, 196, 0.1);
            border: 1px solid rgba(80, 196, 196, 0.3);
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-primary);
            font-weight: 500;
        }

        .alarm-option:hover {
            background: rgba(80, 196, 196, 0.2);
            border-color: var(--accent-teal);
            transform: translateX(5px);
        }

        .alarm-option.selected {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-teal));
            border-color: var(--accent-teal);
            color: var(--text-primary);
        }

        .task-breakdown-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-secondary);
            border: 1px solid var(--accent-teal);
            border-radius: 16px;
            padding: 30px;
            z-index: 2001;
            min-width: 400px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            max-height: 80vh;
            overflow-y: auto;
        }

        .task-breakdown-modal h3 {
            color: var(--accent-teal);
            margin-bottom: 20px;
            text-align: center;
        }

        .task-step-input {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .task-step-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--accent-teal);
            border-radius: 8px;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .task-step-list {
            background: rgba(74, 144, 226, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            max-height: 250px;
            overflow-y: auto;
        }

        .task-step-item {
            padding: 10px;
            background: rgba(80, 196, 196, 0.1);
            border-radius: 6px;
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--text-primary);
        }

        .task-step-item button {
            padding: 5px 10px;
            font-size: 0.8em;
            margin: 0;
        }

        @media (max-width: 768px) {
            .features-grid {
                grid-template-columns: 1fr;
            }

            .home-header h1 {
                font-size: 2em;
            }

            .timer-display {
                font-size: 3em;
            }

            .task-breakdown-modal {
                min-width: 90%;
            }
        }
    </style>
</head>
<body>
    <!-- Ë™ûË®ÄÂàáÊèõ -->
    <div class="language-toggle">
        <button class="lang-btn active" onclick="switchLanguage('zh')" id="langZh">‰∏≠Êñá</button>
        <button class="lang-btn" onclick="switchLanguage('en')" id="langEn">English</button>
    </div>

    <!-- XP ÈÄöÁü•ÂÆπÂô® -->
    <div id="xpNotificationContainer"></div>

    <!-- ÂçáÁ¥öÂΩàÁ™óÂÆπÂô® -->
    <div id="levelUpModal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(135deg, var(--accent-blue), var(--accent-teal)); padding: 40px; border-radius: 20px; text-align: center; z-index: 2000; box-shadow: 0 20px 60px rgba(0,0,0,0.4);">
        <div style="color: var(--text-primary); font-size: 3em; margin-bottom: 15px;">üéâ</div>
        <div style="color: var(--text-primary); font-size: 2.5em; font-weight: bold; margin-bottom: 10px;" id="levelUpText">ÂçáÁ¥öÂà∞ Lv. 2!</div>
        <div style="color: var(--text-primary); font-size: 1.1em; font-style: italic;" id="levelUpMessage"></div>
    </div>

    <!-- È¨ßÈà¥ÈÅ∏Êìá Modal -->
    <div id="alarmSelectionModal" class="alarm-selection-modal">
        <h3 id="alarmSelectTitle">ÈÅ∏ÊìáÈ¨ßÈà¥ËÅ≤Èü≥</h3>
        <div id="alarmOptionsList"></div>
    </div>

    <!-- ‰ªªÂãôÊãÜÂàÜ Modal -->
    <div id="taskBreakdownModal" class="task-breakdown-modal">
        <h3 id="taskBreakdownTitle">ÊãÜÂàÜ‰ªªÂãô</h3>
        <p style="color: var(--text-secondary); margin-bottom: 15px;" id="taskBreakdownDesc">Â∞áÂ§ß‰ªªÂãôÊãÜÊàêÂ∞èÊ≠•È©ü</p>
        <div class="task-step-input">
            <input type="text" id="newStepInput" placeholder="Ëº∏ÂÖ•Ê≠•È©ü..." style="width: 100%;">
            <button class="btn" onclick="addTaskStep();" style="padding: 10px 15px; margin: 0; width: auto;">‚ûï</button>
        </div>
        <div class="task-step-list" id="taskStepsList"></div>
        <div class="modal-buttons">
            <button class="btn" onclick="confirmTaskBreakdown();" id="confirmTaskBtn">Á¢∫Ë™çÂàÜËß£</button>
            <button class="btn btn-secondary" onclick="closeTaskBreakdown();" id="cancelTaskBtn">ÂèñÊ∂à</button>
        </div>
    </div>

    <!-- Êé•Âú∞Á∑¥Áøí Modal -->
    <div id="groundingModal" class="modal-overlay">
        <div class="modal-content" style="min-width: 400px; text-align: center;">
            <h3 id="groundingTitle">Êé•Âú∞Á∑¥Áøí (5-4-3-2-1)</h3>
            <div id="groundingContent" style="min-height: 150px; display: flex; align-items: center; justify-content: center;">
                <p id="groundingStep" style="font-size: 1.2em; color: var(--accent-teal); font-weight: 600; white-space: pre-line;"></p>
            </div>
            <div class="modal-buttons">
                <button class="btn" id="groundingNextBtn" onclick="nextGroundingStep()">‰∏ã‰∏ÄÊ≠•</button>
            </div>
        </div>
    </div>

    <!-- Ë™çÁü•ÈáçÊßãÁµêÊûú Modal -->
    <div id="cognitiveResultModal" class="modal-overlay">
        <div class="modal-content" style="min-width: 450px; text-align: left;">
            <h3 id="cognitiveResultTitle">Ë™çÁü•ÈáçÊßãÁ∑¥Áøí</h3>
            <div id="cognitiveResultBody" style="background: rgba(74, 144, 226, 0.1); padding: 20px; border-radius: 8px; margin: 20px 0;"></div>
            <div class="modal-buttons">
                <button class="btn" onclick="closeCognitiveResultModal()">ÂÆåÊàê</button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- ========== È¶ñÈ†Å ========== -->
        <div id="homePage" class="page active">
            <div class="home-page">
                <div class="home-header">
                    <h1>üß† ADHD Focus Helper Pro Max</h1>
                    <p style="font-size: 0.9em; color: var(--text-secondary); margin-bottom: 15px;">ADHD Â∞àÊ≥®Â∞èÂä©Êâã Pro Max</p>
                    <p id="headerSubtitle">Áî®Ê∫´ÊöñÁöÑÈô™‰º¥ÔºåÊâìÈÄ†Â±¨Êñº‰Ω†ÁöÑÂ∞àÊ≥®ÁØÄÂ•è</p>
                </div>

                <!-- ÈÄ≤Â∫¶ËøΩËπ§Âç°Áâá -->
                <div class="top-stats-card">
                    <div class="stat-mini">
                        <div class="stat-mini-value" id="topLevel">Lv. 1</div>
                        <div class="stat-mini-label" id="levelLabel">Level</div>
                    </div>
                    <div class="stat-mini">
                        <div class="stat-mini-value" id="topXp">0</div>
                        <div class="stat-mini-label" id="xpLabel">XP</div>
                    </div>
                    <div class="stat-mini">
                        <div class="stat-mini-value" id="topStreak">0</div>
                        <div class="stat-mini-label" id="streakLabel">Consecutive Days</div>
                    </div>
                    <div class="stat-mini">
                        <div class="stat-mini-value" id="topMinutes">0</div>
                        <div class="stat-mini-label" id="minutesLabel">Breathing Minutes</div>
                    </div>
                </div>

                <div class="handwriting-note">
                    <span id="usageNote">‚úçÔ∏è Tips: Use from top to bottom for best results. Each tool is customized for you.</span>
                </div>

                <div class="features-grid" id="featuresGrid">
                    <!-- 1. Âø´ÈÄüË©ï‰º∞ -->
                    <div class="feature-card" onclick="goToPage('assessmentPage')">
                        <div class="feature-number">1Ô∏è‚É£</div>
                        <div class="feature-icon">üìã</div>
                        <h3 id="f1Title">Quick Assessment</h3>
                        <p id="f1Desc">Understand your focus state today. 10 simple questions help you know your rhythm.</p>
                        <button class="feature-button" id="f1Btn">Start Assessment ‚Üí</button>
                    </div>

                    <!-- 2. ËÉΩÈáèÊ™¢Ê∏¨ -->
                    <div class="feature-card" onclick="goToPage('energyPage')">
                        <div class="feature-number">2Ô∏è‚É£</div>
                        <div class="feature-icon">‚ö°</div>
                        <h3 id="f2Title">Energy Check</h3>
                        <p id="f2Desc">Choose your energy level, get task recommendations. Thoughtful workload arrangement.</p>
                        <button class="feature-button" id="f2Btn">Check Energy ‚Üí</button>
                    </div>

                    <!-- 3. Êó•Á®ãÂÆâÊéí -->
                    <div class="feature-card" onclick="goToPage('routinePage')">
                        <div class="feature-number">3Ô∏è‚É£</div>
                        <div class="feature-icon">üìÖ</div>
                        <h3 id="f3Title">Daily Rituals</h3>
                        <p id="f3Desc">Morning and evening gentle rituals. Build sustainable rhythm, one step at a time.</p>
                        <button class="feature-button" id="f3Btn">Build Habits ‚Üí</button>
                    </div>

                    <!-- 4. ‰ªªÂãôÁÆ°ÁêÜ -->
                    <div class="feature-card" onclick="goToPage('taskPage')">
                        <div class="feature-number">4Ô∏è‚É£</div>
                        <div class="feature-icon">‚úÖ</div>
                        <h3 id="f4Title">Task Management</h3>
                        <p id="f4Desc">Break big tasks into small steps. Every check is your victory.</p>
                        <button class="feature-button" id="f4Btn">Manage Tasks ‚Üí</button>
                    </div>

                    <!-- 5. Áï™ËåÑÈêò -->
                    <div class="feature-card" onclick="goToPage('timerPage')">
                        <div class="feature-number">5Ô∏è‚É£</div>
                        <div class="feature-icon">‚è±Ô∏è</div>
                        <h3 id="f5Title">Pomodoro Timer</h3>
                        <p id="f5Desc">Customizable focused time. Every second accumulates your achievements.</p>
                        <button class="feature-button" id="f5Btn">Start Timer ‚Üí</button>
                    </div>

                    <!-- 6. ÁôÇÁôíÂ∑•ÂÖ∑ -->
                    <div class="feature-card" onclick="goToPage('healingPage')">
                        <div class="feature-number">6Ô∏è‚É£</div>
                        <div class="feature-icon">üßò</div>
                        <h3 id="f6Title">Healing Tools</h3>
                        <p id="f6Desc">Mindful breathing, cognitive restructuring, grounding. Give yourself a hug when anxious.</p>
                        <button class="feature-button" id="f6Btn">Find Calm ‚Üí</button>
                    </div>

                    <!-- 7. ÊÉÖÁ∑íÊó•Ë™å -->
                    <div class="feature-card" onclick="goToPage('emotionPage')">
                        <div class="feature-number">7Ô∏è‚É£</div>
                        <div class="feature-icon">üí≠</div>
                        <h3 id="f7Title">Emotion Journal</h3>
                        <p id="f7Desc">Record every moment of emotion. Understanding yourself leads to better self-care.</p>
                        <button class="feature-button" id="f7Btn">Record Emotion ‚Üí</button>
                    </div>

                    <!-- 8. È£≤È£üÂª∫Ë≠∞ -->
                    <div class="feature-card" onclick="goToPage('nutritionPage')">
                        <div class="feature-number">8Ô∏è‚É£</div>
                        <div class="feature-icon">ü•ó</div>
                        <h3 id="f8Title">Nutrition Advice</h3>
                        <p id="f8Desc">Nutrition plan tailored for ADHD. Right diet boosts focus and mood stability.</p>
                        <button class="feature-button" id="f8Btn">Learn Nutrition ‚Üí</button>
                    </div>
                </div>

                <div class="handwriting-note">
                    üí° <span id="tipsNote">No need to complete everything at once. Choose the tools that help you most, start with small steps. Every choice is self-love.</span>
                </div>
            </div>
        </div>

        <!-- ========== Ë©ï‰º∞È†ÅÈù¢ ========== -->
        <div id="assessmentPage" class="page">
            <div class="nav-header" style="margin-top: 80px;">
                <h2>üìã <span id="assessTitle">Quick Assessment</span></h2>
                <button class="nav-back-btn" onclick="backToHomeFrom('assessmentPage')">‚Üê <span id="backBtn">Back to Home</span></button>
            </div>

            <div class="section">
                <h3 id="assessDesc1">Understand your focus state</h3>
                <p style="color: var(--text-secondary); margin-bottom: 20px;" id="assessDesc2">No perfect answers, only the real you. This assessment helps us understand your rhythm.</p>

                <div id="assessmentQuestions"></div>

                <button class="btn" id="submitAssessmentBtn" onclick="submitAssessment();" style="margin-bottom: 20px;">Submit Assessment</button>
            </div>

            <!-- Ë©ï‰º∞ÁµêÊûúÈ°ØÁ§∫ÂçÄ -->
            <div id="assessmentResult" class="hidden"></div>

            <!-- Ë©ï‰º∞Â∞àÁî®ÔºöÊåÅ‰πÖÈ°ØÁ§∫ÈºìÂãµË®äÊÅØ -->
            <div class="emotional-feedback positive" id="assessmentEmotionalMessage" style="display: none;">
                <span class="feedback-icon">‚ú®</span>
                <span id="assessmentEmotionalText"></span>
            </div>

            <!-- ÂÖ±Áî®ÊÉÖÁ∑íË®äÊÅØÔºàÂÖ∂‰ªñÂäüËÉΩÁî®Ôºâ -->
            <div class="emotional-feedback positive" id="emotionalMessage" style="display: none;">
                <span class="feedback-icon">‚ú®</span>
                <span id="emotionalText"></span>
            </div>

            <!-- Ë©ï‰º∞Â†±ÂëäÔºàÂÖ®ÈÉ®Ê≠∑Âè≤ + ÂèØÂà™Èô§Ôºâ -->
            <div class="section" id="assessmentReportSection" style="display: none; margin-top: 30px;">
                <h3 id="reportTitle">üìÑ Assessment Report</h3>
                <p style="color: var(--text-secondary); margin-bottom: 15px;" id="reportTime">Assessment Time: </p>
                <div id="reportContent" style="background: rgba(74, 144, 226, 0.08); padding: 15px; border-radius: 8px; margin: 15px 0;"></div>

                <h3 style="margin-top:25px; font-size:1.2em;">Assessment History</h3>
                <div id="assessmentHistoryList" style="margin-top:10px;"></div>
                
                <div style="background: rgba(217, 122, 147, 0.1); border-left: 4px solid var(--accent-rose); padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <p style="color: var(--text-secondary); font-size: 0.9em; margin: 0;" id="emailWarning">‚ö†Ô∏è Important: All records are stored only on this device. To save a report copy via email, enter your email address. The system will open your mail app where you can send or copy to clipboard.</p>
                </div>

                <div style="display: flex; gap: 10px; margin: 15px 0;">
                    <input type="email" id="emailInput" placeholder="Enter your email" style="flex: 1; padding: 12px; border: 1px solid var(--accent-teal); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary);">
                    <button class="btn" onclick="sendReportToEmail();">üìß Send Report</button>
                </div>

                <button class="nav-back-btn" onclick="backToHomeFrom('assessmentPage')" style="width: 100%; text-align: center; margin: 20px 0;">‚Üê <span id="bottomBackBtn">Back to Home</span></button>
            </div>
        </div>

        <!-- ========== ËÉΩÈáèÊ™¢Ê∏¨È†ÅÈù¢ ========== -->
        <div id="energyPage" class="page">
            <div class="nav-header" style="margin-top: 80px;">
                <h2>‚ö° <span id="energyTitle">Energy Check</span></h2>
                <button class="nav-back-btn" onclick="backToHomeFrom('energyPage')">‚Üê <span id="backBtn2">Back to Home</span></button>
            </div>

            <div class="section">
                <h3 id="energyQuestion">What's your energy level right now?</h3>
                <p style="color: var(--text-secondary); margin-bottom: 20px;" id="energyDesc">Based on your energy, we recommend suitable task difficulty.</p>

                <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin: 30px 0;">
                    <div style="text-align: center;">
                        <button class="btn energy-btn" id="energyBtn1" onclick="setEnergy(1)" style="width: 100%; padding: 20px; transition: all 0.3s ease;">üî¥<br><span id="energyLabel1">Very Low</span></button>
                    </div>
                    <div style="text-align: center;">
                        <button class="btn btn-secondary energy-btn" id="energyBtn2" onclick="setEnergy(2)" style="width: 100%; padding: 20px; transition: all 0.3s ease;">üü°<br><span id="energyLabel2">Low</span></button>
                    </div>
                    <div style="text-align: center;">
                        <button class="btn btn-secondary energy-btn" id="energyBtn3" onclick="setEnergy(3)" style="width: 100%; padding: 20px; transition: all 0.3s ease;">üü¢<br><span id="energyLabel3">Medium</span></button>
                    </div>
                    <div style="text-align: center;">
                        <button class="btn btn-secondary energy-btn" id="energyBtn4" onclick="setEnergy(4)" style="width: 100%; padding: 20px; transition: all 0.3s ease;">üíö<br><span id="energyLabel4">Sufficient</span></button>
                    </div>
                    <div style="text-align: center;">
                        <button class="btn btn-secondary energy-btn" id="energyBtn5" onclick="setEnergy(5)" style="width: 100%; padding: 20px; transition: all 0.3s ease;">‚ú®<br><span id="energyLabel5">Peak</span></button>
                    </div>
                </div>

                <div id="energyRecommendation" class="skill-card" style="display: none;"></div>
            </div>

            <button class="nav-back-btn" onclick="backToHomeFrom('energyPage')" style="width: 100%; text-align: center; margin: 20px 0;">‚Üê <span id="bottomBackBtn2">Back to Home</span></button>
        </div>

        <!-- ========== Êó•Á®ãÂÆâÊéíÈ†ÅÈù¢ ========== -->
        <div id="routinePage" class="page">
            <div class="nav-header">
                <h2>üìÖ <span id="routineTitle">Daily Rituals</span></h2>
                <button class="nav-back-btn" onclick="backToHomeFrom('routinePage')">‚Üê <span id="backBtn3">Back to Home</span></button>
            </div>

            <div class="section">
                <h3>üåÖ <span id="morningLabel">Morning Ritual</span></h3>
                <p style="color: var(--text-secondary); margin-bottom: 15px;" id="morningDesc">Gently start your day</p>
                <div id="morningRoutine"></div>

                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <input type="text" id="newMorningInput" placeholder="Add a morning ritual..." style="flex: 1; padding: 10px; border: 1px solid var(--accent-teal); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary); font-size: 0.9em;">
                    <button class="btn" onclick="addMorningRoutine();" style="padding: 10px 15px; margin: 0; font-size: 0.9em;">‚ûï</button>
                </div>
            </div>

            <div class="section">
                <h3>üåô <span id="eveningLabel">Evening Ritual</span></h3>
                <p style="color: var(--text-secondary); margin-bottom: 15px;" id="eveningDesc">Gently guide you into night</p>
                <div id="eveningRoutine"></div>

                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <input type="text" id="newEveningInput" placeholder="Add an evening ritual..." style="flex: 1; padding: 10px; border: 1px solid var(--accent-teal); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary); font-size: 0.9em;">
                    <button class="btn" onclick="addEveningRoutine();" style="padding: 10px 15px; margin: 0; font-size: 0.9em;">‚ûï</button>
                </div>
            </div>

            <div class="emotional-feedback encouraging" id="routineMessage">
                <span class="feedback-icon">üíú</span>
                <span id="routineMessageText">These aren't tasks, they're dates with yourself. Every step cares for you.</span>
            </div>

            <button class="nav-back-btn" onclick="backToHomeFrom('routinePage')" style="width: 100%; text-align: center; margin: 20px 0;">‚Üê <span id="bottomBackBtn3">Back to Home</span></button>
        </div>

        <!-- ========== ‰ªªÂãôÁÆ°ÁêÜÈ†ÅÈù¢ ========== -->
        <div id="taskPage" class="page">
            <div class="nav-header">
                <h2>‚úÖ <span id="taskTitle">Task Management</span></h2>
                <button class="nav-back-btn" onclick="backToHomeFrom('taskPage')">‚Üê <span id="backBtn4">Back to Home</span></button>
            </div>

            <div class="section">
                <h3 id="taskDesc1">Break big goals into small steps</h3>
                <div style="display: flex; gap: 10px; margin: 20px 0;">
                    <input type="text" id="newTaskInput" placeholder="Example: Complete report, learn new skills..." style="flex: 1; padding: 12px; border: 1px solid var(--accent-teal); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary);">
                    <button class="btn" onclick="addTask();" style="margin: 0;">Add</button>
                    <button class="btn btn-secondary" id="breakdownTaskBtn" onclick="openTaskBreakdown();" style="margin: 0;">üìä Breakdown</button>
                </div>

                <div id="taskList"></div>
                <div class="progress-bar">
                    <div class="progress-fill" id="taskProgress" style="width: 0%;"></div>
                </div>
            </div>

            <div class="emotional-feedback positive" id="taskFeedback" style="display: none;">
                <span class="feedback-icon">üéâ</span>
                <span id="taskFeedbackText"></span>
            </div>

            <button class="nav-back-btn" onclick="backToHomeFrom('taskPage')" style="width: 100%; text-align: center; margin: 20px 0;">‚Üê <span id="bottomBackBtn4">Back to Home</span></button>
        </div>

        <!-- ========== Áï™ËåÑÈêòÈ†ÅÈù¢ ========== -->
        <div id="timerPage" class="page">
            <div class="nav-header">
                <h2>‚è±Ô∏è <span id="timerTitle">Pomodoro Timer</span></h2>
                <button class="nav-back-btn" onclick="backToHomeFrom('timerPage')">‚Üê <span id="backBtn5">Back to Home</span></button>
            </div>

            <div class="section">
                <h3 id="timerDesc1">Customizable focused time</h3>
                
                <div style="display: flex; gap: 12px; margin: 20px 0; align-items: center; justify-content: center; flex-wrap: wrap;">
                    <label style="color: var(--text-secondary);" id="timerMinLabel">Minutes:</label>
                    <input type="number" id="timerMinutes" min="1" max="60" value="25" style="width: 80px; padding: 10px; border: 1px solid var(--accent-teal); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary); text-align: center; font-size: 1em; font-weight: bold;">
                    <button class="btn btn-secondary" onclick="resetTimerInput();" style="padding: 10px 15px; margin: 0;" id="resetTimerBtn">Reset</button>
                    <button class="btn btn-secondary" onclick="openAlarmSelection();" style="padding: 10px 15px; margin: 0;">üîî Alarm</button>
                    <button class="btn btn-secondary" onclick="testAlarmSound();" style="padding: 10px 15px; margin: 0;">üîä Test</button>
                    <input type="range" id="volumeSlider" min="0" max="100" value="70" style="width: 100px; margin: 0 10px;">
                </div>

                <div class="timer-display" id="timerDisplay">25:00</div>
                <div style="text-align: center; margin: 30px 0;">
                    <button class="btn" id="startTimerBtn" onclick="startTimer();">Start Timer</button>
                    <button class="btn btn-secondary hidden" id="stopTimerBtn" onclick="stopTimer();">Stop Timer</button>
                </div>

                <div class="progress-bar">
                    <div class="progress-fill" id="timerProgress" style="width: 0%;"></div>
                </div>

                <div id="timerMessage" style="display: none; margin-top: 20px;"></div>
            </div>

            <button class="nav-back-btn" onclick="backToHomeFrom('timerPage')" style="width: 100%; text-align: center; margin: 20px 0;">‚Üê <span id="bottomBackBtn5">Back to Home</span></button>
        </div>

        <!-- ========== ÁôÇÁôíÂ∑•ÂÖ∑È†ÅÈù¢ ========== -->
        <div id="healingPage" class="page">
            <div class="nav-header" style="margin-top: 80px;">
                <h2>üßò <span id="healingTitle">Healing Tools</span></h2>
                <button class="nav-back-btn" onclick="backToHomeFrom('healingPage')">‚Üê <span id="backBtn6">Back to Home</span></button>
            </div>

            <div class="section">
                <h3 id="breathingTitle">Mindful Breathing</h3>
                <p style="color: var(--text-secondary); margin-bottom: 20px;" id="breathingDesc">When anxious, breathing is the best comfort. Visualize your breathing cycle to regulate your nervous system and reduce stress.</p>
                <div style="text-align: center; margin: 40px 0;">
                    <div id="breathingCircle" class="breathing-circle" onclick="toggleBreathing();">
                        <div class="breathing-text" id="breathText">Click to Start<br>Breathing</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3 id="cognitiveTitle">Cognitive Restructuring</h3>
                <p style="color: var(--text-secondary); margin-bottom: 15px;" id="cognitiveDesc">Transform negative thoughts into strength.</p>
                <p style="color: var(--text-secondary); margin-bottom: 15px; font-size: 0.9em;" id="cognitiveScience">üß† Scientific Basis: Cognitive restructuring is core to CBT. Research shows that identifying and challenging inaccurate beliefs significantly improves anxiety, depression, and overthinking. This practice helps break negative thought cycles and build healthier mental patterns.</p>
                <button class="btn" onclick="openCognitiveRestructuring();" id="cognitiveBtn">Start Practice</button>
            </div>

            <div class="section">
                <h3 id="groundingTitle">Grounding (5-4-3-2-1)</h3>
                <p style="color: var(--text-secondary); margin-bottom: 15px;" id="groundingDesc">Feel the present, return to now.</p>
                <p style="color: var(--text-secondary); margin-bottom: 15px; font-size: 0.9em;" id="groundingScience">üß† Scientific Basis: The 5-4-3-2-1 grounding technique is a sensory redirection method that activates your parasympathetic nervous system through five senses, counteracting anxiety-induced fight-or-flight response. This technique helps return you to the present within seconds.</p>
                <button class="btn" onclick="startGrounding();" id="groundingBtn">Start Grounding</button>
            </div>

            <button class="nav-back-btn" onclick="backToHomeFrom('healingPage')" style="width: 100%; text-align: center; margin: 20px 0;">‚Üê <span id="bottomBackBtn6">Back to Home</span></button>
        </div>

        <!-- ========== ÊÉÖÁ∑íÊó•Ë™åÈ†ÅÈù¢ ========== -->
        <div id="emotionPage" class="page">
            <div class="nav-header">
                <h2>üí≠ <span id="emotionTitle">Emotion Journal</span></h2>
                <button class="nav-back-btn" onclick="backToHomeFrom('emotionPage')">‚Üê <span id="backBtn7">Back to Home</span></button>
            </div>

            <div class="section">
                <h3 id="emotionLogTitle">Record your current emotion</h3>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin: 20px 0;">
                    <button class="btn" onclick="logEmotion('happy');" id="emotionBtn1">üòä Happy</button>
                    <button class="btn" onclick="logEmotion('calm');" id="emotionBtn2">üòå Calm</button>
                    <button class="btn" onclick="logEmotion('sad');" id="emotionBtn3">üò¢ Sad</button>
                    <button class="btn" onclick="logEmotion('anxious');" id="emotionBtn4">üò∞ Anxious</button>
                </div>

                <div id="emotionLog" style="margin-top: 30px;"></div>
            </div>

            <div class="section" id="emotionReportSection" style="margin-top: 30px;">
                <h3 id="emotionReportTitle">üìä Complete Report</h3>
                <p style="color: var(--text-secondary); margin-bottom: 15px;" id="emotionReportDesc">Send complete report with all achievements to your email</p>
                
                <div style="display: flex; gap: 10px; margin: 15px 0;">
                    <input type="email" id="emotionEmailInput" placeholder="Enter your email" style="flex: 1; padding: 12px; border: 1px solid var(--accent-teal); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary);">
                    <button class="btn" onclick="sendCompletedReportToEmail();">üìß Send Report</button>
                </div>
            </div>

            <button class="nav-back-btn" onclick="backToHomeFrom('emotionPage')" style="width: 100%; text-align: center; margin: 20px 0;">‚Üê <span id="bottomBackBtn7">Back to Home</span></button>
        </div>

        <!-- ========== È£≤È£üÂª∫Ë≠∞È†ÅÈù¢ ========== -->
        <div id="nutritionPage" class="page">
            <div class="nav-header" style="margin-top: 80px;">
                <h2>ü•ó <span id="nutritionTitle">Nutrition Advice</span></h2>
                <button class="nav-back-btn" onclick="backToHomeFrom('nutritionPage')">‚Üê <span id="backBtn8">Back to Home</span></button>
            </div>

            <div class="section">
                <h3 id="nutritionDesc">Nutrition plan tailored for ADHD</h3>
                <p style="color: var(--text-secondary); margin-bottom: 20px;" id="nutritionIntro">Based on 2026 latest US dietary guidelines, these nutrition tips help improve focus and emotional stability.</p>
            </div>

            <div class="section">
                <h3 id="nutritionSection1">üß† Priority Nutrients</h3>
                <div id="nutritionPriority"></div>
            </div>

            <div class="section">
                <h3 id="nutritionSection2">üçΩÔ∏è Eating Order Recommendation</h3>
                <p style="color: var(--text-secondary); margin-bottom: 15px;" id="eatingOrderDesc">Combat blood sugar crashes, stabilize glucose:</p>
                <div id="eatingOrder"></div>
            </div>

            <div class="section">
                <h3 id="nutritionSection3">‚ùå Foods to Avoid</h3>
                <div id="nutritionAvoid"></div>
            </div>

            <div class="emotional-feedback positive">
                <span class="feedback-icon">üíö</span>
                <span id="nutritionMessage">Proper nutrition is the first step to self-care. Every nutrition choice helps you focus.</span>
            </div>

            <button class="nav-back-btn" onclick="backToHomeFrom('nutritionPage')" style="width: 100%; text-align: center; margin: 20px 0;">‚Üê <span id="bottomBackBtn8">Back to Home</span></button>
        </div>
    </div>

    <script>
        // ========== ÈÖçÁΩÆ ==========
        const emotionalMessages = {
            assessment: [
                "‚ú® Today's state is a bit distracted, but this is common, doesn't mean you're not trying hard enough",
                "üåü You just completed something difficult, even just 10 minutes counts as moving forward",
                "üí´ Day 1, I'm here with you",
                "üåà Today's not perfect, and that's okay"
            ],
            completion: [
                "üéâ You did it! This is what growth looks like",
                "‚ú® Every check is your victory",
                "üíö You're taking care of yourself, that's important",
                "üåü Today's you is stronger than yesterday's you"
            ],
            levelUp: [
                "üåü You leveled up! Every step is progress",
                "üöÄ Congratulations! Your persistence is shining",
                "üí´ Awesome! You're getting stronger",
                "‚ú® Level up! You did great"
            ]
        };

        // ‰∏≠Ëã±ÊñáÁøªË≠Ø
        const translations = {
            zh: {
                levelLabel: "Á≠âÁ¥ö",
                xpLabel: "XP",
                streakLabel: "ÈÄ£Á∫åÊàêÂäüÊó•",
                minutesLabel: "Á∏ΩÊ≠£ÂøµÂëºÂê∏ÂàÜÈêòÊï∏",
                headerSubtitle: "Áî®Ê∫´ÊöñÁöÑÈô™‰º¥ÔºåÊâìÈÄ†Â±¨Êñº‰Ω†ÁöÑÂ∞àÊ≥®ÁØÄÂ•è",
                usageNote: "‚úçÔ∏è ‰ΩøÁî®Âª∫Ë≠∞ÔºöÂæû‰∏äÂà∞‰∏ã‰æùÂ∫è‰ΩøÁî®ÊïàÊûúÊúÄ‰Ω≥„ÄÇÊØèÂÄãÂ∑•ÂÖ∑ÈÉΩÊòØÁÇ∫‰Ω†ÈáèË∫´ÊâìÈÄ†ÁöÑÈô™‰º¥ËÄÖ„ÄÇ",
                tipsNote: "Â∞èË≤ºÂ£´Ôºö‰∏çÈúÄË¶Å‰∏ÄÊ¨°ÂÖ®ÈÉ®ÂÆåÊàê„ÄÇÈÅ∏ÊìáÂ∞ç‰Ω†ÊúÄÊúâÂπ´Âä©ÁöÑÂ∑•ÂÖ∑ÔºåÂæûÂ∞èÊ≠•È©üÈñãÂßã„ÄÇÊØè‰∏ÄÂÄãÈÅ∏ÊìáÈÉΩÊòØÂ∞çËá™Â∑±ÁöÑÊÑõ„ÄÇ",
                f1Title: "Âø´ÈÄüË©ï‰º∞", f1Desc: "‰∫ÜËß£‰ªäÂ§©ÁöÑÂ∞àÊ≥®ÁãÄÊÖã„ÄÇ10ÈÅìÁ∞°ÂñÆÂïèÈ°åÔºåÂπ´Âä©‰Ω†Ë™çË≠òËá™Â∑±ÁöÑÁØÄÂ•è„ÄÇ", f1Btn: "ÈñãÂßãË©ï‰º∞ ‚Üí",
                f2Title: "ËÉΩÈáèÊ™¢Ê∏¨", f2Desc: "ÈÅ∏Êìá‰Ω†ÁöÑËÉΩÈáèÁãÄÊÖãÔºåÁ≥ªÁµ±Êé®Ëñ¶ÂêàÈÅ©ÁöÑ‰ªªÂãôÈõ£Â∫¶„ÄÇË≤ºÂøÉÁöÑÂ∑•‰ΩúË≤†ËºâÂÆâÊéí„ÄÇ", f2Btn: "Ê™¢Ê∏¨ËÉΩÈáè ‚Üí",
                f3Title: "ÊØèÊó•Â∞è‰∫ã", f3Desc: "Êó©Êô®ÂíåÂÇçÊôöÁöÑÊ∫´ÂíåÂÑÄÂºè„ÄÇÂª∫Á´ãÂèØÊåÅÁ∫åÁöÑÁØÄÂ•èÔºå‰∏ÄÊ≠•‰∏ÄÊ≠•ÈÇÅÂêëÁõÆÊ®ô„ÄÇ", f3Btn: "Âª∫Á´ãÁøíÊÖ£ ‚Üí",
                f4Title: "‰ªªÂãôÁÆ°ÁêÜ", f4Desc: "ÊääÂ§ß‰ªªÂãôÊãÜÊàêÂ∞èÊ≠•È©ü„ÄÇÊØèÂÄãÂãæÈÅ∏ÈÉΩÊòØ‰Ω†ÁöÑÂãùÂà©„ÄÇ", f4Btn: "ÁÆ°ÁêÜ‰ªªÂãô ‚Üí",
                f5Title: "Áï™ËåÑÈêò", f5Desc: "Ëá™Ë®ÇÊôÇÈñìÁöÑÂ∞àÊ≥®ÊôÇÂÖâ„ÄÇÊØè‰∏ÄÁßíÈÉΩÂú®Á¥ØÁ©ç‰Ω†ÁöÑÊàêÂ∞±„ÄÇ", f5Btn: "ÈñãÂßãË®àÊôÇ ‚Üí",
                f6Title: "ÁôÇÁôíÂ∑•ÂÖ∑", f6Desc: "Ê≠£ÂøµÂëºÂê∏„ÄÅË™çÁü•ÈáçÊßã„ÄÅÊé•Âú∞Á∑¥Áøí„ÄÇÂú®ÁÑ¶ÊÖÆÊôÇÔºåÁµ¶Ëá™Â∑±‰∏ÄÂÄãÊìÅÊä±„ÄÇ", f6Btn: "ÊâæÂõûÂπ≥Èùú ‚Üí",
                f7Title: "ÊÉÖÁ∑íÊó•Ë™å", f7Desc: "Ë®òÈåÑÊØè‰∏ÄÂàªÁöÑÊÉÖÁ∑í„ÄÇÁêÜËß£Ëá™Â∑±ÔºåÊâçËÉΩÊõ¥Â•ΩÂú∞ÁÖßÈ°ßËá™Â∑±„ÄÇ", f7Btn: "Ë®òÈåÑÊÉÖÁ∑í ‚Üí",
                f8Title: "È£≤È£üÂª∫Ë≠∞", f8Desc: "ÁÇ∫ADHDÈáèË∫´ÊâìÈÄ†ÁöÑÁáüÈ§äÊñπÊ°à„ÄÇÊ≠£Á¢∫ÁöÑÈ£≤È£üËÉΩÊèêÂçáÂ∞àÊ≥®ÂäõÂíåÁ©©ÂÆöÊÉÖÁ∑í„ÄÇ", f8Btn: "‰∫ÜËß£È£≤È£ü ‚Üí",
                assessTitle: "Âø´ÈÄüË©ï‰º∞",
                assessDesc1: "‰∫ÜËß£‰Ω†ÁöÑÂ∞àÊ≥®ÁãÄÊÖã",
                assessDesc2: "Ê≤íÊúâÂÆåÁæéÁöÑÂõûÁ≠îÔºåÂè™ÊúâÁúüÂØ¶ÁöÑ‰Ω†„ÄÇÈÄô‰ªΩË©ï‰º∞Âπ´Âä©ÊàëÂÄëÊõ¥‰∫ÜËß£‰Ω†ÁöÑÁØÄÂ•è„ÄÇ",
                energyTitle: "ËÉΩÈáèÊ™¢Ê∏¨",
                energyQuestion: "‰Ω†ÁèæÂú®ÁöÑËÉΩÈáèÂ¶Ç‰ΩïÔºü",
                energyDesc: "Ê†πÊìö‰Ω†ÁöÑËÉΩÈáèÁãÄÊÖãÔºåÊàëÂÄëÊúÉÊé®Ëñ¶ÂêàÈÅ©ÁöÑ‰ªªÂãôÈõ£Â∫¶„ÄÇ",
                energyLabel1: "Ë∂Ö‰Ωé", energyLabel2: "ËºÉ‰Ωé", energyLabel3: "‰∏≠Á≠â", energyLabel4: "ÂÖÖË∂≥", energyLabel5: "ÁàÜÊ£ö",
                routineTitle: "ÊØèÊó•Â∞è‰∫ã",
                morningLabel: "Êó©Êô®ÂÑÄÂºè",
                morningDesc: "Ê∫´ÂíåÂú∞ÈñãÂïü‰Ω†ÁöÑ‰∏ÄÂ§©",
                eveningLabel: "ÂÇçÊôöÂÑÄÂºè",
                eveningDesc: "Ê∫´ÊüîÂú∞Èô™‰º¥‰Ω†ÈÄ≤ÂÖ•Â§úÊôö",
                routineMessageText: "ÈÄô‰∫õ‰∏çÊòØ‰ªªÂãôÔºåËÄåÊòØÂíåËá™Â∑±ÁöÑÁ¥ÑÊúÉ„ÄÇÊØè‰∏ÄÊ≠•ÈÉΩÂú®ÁÖßÈ°ß‰Ω†„ÄÇ",
                taskTitle: "‰ªªÂãôÁÆ°ÁêÜ",
                taskDesc1: "ÊääÂ§ßÁõÆÊ®ôÊãÜÊàêÂ∞èÊ≠•È©ü",
                timerTitle: "Áï™ËåÑÈêò",
                timerDesc1: "Ëá™Ë®ÇÊôÇÈñìÁöÑÂ∞àÊ≥®ÊôÇÂÖâ",
                timerMinLabel: "ÂàÜÈêò:",
                healingTitle: "ÁôÇÁôíÂ∑•ÂÖ∑",
                breathingTitle: "Ê≠£ÂøµÂëºÂê∏",
                breathingDesc: "Âú®ÁÑ¶ÊÖÆÊôÇÔºåÂëºÂê∏Â∞±ÊòØÊúÄÂ•ΩÁöÑÂÆâÊí´„ÄÇÈÄèÈÅéË¶ñË¶∫ÂåñÂëºÂê∏Âæ™Áí∞ÔºåÂπ´Âä©‰Ω†Ë™øÁØÄÁ•ûÁ∂ìÁ≥ªÁµ±ÔºåÊ∏õÂ∞ëÂ£ìÂäõÂíåÁÑ¶ÊÖÆ„ÄÇ",
                cognitiveTitle: "Ë™çÁü•ÈáçÊßãÁ∑¥Áøí",
                cognitiveDesc: "ÊääË≤†Èù¢ÊÉ≥Ê≥ïÈáçÂ°ëÊàêÂäõÈáè„ÄÇ",
                cognitiveScience: "üß† ÁßëÂ≠∏Âü∫Á§éÔºöË™çÁü•ÈáçÊßãÊòØË™çÁü•Ë°åÁÇ∫ÁôÇÊ≥ï(CBT)ÁöÑÊ†∏ÂøÉÊäÄË°ì„ÄÇÁ†îÁ©∂Ë°®ÊòéÔºåÈÄèÈÅéË≠òÂà•ÂíåÊåëÊà∞‰∏çÊ∫ñÁ¢∫ÁöÑ‰ø°ÂøµÔºåÂèØ‰ª•È°ØËëóÊîπÂñÑÁÑ¶ÊÖÆ„ÄÅÊäëÈ¨±ÂíåÈÅéÂ∫¶ÊÄùËÄÉ„ÄÇÈÄôÈ†ÖÁ∑¥ÁøíÂπ´Âä©‰Ω†ÊâìÁ†¥Ë≤†Èù¢ÊÄùÁ∂≠Âæ™Áí∞ÔºåÂª∫Á´ãÊõ¥ÂÅ•Â∫∑ÁöÑÂøÉÁêÜÊ®°Âºè„ÄÇ",
                groundingTitle: "Êé•Âú∞Á∑¥Áøí (5-4-3-2-1)",
                groundingDesc: "ÊÑüÂèóÁï∂‰∏ãÔºåÂõûÂà∞Ê≠§Âàª„ÄÇ",
                groundingScience: "üß† ÁßëÂ≠∏Âü∫Á§éÔºö5-4-3-2-1 Êé•Âú∞Á∑¥ÁøíÊòØ‰∏ÄÁ®ÆÊÑüÂÆòÈáçÂÆöÂêëÊäÄË°ìÔºåÈÄèÈÅéÈÅãÁî®‰Ω†ÁöÑ‰∫îÁ®ÆÊÑüÂÆòÔºåËÉΩËøÖÈÄüÂïüÂãïÂâØ‰∫§ÊÑüÁ•ûÁ∂ìÁ≥ªÁµ±ÔºåÂæûËÄåÊäµÊäóÁÑ¶ÊÖÆÂºïÁôºÁöÑ„ÄåÊà∞È¨•ÊàñÈÄÉÈÅø„ÄçÂèçÊáâ„ÄÇÈÄôÂÄãÊäÄÂ∑ßÂú®Êï∏ÁßíÂÖßÂ∞±ËÉΩÂπ´Âä©‰Ω†ÂõûÂà∞ÁèæÂú®ÁöÑÊôÇÂàª„ÄÇ",
                emotionTitle: "ÊÉÖÁ∑íÊó•Ë™å",
                emotionLogTitle: "Ë®òÈåÑÊ≠§ÂàªÁöÑÊÉÖÁ∑í",
                backBtn: "ËøîÂõûÈ¶ñÈ†Å",
                reportTitle: "üìÑ Ë©ï‰º∞Â†±Âëä",
                emailWarning: "‚ö†Ô∏è ÈáçË¶ÅÊèêÁ§∫ÔºöÁï∂ÂâçÊâÄÊúâÁ¥ÄÈåÑÂè™ÊúÉÂÑ≤Â≠òÂú®Ê≠§Ë£ùÁΩÆ„ÄÇÂ¶ÇÈúÄÂú®ÈõªÂ≠êÈÉµ‰ª∂‰øùÂ≠òÂ†±ÂëäÂâØÊú¨ÔºåË´ãËº∏ÂÖ•ÊÇ®ÁöÑÈÉµ‰ª∂Âú∞ÂùÄ‰∏¶ÁôºÈÄÅÂ†±Âëä„ÄÇÁ≥ªÁµ±ÊúÉËá™ÂãïÈñãÂïüÊÇ®ÁöÑÈÉµ‰ª∂ÊáâÁî®Á®ãÂºèÔºåÊÇ®ÂèØ‰ª•ÊâãÂãïÁôºÈÄÅÊàñÂ∞áÂ†±ÂëäË§áË£ΩÂà∞Ââ™Ë≤ºÊùø„ÄÇ",
                emotionReportTitle: "üìä ÂÆåÊï¥Â†±Âëä",
                emotionReportDesc: "ÁôºÈÄÅÂåÖÂê´ÊâÄÊúâÊàêÂ∞±Ë≥áÊñôÁöÑÂÆåÊï¥Â†±ÂëäÂà∞ÊÇ®ÁöÑÈÉµÁÆ±",
                nutritionTitle: "È£≤È£üÂª∫Ë≠∞",
                nutritionDesc: "ÁÇ∫ADHDÈáèË∫´ÊâìÈÄ†ÁöÑÁáüÈ§äÊñπÊ°à",
                nutritionIntro: "Ê†πÊìö2026Âπ¥ÁæéÂúãÊúÄÊñ∞È£≤È£üÊåáÂçóÔºå‰ª•‰∏ãÁáüÈ§äÂª∫Ë≠∞ËÉΩÂπ´Âä©ÊîπÂñÑÂ∞àÊ≥®ÂäõÂíåÊÉÖÁ∑íÁ©©ÂÆö„ÄÇ",
                nutritionSection1: "üß† ÂÑ™ÂÖàÊîùÂèñÁöÑÁáüÈ§ä",
                nutritionSection2: "üçΩÔ∏è ÈÄ≤È£üÈ†ÜÂ∫èÂª∫Ë≠∞",
                eatingOrderDesc: "ÊäµÊäóÁ¢≥ÊöàÁèæË±°ÔºåÁ©©ÂÆöË°ÄÁ≥ñÔºö",
                nutritionSection3: "‚ùå ÊáâÈÅøÂÖçÁöÑÈ£üÁâ©",
                nutritionMessage: "Ê≠£Á¢∫ÁöÑÈ£≤È£üÊòØÁÖßÈ°ßËá™Â∑±ÁöÑÁ¨¨‰∏ÄÊ≠•„ÄÇÊØè‰∏ÄÂÄãÁáüÈ§äÈÅ∏ÊìáÈÉΩÂú®Âπ´Âä©‰Ω†Â∞àÊ≥®„ÄÇ",
                taskBreakdownTitle: "ÊãÜÂàÜ‰ªªÂãô",
                taskBreakdownDesc: "Â∞áÂ§ß‰ªªÂãôÊãÜÊàêÂ∞èÊ≠•È©ü",
                confirmTaskBtn: "Á¢∫Ë™çÂàÜËß£",
                cancelTaskBtn: "ÂèñÊ∂à"
            },
            en: {
                levelLabel: "Level",
                xpLabel: "XP",
                streakLabel: "Consecutive Days",
                minutesLabel: "Breathing Minutes",
                headerSubtitle: "Cultivate your focus rhythm with warm support",
                usageNote: "‚úçÔ∏è Tips: Use from top to bottom for best results. Each tool is customized for you.",
                tipsNote: "No need to complete everything at once. Choose the tools that help you most, start with small steps. Every choice is self-love.",
                f1Title: "Quick Assessment", f1Desc: "Understand your focus state today. 10 simple questions help you know your rhythm.", f1Btn: "Start Assessment ‚Üí",
                f2Title: "Energy Check", f2Desc: "Choose your energy level, get task recommendations. Thoughtful workload arrangement.", f2Btn: "Check Energy ‚Üí",
                f3Title: "Daily Rituals", f3Desc: "Morning and evening gentle rituals. Build sustainable rhythm, one step at a time.", f3Btn: "Build Habits ‚Üí",
                f4Title: "Task Management", f4Desc: "Break big tasks into small steps. Every check is your victory.", f4Btn: "Manage Tasks ‚Üí",
                f5Title: "Pomodoro Timer", f5Desc: "Customizable focused time. Every second accumulates your achievements.", f5Btn: "Start Timer ‚Üí",
                f6Title: "Healing Tools", f6Desc: "Mindful breathing, cognitive restructuring, grounding. Give yourself a hug when anxious.", f6Btn: "Find Calm ‚Üí",
                f7Title: "Emotion Journal", f7Desc: "Record every moment of emotion. Understanding yourself leads to better self-care.", f7Btn: "Record Emotion ‚Üí",
                f8Title: "Nutrition Advice", f8Desc: "Nutrition plan tailored for ADHD. Right diet boosts focus and mood stability.", f8Btn: "Learn Nutrition ‚Üí",
                assessTitle: "Quick Assessment",
                assessDesc1: "Understand your focus state",
                assessDesc2: "No perfect answers, only the real you. This assessment helps us understand your rhythm.",
                energyTitle: "Energy Check",
                energyQuestion: "What's your energy level right now?",
                energyDesc: "Based on your energy, we recommend suitable task difficulty.",
                energyLabel1: "Very Low", energyLabel2: "Low", energyLabel3: "Medium", energyLabel4: "Sufficient", energyLabel5: "Peak",
                routineTitle: "Daily Rituals",
                morningLabel: "Morning Ritual",
                morningDesc: "Gently start your day",
                eveningLabel: "Evening Ritual",
                eveningDesc: "Gently guide you into night",
                routineMessageText: "These aren't tasks, they're dates with yourself. Every step cares for you.",
                taskTitle: "Task Management",
                taskDesc1: "Break big goals into small steps",
                timerTitle: "Pomodoro Timer",
                timerDesc1: "Customizable focused time",
                timerMinLabel: "Minutes:",
                healingTitle: "Healing Tools",
                breathingTitle: "Mindful Breathing",
                breathingDesc: "When anxious, breathing is the best comfort. Visualize your breathing cycle to regulate your nervous system and reduce stress.",
                cognitiveTitle: "Cognitive Restructuring",
                cognitiveDesc: "Transform negative thoughts into strength.",
                cognitiveScience: "üß† Scientific Basis: Cognitive restructuring is core to CBT. Research shows that identifying and challenging inaccurate beliefs significantly improves anxiety, depression, and overthinking. This practice helps break negative thought cycles and build healthier mental patterns.",
                groundingTitle: "Grounding (5-4-3-2-1)",
                groundingDesc: "Feel the present, return to now.",
                groundingScience: "üß† Scientific Basis: The 5-4-3-2-1 grounding technique is a sensory redirection method that activates your parasympathetic nervous system through five senses, counteracting anxiety-induced fight-or-flight response. This technique helps return you to the present within seconds.",
                emotionTitle: "Emotion Journal",
                emotionLogTitle: "Record your current emotion",
                backBtn: "Back to Home",
                reportTitle: "üìÑ Assessment Report",
                emailWarning: "‚ö†Ô∏è Important: All records are stored only on this device. To save a report copy via email, enter your email address. The system will open your mail app where you can send or copy to clipboard.",
                emotionReportTitle: "üìä Complete Report",
                emotionReportDesc: "Send complete report with all achievements to your email",
                nutritionTitle: "Nutrition Advice",
                nutritionDesc: "Nutrition plan tailored for ADHD",
                nutritionIntro: "Based on 2026 latest US dietary guidelines, these nutrition tips help improve focus and emotional stability.",
                nutritionSection1: "üß† Priority Nutrients",
                nutritionSection2: "üçΩÔ∏è Eating Order Recommendation",
                eatingOrderDesc: "Combat blood sugar crashes, stabilize glucose:",
                nutritionSection3: "‚ùå Foods to Avoid",
                nutritionMessage: "Proper nutrition is the first step to self-care. Every nutrition choice helps you focus.",
                taskBreakdownTitle: "Break Down Task",
                taskBreakdownDesc: "Break big task into small steps",
                confirmTaskBtn: "Confirm Breakdown",
                cancelTaskBtn: "Cancel"
            }
        };

        // È†êË®≠ÁöÑÊó©Êô®ÂÑÄÂºèÂíåÂÇçÊôöÂÑÄÂºè
        const defaultMorningRoutineZh = [
            '‚è∞ Ëµ∑Â∫ä ‚Äî Ë®≠ÂÆö 3 ÂÄãÈ¨ßÈêòÔºåÁµ¶Ëá™Â∑±ÂÖÖË£ïËµ∑Â∫äÊôÇÈñì',
            'üå¨Ô∏è Êó©Êô®ÂëºÂê∏ ‚Äî Âê∏Ê∞£4Áßí„ÄÅÂÅú4Áßí„ÄÅÂëºÊ∞£4ÁßíÔºåÈáçË§á5Ëº™',
            'üí™ Á∞°ÂñÆ‰º∏Â±ïÊàñËµ∞Âãï 5‚Äì10 ÂàÜÈêò',
            'üöø Ê¥óËáâÊàñÊ∑ãÊµ¥ÔºåÊèõ‰∏äËàíÈÅ©Ë°£Áâ©',
            'ü•û ÂêÉ‰∏Ä‰ªΩÊúâËõãÁôΩË≥™ÁöÑÊó©È§êÔºàËõã„ÄÅË±ÜÊºø„ÄÅÂÑ™Ê†ºÁ≠âÔºâ',
            'üìã ÂØ´‰∏ã‰ªäÂ§©ÊÉ≥ÂÆåÊàêÁöÑ 1‚Äì3 ‰ª∂Â∞è‰∫ã'
        ];

        const defaultMorningRoutineEn = [
            '‚è∞ Wake up ‚Äî Set 3 alarms, give yourself time',
            'üå¨Ô∏è Morning breathing ‚Äî Inhale 4s, hold 4s, exhale 4s, repeat 5 times',
            'üí™ Simple stretch or walk 5‚Äì10 minutes',
            'üöø Wash face or shower, change into comfortable clothes',
            'ü•û Eat breakfast with protein (eggs, soy milk, yogurt, etc.)',
            'üìã Write down 1‚Äì3 things you want to complete today'
        ];

        const defaultEveningRoutineZh = [
            'üìµ Êîæ‰∏ãÊâãÊ©üÊàñËû¢ÂπïÔºåËÆìÁúºÁùõ‰ºëÊÅØ',
            'üßò ÂÅö 3‚Äì5 ÂàÜÈêòÁöÑÊîæÈ¨ÜÂëºÂê∏Êàñ‰º∏Â±ï',
            'üöø Ê¥óÊæ°ÊàñÊ¥óËáâÔºåÊ∏ÖÁêÜ‰∏ÄÂ§©ÁöÑÁñ≤Âãû',
            'üìÖ Á∞°ÂñÆÂØ´‰∏ãÊòéÂ§©ÊúÄÈáçË¶ÅÁöÑ‰∏Ä‰ª∂‰∫ã',
            'üõèÔ∏è Êï¥ÁêÜÂ∫äËàñËàáÁù°Áú†Áí∞Â¢É',
            'üò¥ ‰∏äÂ∫äÂâçÂ∞ç‰ªäÂ§©Ë™™‰∏ÄÂè•„ÄåËæõËã¶‰∫Ü„Äç'
        ];

        const defaultEveningRoutineEn = [
            'üìµ Put down phone or screen, let your eyes rest',
            'üßò Do 3‚Äì5 minutes of relaxation breathing or stretching',
            'üöø Take a bath or wash your face, clear the day\'s fatigue',
            'üìÖ Write down the most important thing for tomorrow',
            'üõèÔ∏è Organize bed and sleep environment',
            'üò¥ Say "You worked hard today" before bed'
        ];

        let currentLanguage = 'zh';
        let currentPage = 'homePage';
        let lastAccessedFeature = null;
        let stats = JSON.parse(localStorage.getItem('stats')) || { level: 1, xp: 0, streak: 0, totalMinutes: 0 };
        let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        let emotionLog = JSON.parse(localStorage.getItem('emotionLog')) || [];
        let morningRoutine = JSON.parse(localStorage.getItem('morningRoutine')) || (currentLanguage === 'zh' ? defaultMorningRoutineZh : defaultMorningRoutineEn);
        let eveningRoutine = JSON.parse(localStorage.getItem('eveningRoutine')) || (currentLanguage === 'zh' ? defaultEveningRoutineZh : defaultEveningRoutineEn);
        let assessmentHistory = JSON.parse(localStorage.getItem('assessmentHistory')) || [];
        let isBreathingAnimating = false;
        let timerDuration = 25 * 60;
        let timeLeft = 25 * 60;
        let timerInterval = null;
        let currentAlarmSound = 'default';
        let groundingCurrentStep = 0;
        let currentBreakdownTask = null;
        let breakdownSteps = [];

        // È¨ßÈà¥ÈÅ∏È†ÖÈÖçÁΩÆ - ËèØÈ∫óÁöÑÈü≥Êïà
        const alarmSoundsConfig = {
            default: { name: 'È†êË®≠Èü≥ üîî', freq: 800, duration: 0.2 },
            chime: { 
                name: 'ËèØÈ∫óÂíåÂº¶ üéµ', 
                sequence: [{freq: 1000, dur: 0.3}, {freq: 1200, dur: 0.3}, {freq: 1400, dur: 0.4}, {freq: 1200, dur: 0.3}, {freq: 1000, dur: 0.3}],
                isSequence: true
            },
            bell: { 
                name: 'ÂÑ™ÈõÖÈà¥ËÅ≤ üîî', 
                sequence: [{freq: 800, dur: 0.4}, {freq: 1000, dur: 0.3}, {freq: 900, dur: 0.35}, {freq: 1100, dur: 0.4}],
                isSequence: true
            },
            buzz: { 
                name: 'ÂæãÂãïËúÇÈ≥¥ ‚ö°', 
                sequence: [{freq: 1200, dur: 0.2}, {freq: 1200, dur: 0.2}, {freq: 1500, dur: 0.3}, {freq: 1200, dur: 0.2}, {freq: 1200, dur: 0.2}, {freq: 1500, dur: 0.3}],
                isSequence: true
            }
        };

        function t(key) {
            return translations[currentLanguage][key] || key;
        }

        function switchLanguage(lang) {
            currentLanguage = lang;
            document.getElementById('langZh').classList.toggle('active', lang === 'zh');
            document.getElementById('langEn').classList.toggle('active', lang === 'en');
            updateAllText();
            if (currentPage === 'routinePage') renderRoutines();
            if (currentPage === 'taskPage') renderTasks();
            if (currentPage === 'emotionPage') renderEmotionLog();
            if (currentPage === 'nutritionPage') updateNutritionPage();
            if (currentPage === 'assessmentPage') renderAssessmentHistory();
            updateTopStats();
        }

        function updateAllText() {
            if (document.getElementById('levelLabel')) document.getElementById('levelLabel').textContent = t('levelLabel');
            if (document.getElementById('xpLabel')) document.getElementById('xpLabel').textContent = t('xpLabel');
            if (document.getElementById('streakLabel')) document.getElementById('streakLabel').textContent = t('streakLabel');
            if (document.getElementById('minutesLabel')) document.getElementById('minutesLabel').textContent = t('minutesLabel');
            
            document.getElementById('headerSubtitle').textContent = t('headerSubtitle');
            document.getElementById('usageNote').textContent = t('usageNote');
            document.getElementById('tipsNote').textContent = t('tipsNote');
            
            document.getElementById('f1Title').textContent = t('f1Title');
            document.getElementById('f1Desc').textContent = t('f1Desc');
            document.getElementById('f1Btn').textContent = t('f1Btn');
            document.getElementById('f2Title').textContent = t('f2Title');
            document.getElementById('f2Desc').textContent = t('f2Desc');
            document.getElementById('f2Btn').textContent = t('f2Btn');
            document.getElementById('f3Title').textContent = t('f3Title');
            document.getElementById('f3Desc').textContent = t('f3Desc');
            document.getElementById('f3Btn').textContent = t('f3Btn');
            document.getElementById('f4Title').textContent = t('f4Title');
            document.getElementById('f4Desc').textContent = t('f4Desc');
            document.getElementById('f4Btn').textContent = t('f4Btn');
            document.getElementById('f5Title').textContent = t('f5Title');
            document.getElementById('f5Desc').textContent = t('f5Desc');
            document.getElementById('f5Btn').textContent = t('f5Btn');
            document.getElementById('f6Title').textContent = t('f6Title');
            document.getElementById('f6Desc').textContent = t('f6Desc');
            document.getElementById('f6Btn').textContent = t('f6Btn');
            document.getElementById('f7Title').textContent = t('f7Title');
            document.getElementById('f7Desc').textContent = t('f7Desc');
            document.getElementById('f7Btn').textContent = t('f7Btn');
            document.getElementById('f8Title').textContent = t('f8Title');
            document.getElementById('f8Desc').textContent = t('f8Desc');
            document.getElementById('f8Btn').textContent = t('f8Btn');
            
            Array.from(document.querySelectorAll('[id^="backBtn"]')).forEach(el => {
                if (el.id === 'backBtn') el.textContent = t('backBtn');
            });
            Array.from(document.querySelectorAll('[id^="bottomBackBtn"]')).forEach(el => {
                el.textContent = t('backBtn');
            });
            
            if (document.getElementById('assessTitle')) document.getElementById('assessTitle').textContent = t('assessTitle');
            if (document.getElementById('assessDesc1')) document.getElementById('assessDesc1').textContent = t('assessDesc1');
            if (document.getElementById('assessDesc2')) document.getElementById('assessDesc2').textContent = t('assessDesc2');
            if (document.getElementById('energyTitle')) document.getElementById('energyTitle').textContent = t('energyTitle');
            if (document.getElementById('energyQuestion')) document.getElementById('energyQuestion').textContent = t('energyQuestion');
            if (document.getElementById('energyDesc')) document.getElementById('energyDesc').textContent = t('energyDesc');
            if (document.getElementById('energyLabel1')) document.getElementById('energyLabel1').textContent = t('energyLabel1');
            if (document.getElementById('energyLabel2')) document.getElementById('energyLabel2').textContent = t('energyLabel2');
            if (document.getElementById('energyLabel3')) document.getElementById('energyLabel3').textContent = t('energyLabel3');
            if (document.getElementById('energyLabel4')) document.getElementById('energyLabel4').textContent = t('energyLabel4');
            if (document.getElementById('energyLabel5')) document.getElementById('energyLabel5').textContent = t('energyLabel5');
            if (document.getElementById('taskBreakdownTitle')) document.getElementById('taskBreakdownTitle').textContent = t('taskBreakdownTitle');
            if (document.getElementById('taskBreakdownDesc')) document.getElementById('taskBreakdownDesc').textContent = t('taskBreakdownDesc');
        }

        // ========== È†ÅÈù¢Â∞éËà™ ==========
        function goToPage(pageId) {
            document.getElementById(currentPage).classList.remove('active');
            document.getElementById(pageId).classList.add('active');
            currentPage = pageId;
            lastAccessedFeature = pageId;

            if (pageId === 'assessmentPage') {
                renderAssessmentQuestions();
                renderAssessmentHistory();
            } else if (pageId === 'routinePage') {
                renderRoutines();
            } else if (pageId === 'taskPage') {
                renderTasks();
            } else if (pageId === 'emotionPage') {
                renderEmotionLog();
            } else if (pageId === 'nutritionPage') {
                updateNutritionPage();
            } else if (pageId === 'homePage') {
                updateTopStats();
            }

            window.scrollTo(0, 0);
        }

        function backToHomeFrom(pageId) {
            document.getElementById(currentPage).classList.remove('active');
            document.getElementById('homePage').classList.add('active');
            currentPage = 'homePage';
            updateTopStats();
            
            setTimeout(() => {
                scrollToFeature(pageId);
            }, 100);
        }

        function scrollToFeature(pageId) {
            const pageToCardMap = {
                'assessmentPage': 0,
                'energyPage': 1,
                'routinePage': 2,
                'taskPage': 3,
                'timerPage': 4,
                'healingPage': 5,
                'emotionPage': 6,
                'nutritionPage': 7
            };

            const cardIndex = pageToCardMap[pageId];
            if (cardIndex !== undefined) {
                const cards = document.querySelectorAll('.feature-card');
                if (cards[cardIndex]) {
                    cards[cardIndex].scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        }

        function updateTopStats() {
            document.getElementById('topLevel').textContent = 'Lv. ' + stats.level;
            document.getElementById('topXp').textContent = stats.xp;
            document.getElementById('topStreak').textContent = stats.streak;
            document.getElementById('topMinutes').textContent = stats.totalMinutes;
        }

        // ========== Ë©ï‰º∞Á≥ªÁµ± ==========
        const assessmentQuestions = [
            'ÊàëÁ∂ìÂ∏∏ÊãñÂª∂‰ªªÂãôÁõ¥Âà∞ÊúÄÂæå‰∏ÄÂàª',
            'ÊàëÂú®ÈÄ≤Ë°åÁÑ°ËÅä‰ªªÂãôÊôÇÈõ£‰ª•‰øùÊåÅÂ∞àÊ≥®',
            'ÊàëÂÆπÊòìË¢´ÁÑ°ÈóúÁöÑÊù±Ë•øÂàÜÊï£Ê≥®ÊÑèÂäõ',
            'ÊàëÂÆπÊòìÂøòË®òÂõûË¶Ü‰ø°ÊÅØÊàñÂÆåÊàêË®àÂäÉÁöÑ‰ªªÂãô',
            'ÊàëÊúÉ‰∏çËÄÉÊÖÆÂæåÊûúËÄåË°ùÂãïË°åÂãï',
            'ÊàëÂÆπÊòìÊÑüÂà∞‰∏çËÄêÁÖ©ÊàñÊ≤ÆÂñ™',
            'ÊàëÈõ£‰ª•ÈÅµÂæ™ÊåáÁ§∫ÊàñÂÆåÊàêÂ§öÊ≠•È©ü‰ªªÂãô',
            'ÊàëÁ∂ìÂ∏∏ÊâìÊñ∑Âà•‰∫∫ÊàñË°ùÂãïË™™Ë©±',
            'ÊàëÁöÑÊÉÖÁ∑íËÆäÂåñÂæàÂø´',
            'ÊàëÈõ£‰ª•ÁµÑÁπî‰∫ãÁâ©ÊàñÁÆ°ÁêÜÊôÇÈñì'
        ];

        function renderAssessmentQuestions() {
            const container = document.getElementById('assessmentQuestions');
            container.innerHTML = assessmentQuestions.map((q, i) => `
                <div class="question-group">
                    <label>${i + 1}. ${q}</label>
                    <input type="range" class="slider" id="q${i}" min="1" max="5" value="3" onchange="updateSliderLabel(${i})">
                    <div style="display: flex; justify-content: space-between; margin-top: 8px; color: var(--text-secondary); font-size: 0.85em;">
                        <span>Âæû‰∏ç</span>
                        <span id="label${i}">ÊúâÊôÇ</span>
                        <span>Á∏ΩÊòØ</span>
                    </div>
                </div>
            `).join('');
        }

        function updateSliderLabel(index) {
            const value = document.getElementById(`q${index}`).value;
            const labels = ['Âæû‰∏ç', 'ÂæàÂ∞ë', 'ÊúâÊôÇ', 'Á∂ìÂ∏∏', 'Á∏ΩÊòØ'];
            document.getElementById(`label${index}`).textContent = labels[value - 1];
        }

        function submitAssessment() {
            let score = 0;
            for (let i = 0; i < 10; i++) {
                score += parseInt(document.getElementById(`q${i}`).value);
            }

            let level, advice;
            if (score <= 15) {
                level = currentLanguage === 'zh' ? 'ËºïÂæÆÂÇæÂêë' : 'Mild Tendency';
                advice = currentLanguage === 'zh' 
                    ? '‰Ω†ÁöÑÁãÄÊÖãÊï¥È´îË°®Áèæ‰∏çÈåØ„ÄÇÈÄèÈÅéÁ∞°ÂñÆÁöÑÊó•Â∏∏Ë™øÊï¥ÂíåÁøíÊÖ£ÂÑ™ÂåñÔºåÂèØ‰ª•ÈÄ≤‰∏ÄÊ≠•ÊèêÂçáÂ∞àÊ≥®ÂäõÂíåÁîüÊ¥ªÂìÅË≥™„ÄÇ'
                    : 'Your state is performing well overall. Simple daily adjustments and habit optimization can further improve focus and quality of life.';
            } else if (score <= 25) {
                level = currentLanguage === 'zh' ? '‰∏≠Á≠âÂÇæÂêë' : 'Moderate Tendency';
                advice = currentLanguage === 'zh'
                    ? 'ÈÄô‰∫õÁâπÂæµÂú®Êó•Â∏∏ÁîüÊ¥ª‰∏≠ÊúâÊâÄË°®Áèæ„ÄÇÈÄèÈÅéÊê≠ÈÖçÈÅãÂãï„ÄÅÊîæÈ¨ÜÁ∑¥ÁøíÂíåÁµêÊßãÂåñË®àÁï´ÔºåÈÄöÂ∏∏ÂèØ‰ª•ÁúãÂà∞ÊòéÈ°ØÊîπÂñÑ„ÄÇ'
                    : 'These characteristics show in daily life. With exercise, relaxation practices, and structured planning, you can usually see significant improvements.';
            } else if (score <= 35) {
                level = currentLanguage === 'zh' ? 'È°ØËëóÂÇæÂêë' : 'Significant Tendency';
                advice = currentLanguage === 'zh'
                    ? 'ÈÄô‰∫õÁâπÂæµÂú®‰Ω†ÁöÑÁîüÊ¥ª‰∏≠ËºÉÁÇ∫ÊòéÈ°Ø„ÄÇÂª∫Ë≠∞ÁµêÂêàÊú¨Â∑•ÂÖ∑‰∏¶ËÄÉÊÖÆÂ∞ãÊ±ÇÂ∞àÊ•≠Ë©ï‰º∞Ôºå‰ª•ÊâæÂà∞ÊúÄÈÅ©ÂêàÁöÑÊîØÊåÅÊñπÂºè„ÄÇ'
                    : 'These characteristics are more noticeable in your life. Consider combining this tool with professional evaluation to find the best support.';
            } else {
                level = currentLanguage === 'zh' ? 'È°ØËëóÂÇæÂêë' : 'Significant Tendency';
                advice = currentLanguage === 'zh'
                    ? 'ÈÄô‰∫õÁâπÂæµÂú®‰Ω†ÁöÑÁîüÊ¥ª‰∏≠ÂΩ±ÈüøÈ°ØËëó„ÄÇÂª∫Ë≠∞ÂÑ™ÂÖàÈÄ≤Ë°åÂ∞àÊ•≠Ë©ï‰º∞ÔºåÂêåÊôÇÊú¨Â∑•ÂÖ∑ÂèØ‰ΩúÁÇ∫Êó•Â∏∏ÊîØÊåÅÁöÑË£úÂÖÖÊâãÊÆµ„ÄÇ'
                    : 'These characteristics significantly impact your life. Professional evaluation is recommended, while this tool can support daily management.';
            }

            const resultHTML = `
                <div class="score-card">
                    <div class="score-level">${level}</div>
                    <div class="score-number">${score}/50</div>
                    <div class="score-advice">${advice}</div>
                </div>
            `;

            const resultDiv = document.getElementById('assessmentResult');
            resultDiv.innerHTML = resultHTML;
            resultDiv.classList.remove('hidden');

            const now = new Date();
            const record = {
                id: Date.now(),
                date: now.toLocaleString(),
                score: score,
                level: level,
                advice: advice
            };
            assessmentHistory.push(record);
            localStorage.setItem('assessmentHistory', JSON.stringify(assessmentHistory));

            document.getElementById('assessmentReportSection').style.display = 'block';
            document.getElementById('reportTime').textContent = (currentLanguage === 'zh' ? 'Êú¨Ê¨°Ë©ï‰º∞ÊôÇÈñì: ' : 'This Assessment Time: ') + record.date;
            document.getElementById('reportContent').innerHTML = `<strong>${level}</strong> (${score}/50)<br><p>${advice}</p>`;

            renderAssessmentHistory();
            addXP(50);
        }

        function renderAssessmentHistory() {
            const list = document.getElementById('assessmentHistoryList');
            if (!list) return;
            if (assessmentHistory.length === 0) {
                list.innerHTML = `<p style="color: var(--text-secondary); font-size:0.9em;">${currentLanguage === 'zh' ? 'ÁõÆÂâçÈÇÑÊ≤íÊúâÊ≠∑Âè≤Ë©ï‰º∞Ë®òÈåÑ„ÄÇ' : 'No assessment history yet.'}</p>`;
                return;
            }

            list.innerHTML = assessmentHistory.slice().reverse().map(rec => {
                const labelLevel = currentLanguage === 'zh' ? 'Á≠âÁ¥ö' : 'Level';
                const labelScore = currentLanguage === 'zh' ? 'ÂàÜÊï∏' : 'Score';
                const labelTime = currentLanguage === 'zh' ? 'ÊôÇÈñì' : 'Time';
                const deleteText = currentLanguage === 'zh' ? 'Âà™Èô§' : 'Delete';
                return `
                    <div style="padding:12px; margin:6px 0; border-radius:8px; background:rgba(74,144,226,0.08); display:flex; flex-direction:column; gap:4px;">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <span style="font-size:0.9em; color:var(--text-secondary);">${labelTime}: ${rec.date}</span>
                            <button class="btn btn-secondary" style="padding:4px 10px; font-size:0.8em; margin:0;" onclick="deleteAssessmentRecord(${rec.id});">${deleteText}</button>
                        </div>
                        <div style="font-size:0.95em;">
                            <strong>${labelLevel}</strong>: ${rec.level}„ÄÄ<strong>${labelScore}</strong>: ${rec.score}/50
                        </div>
                        <div style="font-size:0.85em; color:var(--text-secondary);">${rec.advice}</div>
                    </div>
                `;
            }).join('');
        }

        function deleteAssessmentRecord(id) {
            assessmentHistory = assessmentHistory.filter(r => r.id !== id);
            localStorage.setItem('assessmentHistory', JSON.stringify(assessmentHistory));
            renderAssessmentHistory();
        }

        function sendReportToEmail() {
            const email = document.getElementById('emailInput').value;
            if (!email) {
                alert(currentLanguage === 'zh' ? 'Ë´ãËº∏ÂÖ•ÈÉµÁÆ±Âú∞ÂùÄ' : 'Please enter email address');
                return;
            }

            let reportContent = currentLanguage === 'zh' ? '===== ADHD ÂÆåÊï¥Ë©ï‰º∞Â†±Âëä =====' : '===== ADHD Complete Assessment Report =====';
            reportContent += '\n\n';

            reportContent += (currentLanguage === 'zh' ? 'üìã Ë©ï‰º∞Ê≠∑Âè≤:\n' : 'üìã Assessment History:\n');
            if (assessmentHistory.length === 0) {
                reportContent += currentLanguage === 'zh' ? 'ÁõÆÂâçÂ∞öÁÑ°Ë©ï‰º∞Ë®òÈåÑ„ÄÇ\n' : 'No assessment records yet.\n';
            } else {
                assessmentHistory.forEach((record, idx) => {
                    reportContent += `${idx + 1}. ${record.date} - ${record.level} (${record.score}/50)\n`;
                });
            }

            reportContent += '\n' + (currentLanguage === 'zh' ? '‚úÖ Â∑≤ÂÆåÊàê‰ªªÂãô: ' : '‚úÖ Completed Tasks: ') + tasks.filter(t => t.completed).length + '/' + tasks.length + '\n';
            reportContent += '\n' + (currentLanguage === 'zh' ? '‚≠ê ÊàêÂ∞±:\n' : '‚≠ê Achievements:\n');
            reportContent += (currentLanguage === 'zh' ? 'Á≠âÁ¥ö: ' : 'Level: ') + stats.level + '\n';
            reportContent += 'XP: ' + stats.xp + '\n';
            reportContent += (currentLanguage === 'zh' ? 'ÈÄ£Á∫åÊàêÂäüÊó•: ' : 'Consecutive Days: ') + stats.streak + '\n';
            reportContent += (currentLanguage === 'zh' ? 'Á∏ΩÊ≠£ÂøµÂëºÂê∏ÂàÜÈêòÊï∏: ' : 'Total Breathing Minutes: ') + stats.totalMinutes;

            const mailtoLink = `mailto:${email}?subject=${encodeURIComponent(currentLanguage === 'zh' ? 'ADHDË©ï‰º∞Â†±Âëä' : 'ADHD Assessment Report')}&body=${encodeURIComponent(reportContent)}`;
            window.location.href = mailtoLink;
        }

        // ========== ËÉΩÈáèÁ≥ªÁµ± ==========
        function setEnergy(level) {
            document.querySelectorAll('.energy-btn').forEach((btn, idx) => {
                btn.classList.remove('btn');
                btn.classList.add('btn-secondary');
            });

            document.getElementById(`energyBtn${level}`).classList.remove('btn-secondary');
            document.getElementById(`energyBtn${level}`).classList.add('btn');
            document.getElementById(`energyBtn${level}`).style.transform = 'scale(1.05)';

            const energyTextsZh = {
                1: 'üî¥ Ë∂Ö‰ΩéËÉΩÈáèÔºöÁ∞°ÂñÆÂ∑•‰ΩúÔºàÊü•ÁúãÈÉµ‰ª∂„ÄÅÊï¥ÁêÜÊ°åÈù¢„ÄÅÂñùÊ∞¥„ÄÅËÅΩÈü≥Ê®ÇÔºâ',
                2: 'üü° ‰Ωé-‰∏≠Á≠âËÉΩÈáèÔºö‰∏≠Á≠âÂ∑•‰ΩúÔºàÂõûË¶ÜÊ∂àÊÅØ„ÄÅÊï¥ÁêÜÊñá‰ª∂„ÄÅÁ∞°ÂñÆÁ∑®ËºØ„ÄÅËºïÂ∫¶Èñ±ËÆÄÔºâ',
                3: 'üü¢ ‰∏≠Á≠âËÉΩÈáèÔºö‰∏ÄËà¨Â∑•‰ΩúÔºàÂ§ßÂ§öÊï∏Â∑•‰Ωú„ÄÅÈåÑË£Ω„ÄÅÂÖßÂÆπË¶èÂäÉ„ÄÅÊúÉË≠∞Ôºâ',
                4: 'üíö È´òËÉΩÈáèÔºöÊúâÊåëÊà∞ÁöÑ‰ªªÂãôÔºàÂâµÊÑèÈ†ÖÁõÆ„ÄÅË§áÈõúÁ∑®ËºØ„ÄÅÈáçË¶ÅÊúÉË≠∞„ÄÅÊïôÂ≠∏Ôºâ',
                5: '‚ú® Ë∂ÖÂÖÖË∂≥ËÉΩÈáèÔºöÈ´òÈõ£Â∫¶‰ªªÂãôÔºàÂÖ®Â§©ÊãçÊîù„ÄÅË§áÈõúË£Ω‰Ωú„ÄÅÂâµÊÑèÁ™ÅÁ†¥„ÄÅÈ†òÂ∞éÂ∑•‰ΩúÔºâ'
            };

            const energyTextsEn = {
                1: 'üî¥ Very Low Energy: Simple tasks (check email, organize desk, drink water, listen to music)',
                2: 'üü° Low-Medium Energy: Moderate tasks (reply messages, organize files, simple editing, light reading)',
                3: 'üü¢ Medium Energy: Regular work (most tasks, recording, content planning, meetings)',
                4: 'üíö High Energy: Challenging tasks (creative projects, complex editing, important meetings, teaching)',
                5: '‚ú® Peak Energy: High difficulty (all-day shooting, complex production, creative breakthroughs, leadership)'
            };

            const recommendationsZh = {
                1: ['ÂñùÊùØÂíñÂï°ÊàñËå∂‚òï', 'ÈÄ≤Ë°å5ÂàÜÈêòÊãâ‰º∏üßò', 'ËÅΩÊúÄÂñúÊ≠°ÁöÑÊ≠åüéµ', 'ÂÅöÊ∑±ÂëºÂê∏Á∑¥Áøíüå¨Ô∏è', 'ÊèõÂÄãÁí∞Â¢ÉÊï£Ê≠•üö∂'],
                2: ['5-10ÂàÜÈêòÊï£Ê≠•üö∂', 'ÂÅöÁ∞°ÂñÆÊñáÊõ∏Â∑•‰Ωúüìù', 'ÂõûË¶ÜÁü≠‰ø°ÊÅØüí¨', 'ËºïÂ∫¶‰º∏Â±ïü§∏', 'Ë™øÊï¥ÂùêÂßøüí∫'],
                3: ['ÂÆåÊàêÊó•Â∏∏Â∑•‰Ωú‚úÖ', 'ËôïÁêÜ‰∏≠Á≠âË§áÈõúÂ∫¶‰ªªÂãôüéØ', 'ÂèÉÂä†ÊúÉË≠∞ü§ù', 'Âçî‰ΩúÈ†ÖÁõÆüë•', 'ÈÄ≤Â∫¶Ê™¢Êü•üìä'],
                4: ['ÂïüÂãïÂâµÊÑèÈ†ÖÁõÆüé®', 'ÈÄ≤Ë°åÊ∑±Â∫¶Â∑•‰Ωúüîç', 'Â≠∏ÁøíÊñ∞ÊäÄËÉΩüìö', 'Ë§áÈõúÂïèÈ°åËß£Ê±∫üß©', 'Á≠ñÁï•Ë¶èÂäÉüìã'],
                5: ['ÂïüÂãïÈáçÂ§ßÈ†ÖÁõÆüöÄ', 'Ëß£Ê±∫Ë§áÈõúÂïèÈ°åüí°', 'ÈÄ≤Ë°åÈï∑ÊúüË£Ω‰Ωúüé¨', 'È†òÂ∞éÂúòÈöäüëë', 'ÂâµÊñ∞Á™ÅÁ†¥‚≠ê']
            };

            const recommendationsEn = {
                1: ['Have a coffee or tea‚òï', '5-minute stretchüßò', 'Listen to favorite songsüéµ', 'Deep breathingüå¨Ô∏è', 'Take a walküö∂'],
                2: ['5-10 minute walküö∂', 'Simple paperworküìù', 'Reply short messagesüí¨', 'Light stretchingü§∏', 'Adjust postureüí∫'],
                3: ['Complete daily tasks‚úÖ', 'Handle moderate complexityüéØ', 'Attend meetingsü§ù', 'Collaborationüë•', 'Progress checküìä'],
                4: ['Start creative projectüé®', 'Deep worküîç', 'Learn new skillsüìö', 'Solve complex problemsüß©', 'Strategic planningüìã'],
                5: ['Launch major projectüöÄ', 'Solve complex issuesüí°', 'Long-term productionüé¨', 'Lead teamsüëë', 'Creative breakthrough‚≠ê']
            };

            const energyTexts = currentLanguage === 'zh' ? energyTextsZh : energyTextsEn;
            const recommendations = currentLanguage === 'zh' ? recommendationsZh : recommendationsEn;

            const html = `
                <strong>${energyTexts[level]}</strong><br><br>
                üí° ${currentLanguage === 'zh' ? 'Âª∫Ë≠∞' : 'Recommendations'}Ôºö${recommendations[level].join(' ‚Ä¢ ')}
            `;

            document.getElementById('energyRecommendation').innerHTML = html;
            document.getElementById('energyRecommendation').style.display = 'block';
            addXP(20);
        }

        // ========== Êó•Á®ãÁ≥ªÁµ± ==========
        function renderRoutines() {
            morningRoutine = morningRoutine.filter(item => typeof item === 'string' && item.trim().length > 0);
            eveningRoutine = eveningRoutine.filter(item => typeof item === 'string' && item.trim().length > 0);
            
            localStorage.setItem('morningRoutine', JSON.stringify(morningRoutine));
            localStorage.setItem('eveningRoutine', JSON.stringify(eveningRoutine));

            document.getElementById('morningRoutine').innerHTML = morningRoutine.map((item, i) => `
                <div style="display: flex; align-items: center; gap: 8px; padding: 12px; background: rgba(80, 196, 196, 0.1); border-radius: 8px; margin: 8px 0;">
                    <input type="checkbox" onchange="handleRoutineCheck('morning', ${i})" style="width: 20px; height: 20px; cursor: pointer;">
                    <span style="flex: 1;">${item}</span>
                    <button class="btn btn-secondary" onclick="deleteMorningRoutine(${i})" style="padding: 5px 10px; margin: 0; font-size: 0.8em;">üóëÔ∏è</button>
                </div>
            `).join('');

            document.getElementById('eveningRoutine').innerHTML = eveningRoutine.map((item, i) => `
                <div style="display: flex; align-items: center; gap: 8px; padding: 12px; background: rgba(80, 196, 196, 0.1); border-radius: 8px; margin: 8px 0;">
                    <input type="checkbox" onchange="handleRoutineCheck('evening', ${i})" style="width: 20px; height: 20px; cursor: pointer;">
                    <span style="flex: 1;">${item}</span>
                    <button class="btn btn-secondary" onclick="deleteEveningRoutine(${i})" style="padding: 5px 10px; margin: 0; font-size: 0.8em;">üóëÔ∏è</button>
                </div>
            `).join('');
        }

        function handleRoutineCheck(type, index) {
            const encourageZh = ['üåü ÂæàÂ•ΩÔºÅÂ†ÖÊåÅ‰∏ãÂéªÔºÅ', '‚ú® ‰Ω†Âú®ÁÖßÈ°ßËá™Â∑±ÔºÅ', 'üí™ ÊØè‰∏ÄÊ≠•ÈÉΩÁÆóÊï∏ÔºÅ', 'üéØ ÂÆåÊàê‰∫Ü‰∏ÄÈ†ÖÔºÅ'];
            const encourageEn = ['üåü Great! Keep going!', '‚ú® You are taking care of yourself!', 'üí™ Every step counts!', 'üéØ One done!'];
            const encouragement = currentLanguage === 'zh' ? encourageZh : encourageEn;
            
            const msg = encouragement[Math.floor(Math.random() * encouragement.length)];
            document.getElementById('emotionalText').textContent = msg;
            document.getElementById('emotionalMessage').style.display = 'block';
            setTimeout(() => {
                document.getElementById('emotionalMessage').style.display = 'none';
            }, 3000);
            
            addXP(10);
        }

        function addMorningRoutine() {
            const input = document.getElementById('newMorningInput');
            if (input.value.trim()) {
                morningRoutine.push(input.value);
                localStorage.setItem('morningRoutine', JSON.stringify(morningRoutine));
                input.value = '';
                renderRoutines();
                addXP(15);
            }
        }

        function addEveningRoutine() {
            const input = document.getElementById('newEveningInput');
            if (input.value.trim()) {
                eveningRoutine.push(input.value);
                localStorage.setItem('eveningRoutine', JSON.stringify(eveningRoutine));
                input.value = '';
                renderRoutines();
                addXP(15);
            }
        }

        function deleteMorningRoutine(index) {
            morningRoutine.splice(index, 1);
            localStorage.setItem('morningRoutine', JSON.stringify(morningRoutine));
            renderRoutines();
        }

        function deleteEveningRoutine(index) {
            eveningRoutine.splice(index, 1);
            localStorage.setItem('eveningRoutine', JSON.stringify(eveningRoutine));
            renderRoutines();
        }

        // ========== ‰ªªÂãôÁ≥ªÁµ± ==========
        function addTask() {
            const input = document.getElementById('newTaskInput');
            if (input.value.trim()) {
                tasks.push({ text: input.value, completed: false, date: new Date().toDateString() });
                localStorage.setItem('tasks', JSON.stringify(tasks));
                input.value = '';
                renderTasks();
                showEmotionalMessage('completion');
                addXP(10);
            }
        }

        function toggleTask(index) {
            tasks[index].completed = !tasks[index].completed;
            localStorage.setItem('tasks', JSON.stringify(tasks));
            renderTasks();
            if (tasks[index].completed) {
                showEmotionalMessage('completion');
                addXP(50);
            }
        }

        function deleteTask(index) {
            tasks.splice(index, 1);
            localStorage.setItem('tasks', JSON.stringify(tasks));
            renderTasks();
        }

        function openTaskBreakdown() {
            const selected = tasks.find((t, i) => !t.completed);
            if (!selected) {
                alert(currentLanguage === 'zh' ? 'Ë´ãÂÖàÈÅ∏Êìá‰∏ÄÂÄãÊú™ÂÆåÊàêÁöÑ‰ªªÂãô' : 'Please select an incomplete task first');
                return;
            }
            currentBreakdownTask = selected;
            breakdownSteps = [];
            document.getElementById('taskStepsList').innerHTML = '';
            document.getElementById('newStepInput').value = '';
            document.getElementById('taskBreakdownModal').style.display = 'block';
        }

        function addTaskStep() {
            const input = document.getElementById('newStepInput');
            if (input.value.trim()) {
                breakdownSteps.push(input.value.trim());
                input.value = '';
                renderTaskSteps();
            }
        }

        function renderTaskSteps() {
            const container = document.getElementById('taskStepsList');
            if (breakdownSteps.length === 0) {
                container.innerHTML = `<p style="text-align: center; color: var(--text-secondary);">${currentLanguage === 'zh' ? 'ÈÇÑÊ≤íÊúâÊ≠•È©ü' : 'No steps yet'}</p>`;
                return;
            }
            container.innerHTML = breakdownSteps.map((step, i) => `
                <div class="task-step-item">
                    <span>${i + 1}. ${step}</span>
                    <button class="btn btn-secondary" onclick="removeTaskStep(${i});" style="padding: 5px 10px; font-size: 0.8em;">üóëÔ∏è</button>
                </div>
            `).join('');
        }

        function removeTaskStep(index) {
            breakdownSteps.splice(index, 1);
            renderTaskSteps();
        }

        function confirmTaskBreakdown() {
            if (breakdownSteps.length === 0) {
                alert(currentLanguage === 'zh' ? 'Ë´ãËá≥Â∞ëÊ∑ªÂä†‰∏ÄÂÄãÊ≠•È©ü' : 'Please add at least one step');
                return;
            }
            
            tasks = tasks.filter(t => t !== currentBreakdownTask);
            breakdownSteps.forEach(step => {
                tasks.push({ text: step, completed: false, date: new Date().toDateString(), parent: currentBreakdownTask.text });
            });
            localStorage.setItem('tasks', JSON.stringify(tasks));
            renderTasks();
            closeTaskBreakdown();
            addXP(20);
        }

        function closeTaskBreakdown() {
            document.getElementById('taskBreakdownModal').style.display = 'none';
            currentBreakdownTask = null;
            breakdownSteps = [];
        }

        function renderTasks() {
            const container = document.getElementById('taskList');
            if (tasks.length === 0) {
                container.innerHTML = `<p style="text-align: center; color: var(--text-secondary);">${currentLanguage === 'zh' ? 'ÈÇÑÊ≤íÊúâ‰ªªÂãô„ÄÇÊ∑ªÂä†Á¨¨‰∏ÄÂÄãÂêßÔºÅ' : 'No tasks yet. Add your first one!'}</p>`;
                document.getElementById('taskProgress').style.width = '0%';
                return;
            }

            const completed = tasks.filter(t => t.completed).length;
            const percentage = (completed / tasks.length) * 100;

            container.innerHTML = tasks.map((task, i) => `
                <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: ${task.completed ? 'rgba(127, 207, 192, 0.15)' : 'rgba(74, 144, 226, 0.08)'}; border-radius: 8px; margin: 8px 0; text-decoration: ${task.completed ? 'line-through' : 'none'};">
                    <input type="checkbox" ${task.completed ? 'checked' : ''} onchange="toggleTask(${i})" style="width: 18px; height: 18px; cursor: pointer;">
                    <span style="flex: 1;">${task.parent ? '‚îú‚îÄ ' : ''}${task.text}</span>
                    <button class="btn btn-secondary" onclick="deleteTask(${i});" style="padding: 6px 12px; font-size: 0.85em; margin: 0;">üóëÔ∏è</button>
                </div>
            `).join('');

            document.getElementById('taskProgress').style.width = percentage + '%';
        }

        // ========== Ë®àÊôÇÂô®Á≥ªÁµ± ==========
        function resetTimerInput() {
            document.getElementById('timerMinutes').value = '25';
            timeLeft = 25 * 60;
            updateTimerDisplay();
        }

        function openAlarmSelection() {
            const modal = document.getElementById('alarmSelectionModal');
            const listContainer = document.getElementById('alarmOptionsList');
            
            listContainer.innerHTML = Object.entries(alarmSoundsConfig).map(([key, config]) => `
                <div class="alarm-option ${currentAlarmSound === key ? 'selected' : ''}" onclick="selectAlarm('${key}')">
                    ${config.name}
                </div>
            `).join('');
            
            modal.style.display = 'block';
        }

        function selectAlarm(sound) {
            currentAlarmSound = sound;
            document.querySelectorAll('.alarm-option').forEach(el => el.classList.remove('selected'));
            event.target.classList.add('selected');
            setTimeout(() => {
                document.getElementById('alarmSelectionModal').style.display = 'none';
            }, 300);
        }

        function testAlarmSound() {
            playAlarmSound(0.3);
        }

        function playAlarmSound(volume) {
            const config = alarmSoundsConfig[currentAlarmSound];
            if (!config) return;

            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                if (config.isSequence) {
                    let time = audioContext.currentTime;
                    config.sequence.forEach(note => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        gainNode.connect(audioContext.destination);
                        oscillator.connect(gainNode);
                        
                        gainNode.gain.setValueAtTime(volume, time);
                        oscillator.frequency.value = note.freq;
                        oscillator.type = 'sine';
                        
                        oscillator.start(time);
                        oscillator.stop(time + note.dur);
                        time += note.dur;
                    });
                } else {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    gainNode.connect(audioContext.destination);
                    oscillator.connect(gainNode);
                    
                    gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
                    oscillator.frequency.value = config.freq;
                    oscillator.type = 'sine';
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + config.duration);
                }
            } catch (e) {
                console.log('Audio playback not supported');
            }
        }

        function startTimer() {
            const inputMinutes = parseInt(document.getElementById('timerMinutes').value);
            if (inputMinutes < 1 || inputMinutes > 60) {
                alert(currentLanguage === 'zh' ? 'Ë´ãËº∏ÂÖ•1-60ÂàÜÈêò' : 'Please enter 1-60 minutes');
                return;
            }

            timerDuration = inputMinutes * 60;
            timeLeft = timerDuration;

            document.getElementById('startTimerBtn').classList.add('hidden');
            document.getElementById('stopTimerBtn').classList.remove('hidden');
            document.getElementById('timerMinutes').disabled = true;

            updateTimerDisplay();

            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    document.getElementById('startTimerBtn').classList.remove('hidden');
                    document.getElementById('stopTimerBtn').classList.add('hidden');
                    document.getElementById('timerMinutes').disabled = false;
                    
                    const volume = document.getElementById('volumeSlider').value / 100;
                    playAlarmSound(volume * 0.5);
                    
                    document.getElementById('timerMessage').innerHTML = `<div class="emotional-feedback positive" style="display: block;">üéâ ${currentLanguage === 'zh' ? 'ÂÆåÊàê‰∫ÜÔºÅ‰ºëÊÅØ‰∏Ä‰∏ãÂêß' : 'Done! Take a break'}</div>`;
                    
                    addXP(Math.min(100, inputMinutes * 10));
                    stats.totalMinutes += inputMinutes;
                    localStorage.setItem('stats', JSON.stringify(stats));
                    timeLeft = timerDuration;
                }
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
            document.getElementById('startTimerBtn').classList.remove('hidden');
            document.getElementById('stopTimerBtn').classList.add('hidden');
            document.getElementById('timerMinutes').disabled = false;
            timeLeft = timerDuration;
            updateTimerDisplay();
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timerDisplay').textContent = 
                String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0');

            const progress = ((timerDuration - timeLeft) / timerDuration) * 100;
            document.getElementById('timerProgress').style.width = progress + '%';
        }

        // ========== ÊÉÖÁ∑íÁ≥ªÁµ± ==========
        function logEmotion(emotion) {
            emotionLog.push({ 
                emotion, 
                time: new Date().toLocaleTimeString(currentLanguage === 'zh' ? 'zh-TW' : 'en-US'),
                date: new Date().toLocaleDateString(currentLanguage === 'zh' ? 'zh-TW' : 'en-US')
            });
            localStorage.setItem('emotionLog', JSON.stringify(emotionLog));
            renderEmotionLog();
            showEmotionalMessage('completion');
            addXP(20);
        }

        function deleteEmotionLog(index) {
            emotionLog.splice(index, 1);
            localStorage.setItem('emotionLog', JSON.stringify(emotionLog));
            renderEmotionLog();
        }

        function renderEmotionLog() {
            const emotionMapZh = { happy: 'üòä ÈñãÂøÉ', calm: 'üòå Âπ≥Èùú', sad: 'üò¢ Èõ£ÈÅé', anxious: 'üò∞ ÁÑ¶ÊÖÆ' };
            const emotionMapEn = { happy: 'üòä Happy', calm: 'üòå Calm', sad: 'üò¢ Sad', anxious: 'üò∞ Anxious' };
            const emotionMap = currentLanguage === 'zh' ? emotionMapZh : emotionMapEn;
            const container = document.getElementById('emotionLog');

            if (emotionLog.length === 0) {
                container.innerHTML = `<p style="text-align: center; color: var(--text-secondary);">${currentLanguage === 'zh' ? 'ÈÇÑÊ≤íÊúâË®òÈåÑ„ÄÇÈñãÂßãË®òÈåÑ‰Ω†ÁöÑÊÉÖÁ∑íÂêßÔºÅ' : 'No records yet. Start logging your emotions!'}</p>`;
                return;
            }

            container.innerHTML = emotionLog.slice(-10).map((log, i) => `
                <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: rgba(80, 196, 196, 0.1); border-radius: 8px; margin: 8px 0;">
                    <span style="flex: 1;">${emotionMap[log.emotion]} ‚Äî ${log.date} ${log.time}</span>
                    <button class="btn btn-secondary" onclick="deleteEmotionLog(${emotionLog.length - 10 + i});" style="padding: 5px 10px; margin: 0; font-size: 0.8em;">üóëÔ∏è</button>
                </div>
            `).reverse().join('');
        }

        function sendCompletedReportToEmail() {
            const email = document.getElementById('emotionEmailInput').value;
            
            if (!email) {
                alert(currentLanguage === 'zh' ? 'Ë´ãËº∏ÂÖ•ÈÉµÁÆ±Âú∞ÂùÄ' : 'Please enter email address');
                return;
            }

            let reportContent = currentLanguage === 'zh' ? '===== ADHD ÂÆåÊï¥ÊàêÂ∞±Â†±Âëä =====' : '===== ADHD Complete Achievement Report =====';
            reportContent += '\n\n';

            reportContent += (currentLanguage === 'zh' ? '‚≠ê Áï∂ÂâçÊàêÂ∞±:\n' : '‚≠ê Current Achievements:\n');
            reportContent += (currentLanguage === 'zh' ? 'Á≠âÁ¥ö: Lv.' : 'Level: Lv.') + stats.level + '\n';
            reportContent += 'XP: ' + stats.xp + '/100\n';
            reportContent += (currentLanguage === 'zh' ? 'ÈÄ£Á∫åÊàêÂäüÊó•: ' : 'Consecutive Days: ') + stats.streak + '\n';
            reportContent += (currentLanguage === 'zh' ? 'Á∏ΩÊ≠£ÂøµÂëºÂê∏ÂàÜÈêòÊï∏: ' : 'Total Breathing Minutes: ') + stats.totalMinutes + '\n\n';

            reportContent += (currentLanguage === 'zh' ? '‚úÖ ‰ªªÂãôÁÆ°ÁêÜ:\n' : '‚úÖ Task Management:\n');
            reportContent += (currentLanguage === 'zh' ? 'Â∑≤ÂÆåÊàê: ' : 'Completed: ') + tasks.filter(t => t.completed).length + '\n';
            reportContent += (currentLanguage === 'zh' ? 'ÈÄ≤Ë°å‰∏≠: ' : 'In Progress: ') + tasks.filter(t => !t.completed).length + '\n\n';

            reportContent += (currentLanguage === 'zh' ? 'üí≠ ÊÉÖÁ∑íÊó•Ë™å:\n' : 'üí≠ Emotion Journal:\n');
            if (emotionLog.length > 0) {
                const emotionMapZh = { happy: 'üòä ÈñãÂøÉ', calm: 'üòå Âπ≥Èùú', sad: 'üò¢ Èõ£ÈÅé', anxious: 'üò∞ ÁÑ¶ÊÖÆ' };
                const emotionMapEn = { happy: 'üòä Happy', calm: 'üòå Calm', sad: 'üò¢ Sad', anxious: 'üò∞ Anxious' };
                const emotionMap = currentLanguage === 'zh' ? emotionMapZh : emotionMapEn;
                const emotionCounts = {};
                emotionLog.forEach(log => {
                    emotionCounts[log.emotion] = (emotionCounts[log.emotion] || 0) + 1;
                });
                Object.keys(emotionCounts).forEach(emotion => {
                    reportContent += `${emotionMap[emotion]}: ${emotionCounts[emotion]} ${currentLanguage === 'zh' ? 'Ê¨°' : 'times'}\n`;
                });
            } else {
                reportContent += (currentLanguage === 'zh' ? 'Êö´ÁÑ°ÊÉÖÁ∑íË®òÈåÑ\n' : 'No emotion records\n');
            }

            const mailtoLink = `mailto:${email}?subject=${encodeURIComponent(currentLanguage === 'zh' ? 'ADHDÂÆåÊï¥ÊàêÂ∞±Â†±Âëä' : 'ADHD Complete Report')}&body=${encodeURIComponent(reportContent)}`;
            window.location.href = mailtoLink;
        }

        // ========== ÁôÇÁôíÂ∑•ÂÖ∑ ==========
        function toggleBreathing() {
            const circle = document.getElementById('breathingCircle');
            const text = document.getElementById('breathText');

            if (isBreathingAnimating) {
                isBreathingAnimating = false;
                circle.classList.remove('animating');
                text.innerHTML = currentLanguage === 'zh' ? 'ÈªûÊìäÈñãÂßã<br>ÂëºÂê∏Á∑¥Áøí' : 'Click to Start<br>Breathing';
            } else {
                isBreathingAnimating = true;
                circle.classList.add('animating');
                text.innerHTML = currentLanguage === 'zh' ? 'Ë∑üËëóÂúìÂΩ¢ÂëºÂê∏<br>ÂÆåÂÖ®ÊîæÈ¨Ü' : 'Breathe with Circle<br>Fully Relax';
                startBreathingSession();
            }
        }

        function startBreathingSession() {
            const breathingStages = ['Âê∏Ê∞£...', 'Â±èÊ∞£...', 'ÂëºÊ∞£...'];
            const breathingStagesEn = ['Inhale...', 'Hold...', 'Exhale...'];
            const stages = currentLanguage === 'zh' ? breathingStages : breathingStagesEn;
            let cycleCount = 0;
            let stageIndex = 0;
            const text = document.getElementById('breathText');

            const cycle = setInterval(() => {
                if (!isBreathingAnimating) {
                    clearInterval(cycle);
                    return;
                }

                text.innerHTML = stages[stageIndex];
                stageIndex++;

                if (stageIndex >= 3) {
                    stageIndex = 0;
                    cycleCount++;
                    if (cycleCount >= 5) {
                        clearInterval(cycle);
                        isBreathingAnimating = false;
                        document.getElementById('breathingCircle').classList.remove('animating');
                        text.innerHTML = currentLanguage === 'zh' ? 'üòå ‰Ω†ÂÅöÂæóÂæàÂ•Ω' : 'üòå You did great';
                        addXP(50);
                        showEmotionalMessage('completion');
                    }
                }
            }, 4000);
        }

        function openCognitiveRestructuring() {
            const question = currentLanguage === 'zh' ? 'ÂëäË®¥ÊàëÔºå‰Ω†ÁèæÂú®ÁöÑË≤†Èù¢ÊÉ≥Ê≥ïÊòØ‰ªÄÈ∫ºÔºü' : 'What negative thought are you having?';
            const inputModal = document.getElementById('customInputModal');
            
            if (!document.getElementById('customInputModal')) {
                const modal = document.createElement('div');
                modal.id = 'customInputModal';
                modal.style.cssText = 'display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--bg-secondary); padding: 30px; border-radius: 16px; border: 1px solid var(--accent-teal); text-align: center; z-index: 2001; min-width: 350px; box-shadow: 0 20px 60px rgba(0,0,0,0.5);';
                modal.innerHTML = `
                    <p style="color: var(--text-primary); margin-bottom: 15px;" id="customInputQuestion">${question}</p>
                    <input type="text" id="customInputField" style="width: 100%; padding: 12px; border: 1px solid var(--accent-teal); border-radius: 8px; background: var(--bg-primary); color: var(--text-primary); margin-bottom: 15px;">
                    <div style="display: flex; gap: 10px;">
                        <button class="btn" onclick="submitCognitiveInput();" style="flex: 1; margin: 0;">Á¢∫Ë™ç</button>
                        <button class="btn btn-secondary" onclick="closeCognitiveInputModal();" style="flex: 1; margin: 0;">ÂèñÊ∂à</button>
                    </div>
                `;
                document.body.appendChild(modal);
            }

            document.getElementById('customInputModal').style.display = 'block';
            document.getElementById('customInputField').focus();
        }

        function submitCognitiveInput() {
            const thought = document.getElementById('customInputField').value.trim();
            if (!thought) return;

            closeCognitiveInputModal();

            const contentZh = `
                <div style="text-align: left; line-height: 1.8;">
                    <div style="margin-bottom: 20px;">
                        <strong style="color: var(--accent-teal); font-size: 1.1em;">üí≠ ‰Ω†ÁöÑË≤†Èù¢ÊÉ≥Ê≥ï</strong><br/>
                        <span style="color: var(--text-primary);">${thought}</span>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <strong style="color: var(--accent-teal); font-size: 1.1em;">‚ú® ÈáçÊñ∞Ê°ÜÊû∂Âåñ</strong><br/>
                        <ul style="margin-left: 20px; color: var(--text-primary);">
                            <li>ÈÄôÂÄãÊÉ≥Ê≥ïÂè™ÊòØÊö´ÊôÇÁöÑÁãÄÊÖãÔºå‰∏ç‰ª£Ë°®Ê∞∏‰πÖ‰∫ãÂØ¶</li>
                            <li>ÊàëÊúâÂÖãÊúçÈ°û‰ººÂõ∞Èõ£ÁöÑËÉΩÂäõÂíåÁ∂ìÈ©ó</li>
                            <li>Ë®±Â§ö‰∫∫Âú®È°û‰ººÊÉÖÊ≥Å‰∏ã‰πüÊúâÂêåÊ®£ÁöÑÊÉ≥Ê≥ï</li>
                            <li>ÊàëÂèØ‰ª•Êé°ÂèñÂØ¶ÈöõË°åÂãï‰æÜÊîπËÆäÈÄôÂÄãÁãÄÊ≥Å</li>
                            <li>‰∏çÂÆåÁæéÊòØ‰∫∫‰πãÂ∏∏ÊÉÖÔºåÈÄô‰∏ç‰ª£Ë°®ÊàëÂ§±Êïó‰∫Ü</li>
                        </ul>
                    </div>
                    <div>
                        <strong style="color: var(--accent-teal); font-size: 1.1em;">üí™ ‰Ω†ÂèØ‰ª•ÂÅöÁöÑ</strong><br/>
                        <span style="color: var(--text-primary);">Ê∑±ÂëºÂê∏3Ê¨°ÔºåÊèêÈÜíËá™Â∑±ÈÄôÂè™ÊòØ‰∏ÄÊôÇÁöÑÊÑüÂèó„ÄÇÁï∂‰Ω†Ê∫ñÂÇôÂ•ΩÊôÇÔºåÂèØ‰ª•Êé°Âèñ‰∏ÄÂÄãÂ∞èÊ≠•È©ü‰æÜÊîπËÆäÈÄôÂÄãÁãÄÊ≥Å„ÄÇ</span>
                    </div>
                </div>
            `;

            const contentEn = `
                <div style="text-align: left; line-height: 1.8;">
                    <div style="margin-bottom: 20px;">
                        <strong style="color: var(--accent-teal); font-size: 1.1em;">üí≠ Your Negative Thought</strong><br/>
                        <span style="color: var(--text-primary);">${thought}</span>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <strong style="color: var(--accent-teal); font-size: 1.1em;">‚ú® Reframing</strong><br/>
                        <ul style="margin-left: 20px; color: var(--text-primary);">
                            <li>This thought is temporary, not a permanent fact</li>
                            <li>I have the ability to overcome similar challenges</li>
                            <li>Many others have similar thoughts in similar situations</li>
                            <li>I can take concrete action to improve this</li>
                            <li>Imperfection is human; it doesn't mean I've failed</li>
                        </ul>
                    </div>
                    <div>
                        <strong style="color: var(--accent-teal); font-size: 1.1em;">üí™ What You Can Do</strong><br/>
                        <span style="color: var(--text-primary);">Take 3 deep breaths and remind yourself this is temporary. When ready, take one small step to improve the situation.</span>
                    </div>
                </div>
            `;

            const content = currentLanguage === 'zh' ? contentZh : contentEn;
            document.getElementById('cognitiveResultBody').innerHTML = content;
            document.getElementById('cognitiveResultModal').classList.add('active');
            addXP(50);
        }

        function closeCognitiveInputModal() {
            const modal = document.getElementById('customInputModal');
            if (modal) modal.style.display = 'none';
        }

        function closeCognitiveResultModal() {
            document.getElementById('cognitiveResultModal').classList.remove('active');
        }

        function startGrounding() {
            const stepsZh = [
                'üëÄ ÁúãË¶ã 5 ‰ª∂Êù±Ë•ø\nË´ãÂõõËôïÁúãÁúãÔºåË™™Âá∫5‰ª∂‰Ω†ËÉΩÁúãÂà∞ÁöÑÊù±Ë•ø',
                'üëÇ ËÅΩË¶ã 4 Á®ÆËÅ≤Èü≥\nÈùúËÅΩÁâáÂàªÔºåÂØüË¶∫Âë®Âúç4ÂÄã‰∏çÂêåÁöÑËÅ≤Èü≥',
                'üëê Ëß∏Êë∏ 3 Ê®£Áâ©È´î\nÊé•Ëß∏‰∏¶ÊÑüÂèó3‰ª∂‰∏çÂêåË≥™Âú∞ÁöÑÁâ©È´î',
                'üëÉ ËÅûÂà∞ 2 Á®ÆÂë≥ÈÅì\nÊâæÂà∞2ÂÄã‰Ω†ËÉΩËÅûÂà∞ÁöÑÊ∞£Âë≥',
                'üëÖ ÂöêÂà∞ 1 Ê®£Êù±Ë•ø\nÂìÅÂöê‰∏ÄÂÄãÈ£üÁâ©ÊàñÈ£≤ÊñôÁöÑÂë≥ÈÅì'
            ];

            const stepsEn = [
                'üëÄ See 5 things\nLook around and name 5 things you can see',
                'üëÇ Hear 4 sounds\nListen and notice 4 different sounds around you',
                'üëê Touch 3 things\nFeel and touch 3 objects with different textures',
                'üëÉ Smell 2 things\nFind and smell 2 different scents',
                'üëÖ Taste 1 thing\nTaste a food or drink'
            ];

            const steps = currentLanguage === 'zh' ? stepsZh : stepsEn;
            groundingCurrentStep = 0;
            displayGroundingStep(steps);
        }

        function displayGroundingStep(steps) {
            if (groundingCurrentStep >= steps.length) {
                const finishMsg = currentLanguage === 'zh' 
                    ? 'üåç Êé•Âú∞ÂÆåÊàêÔºÅ\n\n‰Ω†Â∑≤Á∂ìÂõûÂà∞Ê≠§Âàª„ÄÇÊÑüÂèó‰Ω†ÁöÑÂëºÂê∏ÔºåÊÑüÂèóË∫´È´îËàáÂú∞Èù¢ÁöÑÈÄ£Áµê„ÄÇ‰Ω†ÂæàÂÆâÂÖ®„ÄÇ'
                    : 'üåç Grounding complete!\n\nYou are back in the present. Feel your breath, feel your body connected to the ground. You are safe.';
                
                document.getElementById('groundingModal').classList.remove('active');
                alert(finishMsg);
                addXP(50);
                showEmotionalMessage('completion');
                return;
            }

            const step = steps[groundingCurrentStep];
            document.getElementById('groundingStep').textContent = step;
            document.getElementById('groundingNextBtn').textContent = 
                groundingCurrentStep === steps.length - 1 
                    ? (currentLanguage === 'zh' ? 'ÂÆåÊàê' : 'Complete')
                    : (currentLanguage === 'zh' ? '‰∏ã‰∏ÄÊ≠•' : 'Next');
            
            document.getElementById('groundingModal').classList.add('active');
        }

        function nextGroundingStep() {
            const steps = currentLanguage === 'zh' 
                ? ['üëÄ ÁúãË¶ã 5 ‰ª∂Êù±Ë•ø\nË´ãÂõõËôïÁúãÁúãÔºåË™™Âá∫5‰ª∂‰Ω†ËÉΩÁúãÂà∞ÁöÑÊù±Ë•ø', 'üëÇ ËÅΩË¶ã 4 Á®ÆËÅ≤Èü≥\nÈùúËÅΩÁâáÂàªÔºåÂØüË¶∫Âë®Âúç4ÂÄã‰∏çÂêåÁöÑËÅ≤Èü≥', 'üëê Ëß∏Êë∏ 3 Ê®£Áâ©È´î\nÊé•Ëß∏‰∏¶ÊÑüÂèó3‰ª∂‰∏çÂêåË≥™Âú∞ÁöÑÁâ©È´î', 'üëÉ ËÅûÂà∞ 2 Á®ÆÂë≥ÈÅì\nÊâæÂà∞2ÂÄã‰Ω†ËÉΩËÅûÂà∞ÁöÑÊ∞£Âë≥', 'üëÖ ÂöêÂà∞ 1 Ê®£Êù±Ë•ø\nÂìÅÂöê‰∏ÄÂÄãÈ£üÁâ©ÊàñÈ£≤ÊñôÁöÑÂë≥ÈÅì']
                : ['üëÄ See 5 things\nLook around and name 5 things you can see', 'üëÇ Hear 4 sounds\nListen and notice 4 different sounds around you', 'üëê Touch 3 things\nFeel and touch 3 objects with different textures', 'üëÉ Smell 2 things\nFind and smell 2 different scents', 'üëÖ Taste 1 thing\nTaste a food or drink'];
            
            groundingCurrentStep++;
            displayGroundingStep(steps);
        }

        // ========== È£≤È£üÁ≥ªÁµ± ==========
        function updateNutritionPage() {
            const nutritionDataZh = {
                priority: [
                    "üê† Â•ßÁ±≥Âä†-3ËÑÇËÇ™ÈÖ∏ÔºàDHA/EPAÔºâ- ÊîπÂñÑË™çÁü•ÂäüËÉΩÂíåÊ≥®ÊÑèÂäõ",
                    "ü•õ ËõãÁôΩË≥™ - Á©©ÂÆöË°ÄÁ≥ñÔºåÂ¢ûÂº∑ÂéªÁî≤ËÖé‰∏äËÖ∫Á¥†ÂàÜÊ≥å",
                    "ü•¨ BÊóèÁ∂≠ÁîüÁ¥†ÔºàB6„ÄÅB12„ÄÅËëâÈÖ∏Ôºâ- ÊîØÊåÅÁ•ûÁ∂ìÂÇ≥ÈÅûÁâ©Ë≥™ÂêàÊàê",
                    "‚ö° ÈãÖÂíåÈéÇ - ‰øÉÈÄ≤Á•ûÁ∂ìÂÅ•Â∫∑ÂíåÊÉÖÁ∑íË™øÁØÄ",
                    "üçì ÊäóÊ∞ßÂåñÂäëÔºàËéìÊûú„ÄÅÊ∑±Ëâ≤Ëî¨ËèúÔºâ- ‰øùË≠∑Â§ßËÖ¶Á¥∞ËÉû",
                    "ü•î Ë§áÈõúÁ¢≥Ê∞¥ÂåñÂêàÁâ© - Êèê‰æõÁ©©ÂÆöÁöÑËÉΩÈáè"
                ],
                eatingOrder: [
                    "1Ô∏è‚É£ ÂÖàÂêÉÁ∫ñÁ∂≠ - Ëî¨Ëèú„ÄÅÂÖ®Á©ÄÁâ©„ÄÅË±ÜÈ°û",
                    "2Ô∏è‚É£ ÂÜçÂêÉËõãÁôΩË≥™ÂíåËÑÇËÇ™ - ËÇâÈ°û„ÄÅÈ≠ö„ÄÅÂ†ÖÊûú„ÄÅ‰π≥Ë£ΩÂìÅ",
                    "3Ô∏è‚É£ ÊúÄÂæåÂêÉÁ¢≥Ê∞¥ÂåñÂêàÁâ© - Á±≥È£Ø„ÄÅÈ∫µÊ¢ù„ÄÅÈ∫µÂåÖ"
                ],
                avoid: [
                    "üö´ È´òÁ≥ñÈ£üÂìÅ - Â∞éËá¥Ë°ÄÁ≥ñÊ≥¢ÂãïÂíåÊ≥®ÊÑèÂäõ‰∏ãÈôç",
                    "üö´ ÈÅéÂ∫¶Âä†Â∑•È£üÂìÅ - Âê´Êúâ‰∫∫Â∑•Ê∑ªÂä†ÂäëÂíåÈò≤ËÖêÂäë",
                    "üö´ Âê´ÂíñÂï°Âõ†ÈÅéÂ§öÈ£≤Êñô - ÂèØËÉΩÂä†ÈáçÁÑ¶ÊÖÆÂíå‰∏çÁ©©ÂÆö",
                    "üö´ ÂèçÂºèËÑÇËÇ™ - Â∞çÂ§ßËÖ¶ÂíåÂøÉËáüÊúâÂÆ≥",
                    "üö´ ‰∫∫Â∑•Ëâ≤Á¥†ÂíåÈ¶ôÊñô - ÂèØËÉΩËß∏ÁôºË°åÁÇ∫ÂïèÈ°å",
                    "üö´ ÈÅéÈáèÈπΩÂàÜ - ÂΩ±ÈüøË°ÄÂ£ìÂíåÁ•ûÁ∂ìÁ≥ªÁµ±"
                ]
            };

            const nutritionDataEn = {
                priority: [
                    "üê† Omega-3 Fatty Acids (DHA/EPA) - Improve cognitive function and attention",
                    "ü•õ Protein - Stabilize blood sugar, enhance norepinephrine secretion",
                    "ü•¨ B Vitamins (B6, B12, Folate) - Support neurotransmitter synthesis",
                    "‚ö° Zinc and Magnesium - Promote brain health and mood regulation",
                    "üçì Antioxidants (Berries, dark vegetables) - Protect brain cells",
                    "ü•î Complex Carbohydrates - Provide stable energy"
                ],
                eatingOrder: [
                    "1Ô∏è‚É£ Eat fiber first - Vegetables, whole grains, legumes",
                    "2Ô∏è‚É£ Then eat protein and fat - Meat, fish, nuts, dairy",
                    "3Ô∏è‚É£ Finally eat carbohydrates - Rice, pasta, bread"
                ],
                avoid: [
                    "üö´ High-sugar foods - Cause blood sugar spikes and attention drops",
                    "üö´ Ultra-processed foods - Contain artificial additives and preservatives",
                    "üö´ Excessive caffeine beverages - May worsen anxiety and instability",
                    "üö´ Trans fats - Harmful to brain and heart",
                    "üö´ Artificial dyes and flavorings - May trigger behavioral issues",
                    "üö´ Excessive salt - Affects blood pressure and nervous system"
                ]
            };

            const data = currentLanguage === 'zh' ? nutritionDataZh : nutritionDataEn;

            document.getElementById('nutritionPriority').innerHTML = data.priority.map(item => 
                `<div style="padding: 12px; background: rgba(80, 196, 196, 0.1); border-radius: 8px; margin: 8px 0; color: var(--text-primary);">${item}</div>`
            ).join('');

            document.getElementById('eatingOrder').innerHTML = data.eatingOrder.map(item =>
                `<div style="padding: 12px; background: rgba(74, 144, 226, 0.1); border-radius: 8px; margin: 8px 0; color: var(--text-primary); border-left: 4px solid var(--accent-blue);">${item}</div>`
            ).join('');

            document.getElementById('nutritionAvoid').innerHTML = data.avoid.map(item =>
                `<div style="padding: 12px; background: rgba(217, 122, 147, 0.1); border-radius: 8px; margin: 8px 0; color: var(--text-primary);">${item}</div>`
            ).join('');
        }

        // ========== ÊÉÖÁ∑íÂèçÈ•ã ==========
        function showEmotionalMessage(type) {
            const messages = emotionalMessages[type];
            const msg = messages[Math.floor(Math.random() * messages.length)];
            
            document.getElementById('emotionalText').textContent = msg;
            document.getElementById('emotionalMessage').style.display = 'block';

            setTimeout(() => {
                document.getElementById('emotionalMessage').style.display = 'none';
            }, 5000);
        }

        // ========== XPÈÄöÁü• ==========
        function showXPNotification(amount) {
            const notification = document.createElement('div');
            notification.className = 'xp-notification';
            notification.textContent = `+${amount} XP`;
            document.getElementById('xpNotificationContainer').appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // ========== ÈÄ≤Â∫¶Á≥ªÁµ± ==========
        function addXP(amount) {
            stats.xp += amount;
            showXPNotification(amount);

            if (stats.xp >= 100) {
                stats.level++;
                stats.xp -= 100;
                showLevelUpModal();
            }
            localStorage.setItem('stats', JSON.stringify(stats));
            updateTopStats();
        }

        function showLevelUpModal() {
            const modal = document.getElementById('levelUpModal');
            const levelText = document.getElementById('levelUpText');
            const messageText = document.getElementById('levelUpMessage');

            levelText.textContent = (currentLanguage === 'zh' ? 'ÂçáÁ¥öÂà∞ ' : 'Level Up to ') + 'Lv.' + stats.level + '!';
            const levelUpMessages = emotionalMessages.levelUp;
            messageText.textContent = levelUpMessages[Math.floor(Math.random() * levelUpMessages.length)];

            modal.style.display = 'block';

            setTimeout(() => {
                modal.style.display = 'none';
            }, 3000);
        }

        // ========== ÂàùÂßãÂåñ ==========
        updateAllText();
        updateTopStats();
        updateNutritionPage();
        renderRoutines();
    </script>
</body>
</html>
