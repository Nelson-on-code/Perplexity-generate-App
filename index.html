<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADHD Focus Helper Pro Max</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-primary: #141b27;
            --bg-secondary: #1f2b3a;
            --text-primary: #e8eef7;
            --text-secondary: #8b98ad;
            --accent-blue: #4a90e2;
            --accent-teal: #50c4c4;
            --accent-rose: #d97a93;
            --success: #7ecfc0;
            --warning: #f7d794;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            flex: 1;
        }

        .nav-header {
            margin-top: 60px;
        }

        .home-page {
            display: flex;
            flex-direction: column;
            gap: 30px;
            padding: 40px 20px;
        }

        .home-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .home-header h1 {
            font-size: 2.8em;
            margin-bottom: 10px;
            color: var(--accent-blue);
            text-shadow: 0 2px 10px rgba(74, 144, 226, 0.2);
        }

        .home-header p {
            font-size: 1.1em;
            color: var(--text-secondary);
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .feature-card {
            background: linear-gradient(135deg, rgba(74, 144, 226, 0.1), rgba(80, 196, 196, 0.1));
            border: 1px solid rgba(80, 196, 196, 0.3);
            border-radius: 16px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-teal);
            box-shadow: 0 10px 30px rgba(80, 196, 196, 0.15);
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-teal), var(--accent-rose));
        }

        .feature-number {
            font-size: 2.5em;
            font-weight: bold;
            color: var(--accent-blue);
            margin-bottom: 10px;
            opacity: 0.3;
        }

        .feature-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
            color: var(--accent-teal);
        }

        .feature-card h3 {
            font-size: 1.3em;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .feature-card p {
            color: var(--text-secondary);
            line-height: 1.6;
            font-size: 0.95em;
            margin-bottom: 15px;
        }

        .feature-button {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-teal));
            color: var(--text-primary);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .feature-button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(74, 144, 226, 0.3);
        }

        .handwriting-note {
            background: rgba(217, 122, 147, 0.05);
            border-left: 4px solid var(--accent-rose);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-style: italic;
            color: var(--text-secondary);
            position: relative;
        }

        .handwriting-note::before {
            content: 'âœï¸';
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 1.5em;
            opacity: 0.3;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(31, 43, 58, 0.5);
            border-radius: 12px;
            border: 1px solid rgba(80, 196, 196, 0.2);
        }

        .nav-header h2 {
            font-size: 1.8em;
            color: var(--accent-blue);
        }

        .nav-back-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--accent-teal);
            color: var(--accent-teal);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .nav-back-btn:hover {
            background: var(--accent-teal);
            color: var(--bg-primary);
        }

        .section {
            background: linear-gradient(135deg, rgba(31, 43, 58, 0.6), rgba(20, 27, 39, 0.6));
            border: 1px solid rgba(80, 196, 196, 0.2);
            padding: 30px;
            margin: 20px 0;
            border-radius: 16px;
            backdrop-filter: blur(10px);
        }

        .section h3 {
            color: var(--accent-teal);
            margin-bottom: 20px;
            font-size: 1.4em;
        }

        .question-group {
            background: rgba(74, 144, 226, 0.08);
            padding: 20px;
            margin: 15px 0;
            border-radius: 12px;
            border-left: 4px solid var(--accent-blue);
        }

        .question-group label {
            display: block;
            color: var(--text-primary);
            margin-bottom: 12px;
            font-weight: 500;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: linear-gradient(to right, var(--accent-blue), var(--accent-teal));
            outline: none;
            cursor: pointer;
        }

        .btn {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-teal));
            color: var(--text-primary);
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 10px 0;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(74, 144, 226, 0.3);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            border: 1px solid var(--accent-teal);
            color: var(--accent-teal);
        }

        .score-card {
            background: linear-gradient(135deg, rgba(80, 196, 196, 0.15), rgba(74, 144, 226, 0.15));
            border: 1px solid rgba(80, 196, 196, 0.3);
            padding: 40px;
            border-radius: 16px;
            text-align: center;
            margin: 20px 0;
        }

        .score-number {
            font-size: 4em;
            font-weight: bold;
            color: var(--accent-teal);
            margin: 20px 0;
        }

        .score-level {
            font-size: 1.5em;
            color: var(--text-primary);
            margin-bottom: 15px;
        }

        .score-advice {
            color: var(--text-secondary);
            line-height: 1.8;
            font-size: 1.05em;
        }

        .emotional-feedback {
            background: linear-gradient(135deg, rgba(217, 122, 147, 0.1), rgba(127, 207, 192, 0.1));
            border-left: 4px solid var(--accent-rose);
            border-right: 4px solid var(--accent-teal);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            line-height: 1.8;
            display: none;
        }

        .emotional-feedback.positive {
            border-left-color: var(--accent-teal);
            border-right-color: var(--accent-teal);
        }

        .emotional-feedback.encouraging {
            border-left-color: var(--accent-rose);
            border-right-color: var(--accent-rose);
        }

        .feedback-icon {
            margin-right: 10px;
            font-size: 1.3em;
        }

        .skill-card {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-teal) 100%);
            color: var(--text-primary);
            padding: 20px;
            border-radius: 12px;
            margin: 12px 0;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.2);
        }

        .skill-card:hover {
            transform: translateX(5px);
            box-shadow: 0 6px 20px rgba(80, 196, 196, 0.3);
        }

        .skill-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 1.05em;
        }

        .progress-bar {
            background: rgba(80, 196, 196, 0.2);
            height: 12px;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-teal), var(--accent-blue));
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .timer-display {
            text-align: center;
            font-size: 4em;
            font-weight: bold;
            color: var(--accent-teal);
            font-family: 'Courier New', monospace;
            margin: 30px 0;
            text-shadow: 0 2px 10px rgba(80, 196, 196, 0.2);
        }

        .breathing-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-teal), var(--accent-blue));
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(80, 196, 196, 0.2);
            transition: all 0.3s;
        }

        .breathing-circle:hover {
            box-shadow: 0 6px 25px rgba(80, 196, 196, 0.35);
        }

        .breathing-circle.animating {
            transition: transform 4s ease-in-out, box-shadow 4s ease-in-out;
        }
        
        .breathing-circle.inhale {
            transform: scale(1.3);
            box-shadow: 0 8px 30px rgba(80, 196, 196, 0.4);
        }
        
        .breathing-circle.hold {
            /* å±æ°£æ™‚ä¿æŒå¤§å° */
        }
        
        .breathing-circle.exhale {
            transform: scale(1);
            box-shadow: 0 4px 20px rgba(80, 196, 196, 0.2);
        }

        .breathing-text {
            color: var(--text-primary);
            text-align: center;
            font-size: 1.2em;
            font-weight: 600;
        }

        .xp-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-teal));
            color: var(--text-primary);
            padding: 20px 30px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(74, 144, 226, 0.3);
            animation: slideIn 0.5s ease, slideOut 0.5s ease 2.5s;
            z-index: 1000;
            font-weight: 600;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        .language-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 10px;
            z-index: 999;
        }

        .lang-btn {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-teal));
            color: var(--text-primary);
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .lang-btn.active {
            box-shadow: 0 4px 12px rgba(80, 196, 196, 0.4);
        }

        .lang-btn:not(.active) {
            background: var(--bg-secondary);
            border: 1px solid var(--accent-teal);
            color: var(--accent-teal);
        }

        .top-stats-card {
            background: linear-gradient(135deg, rgba(80, 196, 196, 0.15), rgba(74, 144, 226, 0.15));
            border: 1px solid rgba(80, 196, 196, 0.3);
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 25px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }

        .stat-mini {
            text-align: center;
        }

        .stat-mini-value {
            font-size: 2em;
            font-weight: bold;
            color: var(--accent-teal);
            margin-bottom: 5px;
        }

        .stat-mini-label {
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        .hidden {
            display: none !important;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            border: 1px solid var(--accent-teal);
            border-radius: 16px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            text-align: center;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-content h3 {
            color: var(--accent-teal);
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .modal-content p {
            color: var(--text-primary);
            line-height: 1.8;
            margin: 15px 0;
            font-size: 1.05em;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 30px;
        }

        .modal-buttons button {
            flex: 1;
            max-width: 200px;
        }

        .alarm-selection-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-secondary);
            border: 1px solid var(--accent-teal);
            border-radius: 16px;
            padding: 30px;
            z-index: 2001;
            min-width: 350px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .alarm-selection-modal h3 {
            color: var(--accent-teal);
            margin-bottom: 20px;
            text-align: center;
        }

        .alarm-option {
            background: rgba(80, 196, 196, 0.1);
            border: 1px solid rgba(80, 196, 196, 0.3);
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-primary);
            font-weight: 500;
        }

        .alarm-option:hover {
            background: rgba(80, 196, 196, 0.2);
            border-color: var(--accent-teal);
            transform: translateX(5px);
        }

        .alarm-option.selected {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-teal));
            border-color: var(--accent-teal);
            color: var(--text-primary);
        }

        .task-breakdown-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-secondary);
            border: 1px solid var(--accent-teal);
            border-radius: 16px;
            padding: 30px;
            z-index: 2001;
            min-width: 400px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            max-height: 80vh;
            overflow-y: auto;
        }

        .task-breakdown-modal h3 {
            color: var(--accent-teal);
            margin-bottom: 20px;
            text-align: center;
        }

        .task-step-input {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .task-step-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--accent-teal);
            border-radius: 8px;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .task-step-list {
            background: rgba(74, 144, 226, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            max-height: 250px;
            overflow-y: auto;
        }

        .task-step-item {
            padding: 10px;
            background: rgba(80, 196, 196, 0.1);
            border-radius: 6px;
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--text-primary);
        }

        .task-step-item button {
            padding: 5px 10px;
            font-size: 0.8em;
            margin: 0;
        }

        @media (max-width: 768px) {
            .features-grid {
                grid-template-columns: 1fr;
            }

            .home-header h1 {
                font-size: 2em;
            }

            .timer-display {
                font-size: 3em;
            }

            .task-breakdown-modal {
                min-width: 90%;
            }
        }
    </style>
</head>
<body>
    <!-- èªè¨€åˆ‡æ› -->
    <div class="language-toggle">
        <button class="lang-btn active" onclick="switchLanguage('zh')" id="langZh">ä¸­æ–‡</button>
        <button class="lang-btn" onclick="switchLanguage('en')" id="langEn">English</button>
    </div>

    <!-- XP é€šçŸ¥å®¹å™¨ -->
    <div id="xpNotificationContainer"></div>

    <!-- å‡ç´šå½ˆçª—å®¹å™¨ -->
    <div id="levelUpModal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(135deg, var(--accent-blue), var(--accent-teal)); padding: 40px; border-radius: 20px; text-align: center; z-index: 2000; box-shadow: 0 20px 60px rgba(0,0,0,0.4);">
        <div style="color: var(--text-primary); font-size: 3em; margin-bottom: 15px;">ğŸ‰</div>
        <div style="color: var(--text-primary); font-size: 2.5em; font-weight: bold; margin-bottom: 10px;" id="levelUpText"></div>
        <div style="color: var(--text-primary); font-size: 1.1em; font-style: italic;" id="levelUpMessage"></div>
    </div>

    <!-- é¬§éˆ´é¸æ“‡ Modal -->
    <div id="alarmSelectionModal" class="alarm-selection-modal">
        <h3 id="alarmSelectTitle"></h3>
        <div id="alarmOptionsList"></div>
    </div>

    <!-- ä»»å‹™æ‹†åˆ† Modal -->
    <div id="taskBreakdownModal" class="task-breakdown-modal">
        <h3 id="taskBreakdownTitle"></h3>
        <p style="color: var(--text-secondary); margin-bottom: 15px;" id="taskBreakdownDesc"></p>
        <div class="task-step-input">
            <input type="text" id="newStepInput" placeholder="" style="width: 100%;">
            <button class="btn" onclick="addTaskStep();" style="padding: 10px 15px; margin: 0; width: auto;">â•</button>
        </div>
        <div class="task-step-list" id="taskStepsList"></div>
        <div class="modal-buttons">
            <button class="btn" onclick="confirmTaskBreakdown();" id="confirmTaskBtn"></button>
            <button class="btn btn-secondary" onclick="closeTaskBreakdown();" id="cancelTaskBtn"></button>
        </div>
    </div>

    <!-- æ¥åœ°ç·´ç¿’ Modal -->
    <div id="groundingModal" class="modal-overlay">
        <div class="modal-content" style="min-width: 400px; text-align: center;">
            <h3 id="groundingTitle"></h3>
            <div id="groundingContent" style="min-height: 150px; display: flex; align-items: center; justify-content: center;">
                <p id="groundingStep" style="font-size: 1.2em; color: var(--accent-teal); font-weight: 600; white-space: pre-line;"></p>
            </div>
            <div class="modal-buttons">
                <button class="btn" id="groundingNextBtn" onclick="nextGroundingStep()"></button>
            </div>
        </div>
    </div>

    <!-- èªçŸ¥é‡æ§‹çµæœ Modal -->
    <div id="cognitiveResultModal" class="modal-overlay">
        <div class="modal-content" style="min-width: 450px; text-align: left;">
            <h3 id="cognitiveResultTitle"></h3>
            <div id="cognitiveResultBody" style="background: rgba(74, 144, 226, 0.1); padding: 20px; border-radius: 8px; margin: 20px 0;"></div>
            <div class="modal-buttons">
                <button class="btn" id="closeCognitiveBtn" onclick="closeCognitiveResultModal()"></button>
            </div>
        </div>
    </div>

    <!-- èªçŸ¥é‡æ§‹è¼¸å…¥ Modal -->
    <div id="customInputModal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--bg-secondary); padding: 30px; border-radius: 16px; border: 1px solid var(--accent-teal); text-align: center; z-index: 2001; min-width: 350px; box-shadow: 0 20px 60px rgba(0,0,0,0.5);">
        <p style="color: var(--text-primary); margin-bottom: 15px;" id="customInputQuestion"></p>
        <input type="text" id="customInputField" style="width: 100%; padding: 12px; border: 1px solid var(--accent-teal); border-radius: 8px; background: var(--bg-primary); color: var(--text-primary); margin-bottom: 15px;">
        <div style="display: flex; gap: 10px;">
            <button class="btn" onclick="submitCognitiveInput();" style="flex: 1; margin: 0;" id="submitCognitiveBtn"></button>
            <button class="btn btn-secondary" onclick="closeCognitiveInputModal();" style="flex: 1; margin: 0;" id="cancelCognitiveBtn"></button>
        </div>
    </div>

    <div class="container">
        <!-- ========== é¦–é  ========== -->
        <div id="homePage" class="page active">
            <div class="home-page">
                <div class="home-header">
                    <h1>ğŸ§  ADHD Focus Helper Pro Max</h1>
                    <p style="font-size: 0.9em; color: var(--text-secondary); margin-bottom: 15px;">ADHD å°ˆæ³¨å°åŠ©æ‰‹ Pro Max</p>
                    <p id="headerSubtitle"></p>
                </div>

                <!-- é€²åº¦è¿½è¹¤å¡ç‰‡ -->
                <div class="top-stats-card">
                    <div class="stat-mini">
                        <div class="stat-mini-value" id="topLevel">Lv. 1</div>
                        <div class="stat-mini-label" id="levelLabel"></div>
                    </div>
                    <div class="stat-mini">
                        <div class="stat-mini-value" id="topXp">0</div>
                        <div class="stat-mini-label" id="xpLabel">XP</div>
                    </div>
                    <div class="stat-mini">
                        <div class="stat-mini-value" id="topStreak">0</div>
                        <div class="stat-mini-label" id="streakLabel"></div>
                    </div>
                    <div class="stat-mini">
                        <div class="stat-mini-value" id="topMinutes">0</div>
                        <div class="stat-mini-label" id="minutesLabel"></div>
                    </div>
                </div>

                <div class="handwriting-note">
                    <span id="usageNote"></span>
                </div>

                <div class="features-grid" id="featuresGrid">
                    <!-- 1. å¿«é€Ÿè©•ä¼° -->
                    <div class="feature-card" onclick="goToPage('assessmentPage')">
                        <div class="feature-number">1ï¸âƒ£</div>
                        <div class="feature-icon">ğŸ“‹</div>
                        <h3 id="f1Title"></h3>
                        <p id="f1Desc"></p>
                        <button class="feature-button" id="f1Btn"></button>
                    </div>

                    <!-- 2. èƒ½é‡æª¢æ¸¬ -->
                    <div class="feature-card" onclick="goToPage('energyPage')">
                        <div class="feature-number">2ï¸âƒ£</div>
                        <div class="feature-icon">âš¡</div>
                        <h3 id="f2Title"></h3>
                        <p id="f2Desc"></p>
                        <button class="feature-button" id="f2Btn"></button>
                    </div>

                    <!-- 3. æ—¥ç¨‹å®‰æ’ -->
                    <div class="feature-card" onclick="goToPage('routinePage')">
                        <div class="feature-number">3ï¸âƒ£</div>
                        <div class="feature-icon">ğŸ“…</div>
                        <h3 id="f3Title"></h3>
                        <p id="f3Desc"></p>
                        <button class="feature-button" id="f3Btn"></button>
                    </div>

                    <!-- 4. ä»»å‹™ç®¡ç† -->
                    <div class="feature-card" onclick="goToPage('taskPage')">
                        <div class="feature-number">4ï¸âƒ£</div>
                        <div class="feature-icon">âœ…</div>
                        <h3 id="f4Title"></h3>
                        <p id="f4Desc"></p>
                        <button class="feature-button" id="f4Btn"></button>
                    </div>

                    <!-- 5. ç•ªèŒ„é˜ -->
                    <div class="feature-card" onclick="goToPage('timerPage')">
                        <div class="feature-number">5ï¸âƒ£</div>
                        <div class="feature-icon">â±ï¸</div>
                        <h3 id="f5Title"></h3>
                        <p id="f5Desc"></p>
                        <button class="feature-button" id="f5Btn"></button>
                    </div>

                    <!-- 6. ç™‚ç™’å·¥å…· -->
                    <div class="feature-card" onclick="goToPage('healingPage')">
                        <div class="feature-number">6ï¸âƒ£</div>
                        <div class="feature-icon">ğŸ§˜</div>
                        <h3 id="f6Title"></h3>
                        <p id="f6Desc"></p>
                        <button class="feature-button" id="f6Btn"></button>
                    </div>

                    <!-- 7. æƒ…ç·’æ—¥èªŒ -->
                    <div class="feature-card" onclick="goToPage('emotionPage')">
                        <div class="feature-number">7ï¸âƒ£</div>
                        <div class="feature-icon">ğŸ’­</div>
                        <h3 id="f7Title"></h3>
                        <p id="f7Desc"></p>
                        <button class="feature-button" id="f7Btn"></button>
                    </div>

                    <!-- 8. é£²é£Ÿå»ºè­° -->
                    <div class="feature-card" onclick="goToPage('nutritionPage')">
                        <div class="feature-number">8ï¸âƒ£</div>
                        <div class="feature-icon">ğŸ¥—</div>
                        <h3 id="f8Title"></h3>
                        <p id="f8Desc"></p>
                        <button class="feature-button" id="f8Btn"></button>
                    </div>
                </div>

                <div class="handwriting-note">
                    ğŸ’¡ <span id="tipsNote"></span>
                </div>
            </div>
        </div>

        <!-- ========== è©•ä¼°é é¢ ========== -->
        <div id="assessmentPage" class="page">
            <div class="nav-header" style="margin-top: 80px;">
                <h2>ğŸ“‹ <span id="assessTitle"></span></h2>
                <button class="nav-back-btn" onclick="backToHomeFrom('assessmentPage')">â† <span id="backBtn"></span></button>
            </div>

            <div class="section">
                <h3 id="assessDesc1"></h3>
                <p style="color: var(--text-secondary); margin-bottom: 20px;" id="assessDesc2"></p>

                <div id="assessmentQuestions"></div>

                <button class="btn" id="submitAssessmentBtn" onclick="submitAssessment();" style="margin-bottom: 20px;"></button>
            </div>

            <div id="assessmentResult" class="hidden"></div>

            <div class="emotional-feedback positive" id="assessmentEmotionalMessage" style="display: none;">
                <span class="feedback-icon">âœ¨</span>
                <span id="assessmentEmotionalText"></span>
            </div>

            <div class="emotional-feedback positive" id="emotionalMessage" style="display: none;">
                <span class="feedback-icon">âœ¨</span>
                <span id="emotionalText"></span>
            </div>

            <div class="section" id="assessmentReportSection" style="display: none; margin-top: 30px;">
                <h3 id="reportTitle"></h3>
                <p style="color: var(--text-secondary); margin-bottom: 15px;" id="reportTime"></p>
                <div id="reportContent" style="background: rgba(74, 144, 226, 0.08); padding: 15px; border-radius: 8px; margin: 15px 0;"></div>

                <h3 style="margin-top:25px; font-size:1.2em;" id="historyTitle"></h3>
                <div id="assessmentHistoryList" style="margin-top:10px;"></div>
                
                <div style="background: rgba(217, 122, 147, 0.1); border-left: 4px solid var(--accent-rose); padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <p style="color: var(--text-secondary); font-size: 0.9em; margin: 0;" id="emailWarning"></p>
                </div>

                <div style="display: flex; gap: 10px; margin: 15px 0;">
                    <input type="email" id="emailInput" placeholder="" style="flex: 1; padding: 12px; border: 1px solid var(--accent-teal); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary);">
                    <button class="btn" onclick="sendReportToEmail();" id="sendReportBtn">ğŸ“§</button>
                </div>

                <button class="nav-back-btn" onclick="backToHomeFrom('assessmentPage')" style="width: 100%; text-align: center; margin: 20px 0;">â† <span id="bottomBackBtn"></span></button>
            </div>
        </div>

        <!-- ========== èƒ½é‡æª¢æ¸¬é é¢ ========== -->
        <div id="energyPage" class="page">
            <div class="nav-header" style="margin-top: 80px;">
                <h2>âš¡ <span id="energyTitle"></span></h2>
                <button class="nav-back-btn" onclick="backToHomeFrom('energyPage')">â† <span id="backBtn2"></span></button>
            </div>

            <div class="section">
                <h3 id="energyQuestion"></h3>
                <p style="color: var(--text-secondary); margin-bottom: 20px;" id="energyDesc"></p>

                <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin: 30px 0;">
                    <div style="text-align: center;">
                        <button class="btn energy-btn" id="energyBtn1" onclick="setEnergy(1)" style="width: 100%; padding: 20px; transition: all 0.3s ease;">ğŸ”´<br><span id="energyLabel1"></span></button>
                    </div>
                    <div style="text-align: center;">
                        <button class="btn btn-secondary energy-btn" id="energyBtn2" onclick="setEnergy(2)" style="width: 100%; padding: 20px; transition: all 0.3s ease;">ğŸŸ¡<br><span id="energyLabel2"></span></button>
                    </div>
                    <div style="text-align: center;">
                        <button class="btn btn-secondary energy-btn" id="energyBtn3" onclick="setEnergy(3)" style="width: 100%; padding: 20px; transition: all 0.3s ease;">ğŸŸ¢<br><span id="energyLabel3"></span></button>
                    </div>
                    <div style="text-align: center;">
                        <button class="btn btn-secondary energy-btn" id="energyBtn4" onclick="setEnergy(4)" style="width: 100%; padding: 20px; transition: all 0.3s ease;">ğŸ’š<br><span id="energyLabel4"></span></button>
                    </div>
                    <div style="text-align: center;">
                        <button class="btn btn-secondary energy-btn" id="energyBtn5" onclick="setEnergy(5)" style="width: 100%; padding: 20px; transition: all 0.3s ease;">âœ¨<br><span id="energyLabel5"></span></button>
                    </div>
                </div>

                <div id="energyRecommendation" class="skill-card" style="display: none;"></div>
            </div>

            <button class="nav-back-btn" onclick="backToHomeFrom('energyPage')" style="width: 100%; text-align: center; margin: 20px 0;">â† <span id="bottomBackBtn2"></span></button>
        </div>

        <!-- ========== æ—¥ç¨‹å®‰æ’é é¢ ========== -->
        <div id="routinePage" class="page">
            <div class="nav-header">
                <h2>ğŸ“… <span id="routineTitle"></span></h2>
                <button class="nav-back-btn" onclick="backToHomeFrom('routinePage')">â† <span id="backBtn3"></span></button>
            </div>

            <div class="section">
                <h3>ğŸŒ… <span id="morningLabel"></span></h3>
                <p style="color: var(--text-secondary); margin-bottom: 15px;" id="morningDesc"></p>
                <div id="morningRoutine"></div>

                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <input type="text" id="newMorningInput" placeholder="" style="flex: 1; padding: 10px; border: 1px solid var(--accent-teal); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary); font-size: 0.9em;">
                    <button class="btn" onclick="addMorningRoutine();" style="padding: 10px 15px; margin: 0; font-size: 0.9em;">â•</button>
                </div>
            </div>

            <div class="section">
                <h3>ğŸŒ™ <span id="eveningLabel"></span></h3>
                <p style="color: var(--text-secondary); margin-bottom: 15px;" id="eveningDesc"></p>
                <div id="eveningRoutine"></div>

                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <input type="text" id="newEveningInput" placeholder="" style="flex: 1; padding: 10px; border: 1px solid var(--accent-teal); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary); font-size: 0.9em;">
                    <button class="btn" onclick="addEveningRoutine();" style="padding: 10px 15px; margin: 0; font-size: 0.9em;">â•</button>
                </div>
            </div>

            <div class="emotional-feedback encouraging" id="routineMessage">
                <span class="feedback-icon">ğŸ’œ</span>
                <span id="routineMessageText"></span>
            </div>

            <button class="nav-back-btn" onclick="backToHomeFrom('routinePage')" style="width: 100%; text-align: center; margin: 20px 0;">â† <span id="bottomBackBtn3"></span></button>
        </div>

        <!-- ========== ä»»å‹™ç®¡ç†é é¢ ========== -->
        <div id="taskPage" class="page">
            <div class="nav-header">
                <h2>âœ… <span id="taskTitle"></span></h2>
                <button class="nav-back-btn" onclick="backToHomeFrom('taskPage')">â† <span id="backBtn4"></span></button>
            </div>

            <div class="section">
                <h3 id="taskDesc1"></h3>
                <div style="display: flex; gap: 10px; margin: 20px 0;">
                    <input type="text" id="newTaskInput" placeholder="" style="flex: 1; padding: 12px; border: 1px solid var(--accent-teal); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary);">
                    <button class="btn" onclick="addTask();" style="margin: 0;" id="addTaskBtn"></button>
                    <button class="btn btn-secondary" id="breakdownTaskBtn" onclick="openTaskBreakdown();" style="margin: 0; display: flex; align-items: center; justify-content: center; gap: 6px;" title="å°‡ä»»å‹™æ‹†æˆå°æ­¥é©Ÿ">
                        <span style="font-size: 1.2em;">ğŸ“Š</span>
                        <span id="breakdownBtn"></span>
                    </button>
                </div>

                <div id="taskList"></div>
                <div class="progress-bar">
                    <div class="progress-fill" id="taskProgress" style="width: 0%;"></div>
                </div>
            </div>

            <div class="emotional-feedback positive" id="taskFeedback" style="display: none;">
                <span class="feedback-icon">ğŸ‰</span>
                <span id="taskFeedbackText"></span>
            </div>

            <button class="nav-back-btn" onclick="backToHomeFrom('taskPage')" style="width: 100%; text-align: center; margin: 20px 0;">â† <span id="bottomBackBtn4"></span></button>
        </div>

        <!-- ========== ç•ªèŒ„é˜é é¢ ========== -->
        <div id="timerPage" class="page">
            <div class="nav-header">
                <h2>â±ï¸ <span id="timerTitle"></span></h2>
                <button class="nav-back-btn" onclick="backToHomeFrom('timerPage')">â† <span id="backBtn5"></span></button>
            </div>

            <div class="section">
                <h3 id="timerDesc1"></h3>
                
                <div style="display: flex; gap: 12px; margin: 20px 0; align-items: center; justify-content: center; flex-wrap: wrap;">
                    <label style="color: var(--text-secondary);" id="timerMinLabel"></label>
                    <input type="number" id="timerMinutes" min="1" max="60" value="25" style="width: 80px; padding: 10px; border: 1px solid var(--accent-teal); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary); text-align: center; font-size: 1em; font-weight: bold;">
                    <button class="btn btn-secondary" onclick="resetTimerInput();" style="padding: 10px 15px; margin: 0;" id="resetTimerBtn"></button>
                    <button class="btn btn-secondary" onclick="openAlarmSelection();" style="padding: 10px 15px; margin: 0;" id="alarmBtn">ğŸ””</button>
                    <button class="btn btn-secondary" onclick="testAlarmSound();" style="padding: 10px 15px; margin: 0;" id="testAlarmBtn">ğŸ”Š</button>
                    <input type="range" id="volumeSlider" min="0" max="100" value="70" style="width: 100px; margin: 0 10px;">
                </div>

                <div class="timer-display" id="timerDisplay">25:00</div>
                <div style="text-align: center; margin: 30px 0;">
                    <button class="btn" id="startTimerBtn" onclick="startTimer();"></button>
                    <button class="btn btn-secondary hidden" id="stopTimerBtn" onclick="stopTimer();"></button>
                </div>

                <div class="progress-bar">
                    <div class="progress-fill" id="timerProgress" style="width: 0%;"></div>
                </div>

                <div id="timerMessage" style="display: none; margin-top: 20px;"></div>
            </div>

            <button class="nav-back-btn" onclick="backToHomeFrom('timerPage')" style="width: 100%; text-align: center; margin: 20px 0;">â† <span id="bottomBackBtn5"></span></button>
        </div>

        <!-- ========== ç™‚ç™’å·¥å…·é é¢ ========== -->
        <div id="healingPage" class="page">
            <div class="nav-header" style="margin-top: 80px;">
                <h2>ğŸ§˜ <span id="healingTitle"></span></h2>
                <button class="nav-back-btn" onclick="backToHomeFrom('healingPage')">â† <span id="backBtn6"></span></button>
            </div>

            <div class="section">
                <h3 id="breathingTitle"></h3>
                <p style="color: var(--text-secondary); margin-bottom: 20px;" id="breathingDesc"></p>
                <div style="text-align: center; margin: 40px 0;">
                    <div id="breathingCircle" class="breathing-circle" onclick="toggleBreathing();">
                        <div class="breathing-text" id="breathText"></div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3 id="cognitiveTitle"></h3>
                <p style="color: var(--text-secondary); margin-bottom: 15px;" id="cognitiveDesc"></p>
                <p style="color: var(--text-secondary); margin-bottom: 15px; font-size: 0.9em;" id="cognitiveScience"></p>
                <button class="btn" onclick="openCognitiveRestructuring();" id="cognitiveBtn"></button>
            </div>

            <div class="section">
                <h3 id="groundingTitle"></h3>
                <p style="color: var(--text-secondary); margin-bottom: 15px;" id="groundingDesc"></p>
                <p style="color: var(--text-secondary); margin-bottom: 15px; font-size: 0.9em;" id="groundingScience"></p>
                <button class="btn" onclick="startGrounding();" id="groundingBtn"></button>
            </div>

            <button class="nav-back-btn" onclick="backToHomeFrom('healingPage')" style="width: 100%; text-align: center; margin: 20px 0;">â† <span id="bottomBackBtn6"></span></button>
        </div>

        <!-- ========== æƒ…ç·’æ—¥èªŒé é¢ ========== -->
        <div id="emotionPage" class="page">
            <div class="nav-header">
                <h2>ğŸ’­ <span id="emotionTitle"></span></h2>
                <button class="nav-back-btn" onclick="backToHomeFrom('emotionPage')">â† <span id="backBtn7"></span></button>
            </div>

            <div class="section">
                <h3 id="emotionLogTitle"></h3>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin: 20px 0;">
                    <button class="btn" onclick="logEmotion('happy');" id="emotionBtn1"></button>
                    <button class="btn" onclick="logEmotion('calm');" id="emotionBtn2"></button>
                    <button class="btn" onclick="logEmotion('sad');" id="emotionBtn3"></button>
                    <button class="btn" onclick="logEmotion('anxious');" id="emotionBtn4"></button>
                </div>

                <div id="emotionLog" style="margin-top: 30px;"></div>
            </div>

            <div class="section" id="emotionReportSection" style="margin-top: 30px;">
                <h3 id="emotionReportTitle"></h3>
                <p style="color: var(--text-secondary); margin-bottom: 15px;" id="emotionReportDesc"></p>
                
                <div style="display: flex; gap: 10px; margin: 15px 0;">
                    <input type="email" id="emotionEmailInput" placeholder="" style="flex: 1; padding: 12px; border: 1px solid var(--accent-teal); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary);">
                    <button class="btn" onclick="sendCompletedReportToEmail();" id="sendEmotionReportBtn">ğŸ“§</button>
                </div>
            </div>

            <button class="nav-back-btn" onclick="backToHomeFrom('emotionPage')" style="width: 100%; text-align: center; margin: 20px 0;">â† <span id="bottomBackBtn7"></span></button>
        </div>

        <!-- ========== é£²é£Ÿå»ºè­°é é¢ ========== -->
        <div id="nutritionPage" class="page">
            <div class="nav-header" style="margin-top: 80px;">
                <h2>ğŸ¥— <span id="nutritionTitle"></span></h2>
                <button class="nav-back-btn" onclick="backToHomeFrom('nutritionPage')">â† <span id="backBtn8"></span></button>
            </div>

            <div class="section">
                <h3 id="nutritionDesc"></h3>
                <p style="color: var(--text-secondary); margin-bottom: 20px;" id="nutritionIntro"></p>
            </div>

            <div class="section">
                <h3 id="nutritionSection1"></h3>
                <div id="nutritionPriority"></div>
            </div>

            <div class="section">
                <h3 id="nutritionSection2"></h3>
                <p style="color: var(--text-secondary); margin-bottom: 15px;" id="eatingOrderDesc"></p>
                <div id="eatingOrder"></div>
            </div>

            <div class="section">
                <h3 id="nutritionSection3"></h3>
                <div id="nutritionAvoid"></div>
            </div>

            <div class="emotional-feedback positive">
                <span class="feedback-icon">ğŸ’š</span>
                <span id="nutritionMessage"></span>
            </div>

            <button class="nav-back-btn" onclick="backToHomeFrom('nutritionPage')" style="width: 100%; text-align: center; margin: 20px 0;">â† <span id="bottomBackBtn8"></span></button>
        </div>
    </div>

    <script>
        // ========== é…ç½® ==========
        const emotionalMessages = {
            assessment: [
                { zh: "âœ¨ ä»Šå¤©çš„ç‹€æ…‹æœ‰é»åˆ†å¿ƒï¼Œä½†é€™å¾ˆå¸¸è¦‹ï¼Œä¸ä»£è¡¨ä½ ä¸å¤ åŠªåŠ›", en: "âœ¨ Today's state is a bit distracted, but this is common, it doesn't mean you're not trying hard enough" },
                { zh: "ğŸŒŸ ä½ å‰›å‰›å®Œæˆäº†ä¸€ä»¶ä¸å®¹æ˜“çš„äº‹ï¼Œå°±ç®—åªæœ‰ 10 åˆ†é˜ï¼Œä¹Ÿç®—å‰é€²", en: "ğŸŒŸ You just completed something difficult, even if just 10 minutes, that's progress" },
                { zh: "ğŸ’« ç¬¬ 1 å¤©ï¼Œæˆ‘é™ªä½ é–‹å§‹", en: "ğŸ’« Day 1, I'm here with you" },
                { zh: "ğŸŒˆ ä»Šå¤©ä¸å®Œç¾ï¼Œä¹Ÿæ²’æœ‰é—œä¿‚", en: "ğŸŒˆ Today's not perfect, and that's okay" }
            ],
            completion: [
                { zh: "ğŸ‰ ä½ åšåˆ°äº†ï¼é€™å°±æ˜¯æˆé•·çš„æ¨£å­", en: "ğŸ‰ You did it! This is what growth looks like" },
                { zh: "âœ¨ æ¯ä¸€å€‹å‹¾é¸éƒ½æ˜¯ä½ çš„å‹åˆ©", en: "âœ¨ Every check is your victory" },
                { zh: "ğŸ’š ä½ åœ¨ç…§é¡§è‡ªå·±ï¼Œé€™å¾ˆé‡è¦", en: "ğŸ’š You're taking care of yourself, that's important" },
                { zh: "ğŸŒŸ ä»Šå¤©çš„ä½ æ¯”æ˜¨å¤©æ›´å¼·å¤§", en: "ğŸŒŸ Today's you is stronger than yesterday's you" }
            ],
            levelUp: [
                { zh: "ğŸŒŸ ä½ å‡ç´šäº†ï¼æ¯ä¸€æ­¥éƒ½åœ¨é€²æ­¥", en: "ğŸŒŸ You leveled up! Every step is progress" },
                { zh: "ğŸš€ æ­å–œå‡ç´šï¼ä½ çš„å …æŒåœ¨ç™¼å…‰", en: "ğŸš€ Congratulations! Your persistence is shining" },
                { zh: "ğŸ’« å¤ªæ£’äº†ï¼ä½ æ­£åœ¨è®Šå¼·", en: "ğŸ’« Awesome! You're getting stronger" },
                { zh: "âœ¨ å‡ç´šæˆåŠŸï¼ä½ åšå¾—éå¸¸å¥½", en: "âœ¨ Level up! You did great" }
            ]
        };

        // ä¸­è‹±æ–‡ç¿»è­¯å®Œæ•´ç‰ˆ
        const translations = {
            zh: {
                levelLabel: "ç­‰ç´š",
                xpLabel: "XP",
                streakLabel: "é€£çºŒæˆåŠŸæ—¥",
                minutesLabel: "ç¸½æ­£å¿µå‘¼å¸åˆ†é˜æ•¸",
                headerSubtitle: "ç”¨æº«æš–çš„é™ªä¼´ï¼Œæ‰“é€ å±¬æ–¼ä½ çš„å°ˆæ³¨ç¯€å¥",
                usageNote: "âœï¸ ä½¿ç”¨å»ºè­°ï¼šå¾ä¸Šåˆ°ä¸‹ä¾åºä½¿ç”¨æ•ˆæœæœ€ä½³ã€‚æ¯å€‹å·¥å…·éƒ½æ˜¯ç‚ºä½ é‡èº«æ‰“é€ çš„é™ªä¼´è€…ã€‚",
                tipsNote: "ä¸éœ€è¦ä¸€æ¬¡å…¨éƒ¨å®Œæˆã€‚é¸æ“‡å°ä½ æœ€æœ‰å¹«åŠ©çš„å·¥å…·ï¼Œå¾å°æ­¥é©Ÿé–‹å§‹ã€‚æ¯ä¸€å€‹é¸æ“‡éƒ½æ˜¯å°è‡ªå·±çš„æ„›ã€‚",
                f1Title: "å¿«é€Ÿè©•ä¼°", 
                f1Desc: "äº†è§£ä»Šå¤©çš„å°ˆæ³¨ç‹€æ…‹ã€‚10é“ç°¡å–®å•é¡Œï¼Œå¹«åŠ©ä½ èªè­˜è‡ªå·±çš„ç¯€å¥ã€‚", 
                f1Btn: "é–‹å§‹è©•ä¼° â†’",
                f2Title: "èƒ½é‡æª¢æ¸¬", 
                f2Desc: "é¸æ“‡ä½ çš„èƒ½é‡ç‹€æ…‹ï¼Œç³»çµ±æ¨è–¦åˆé©çš„ä»»å‹™é›£åº¦ã€‚è²¼å¿ƒçš„å·¥ä½œè² è¼‰å®‰æ’ã€‚", 
                f2Btn: "æª¢æ¸¬èƒ½é‡ â†’",
                f3Title: "æ¯æ—¥å°äº‹", 
                f3Desc: "æ—©æ™¨å’Œå‚æ™šçš„æº«å’Œå„€å¼ã€‚å»ºç«‹å¯æŒçºŒçš„ç¯€å¥ï¼Œä¸€æ­¥ä¸€æ­¥é‚å‘ç›®æ¨™ã€‚", 
                f3Btn: "å»ºç«‹ç¿’æ…£ â†’",
                f4Title: "ä»»å‹™ç®¡ç†", 
                f4Desc: "æŠŠå¤§ä»»å‹™æ‹†æˆå°æ­¥é©Ÿã€‚æ¯å€‹å‹¾é¸éƒ½æ˜¯ä½ çš„å‹åˆ©ã€‚", 
                f4Btn: "ç®¡ç†ä»»å‹™ â†’",
                f5Title: "ç•ªèŒ„é˜", 
                f5Desc: "è‡ªè¨‚æ™‚é–“çš„å°ˆæ³¨æ™‚å…‰ã€‚æ¯ä¸€ç§’éƒ½åœ¨ç´¯ç©ä½ çš„æˆå°±ã€‚", 
                f5Btn: "é–‹å§‹è¨ˆæ™‚ â†’",
                f6Title: "ç™‚ç™’å·¥å…·", 
                f6Desc: "æ­£å¿µå‘¼å¸ã€èªçŸ¥é‡æ§‹ã€æ¥åœ°ç·´ç¿’ã€‚åœ¨ç„¦æ…®æ™‚ï¼Œçµ¦è‡ªå·±ä¸€å€‹æ“æŠ±ã€‚", 
                f6Btn: "æ‰¾å›å¹³éœ â†’",
                f7Title: "æƒ…ç·’æ—¥èªŒ", 
                f7Desc: "è¨˜éŒ„æ¯ä¸€åˆ»çš„æƒ…ç·’ã€‚ç†è§£è‡ªå·±ï¼Œæ‰èƒ½æ›´å¥½åœ°ç…§é¡§è‡ªå·±ã€‚", 
                f7Btn: "è¨˜éŒ„æƒ…ç·’ â†’",
                f8Title: "é£²é£Ÿå»ºè­°", 
                f8Desc: "ç‚ºADHDé‡èº«æ‰“é€ çš„ç‡Ÿé¤Šæ–¹æ¡ˆã€‚æ­£ç¢ºçš„é£²é£Ÿèƒ½æå‡å°ˆæ³¨åŠ›å’Œç©©å®šæƒ…ç·’ã€‚", 
                f8Btn: "äº†è§£é£²é£Ÿ â†’",
                assessTitle: "å¿«é€Ÿè©•ä¼°",
                assessDesc1: "äº†è§£ä½ çš„å°ˆæ³¨ç‹€æ…‹",
                assessDesc2: "æ²’æœ‰å®Œç¾çš„å›ç­”ï¼Œåªæœ‰çœŸå¯¦çš„ä½ ã€‚é€™ä»½è©•ä¼°å¹«åŠ©æˆ‘å€‘æ›´äº†è§£ä½ çš„ç¯€å¥ã€‚",
                submitAssessmentBtn: "æäº¤è©•ä¼°",
                energyTitle: "èƒ½é‡æª¢æ¸¬",
                energyQuestion: "ä½ ç¾åœ¨çš„èƒ½é‡å¦‚ä½•ï¼Ÿ",
                energyDesc: "æ ¹æ“šä½ çš„èƒ½é‡ç‹€æ…‹ï¼Œæˆ‘å€‘æœƒæ¨è–¦åˆé©çš„ä»»å‹™é›£åº¦ã€‚",
                energyLabel1: "è¶…ä½", 
                energyLabel2: "è¼ƒä½", 
                energyLabel3: "ä¸­ç­‰", 
                energyLabel4: "å……è¶³", 
                energyLabel5: "çˆ†æ£š",
                routineTitle: "æ¯æ—¥å°äº‹",
                morningLabel: "æ—©æ™¨å„€å¼",
                morningDesc: "æº«å’Œåœ°é–‹å•Ÿä½ çš„ä¸€å¤©",
                eveningLabel: "å‚æ™šå„€å¼",
                eveningDesc: "æº«æŸ”åœ°é™ªä¼´ä½ é€²å…¥å¤œæ™š",
                routineMessageText: "é€™äº›ä¸æ˜¯ä»»å‹™ï¼Œè€Œæ˜¯å’Œè‡ªå·±çš„ç´„æœƒã€‚æ¯ä¸€æ­¥éƒ½åœ¨ç…§é¡§ä½ ã€‚",
                taskTitle: "ä»»å‹™ç®¡ç†",
                taskDesc1: "æŠŠå¤§ç›®æ¨™æ‹†æˆå°æ­¥é©Ÿ",
                addTaskBtn: "æ·»åŠ ",
                breakdownBtn: "æ‹†åˆ†",
                timerTitle: "ç•ªèŒ„é˜",
                timerDesc1: "è‡ªè¨‚æ™‚é–“çš„å°ˆæ³¨æ™‚å…‰",
                timerMinLabel: "åˆ†é˜:",
                resetTimerBtn: "é‡ç½®",
                startTimerBtn: "é–‹å§‹è¨ˆæ™‚",
                stopTimerBtn: "åœæ­¢è¨ˆæ™‚",
                healingTitle: "ç™‚ç™’å·¥å…·",
                breathingTitle: "æ­£å¿µå‘¼å¸",
                breathingDesc: "åœ¨ç„¦æ…®æ™‚ï¼Œå‘¼å¸å°±æ˜¯æœ€å¥½çš„å®‰æ’«ã€‚é€éè¦–è¦ºåŒ–å‘¼å¸å¾ªç’°ï¼Œå¹«åŠ©ä½ èª¿ç¯€ç¥ç¶“ç³»çµ±ï¼Œæ¸›å°‘å£“åŠ›å’Œç„¦æ…®ã€‚",
                breathingStart: "é»æ“Šé–‹å§‹\nå‘¼å¸ç·´ç¿’",
                breathingRelax: "è·Ÿè‘—åœ“å½¢å‘¼å¸\nå®Œå…¨æ”¾é¬†",
                cognitiveTitle: "èªçŸ¥é‡æ§‹ç·´ç¿’",
                cognitiveDesc: "æŠŠè² é¢æƒ³æ³•é‡å¡‘æˆåŠ›é‡ã€‚",
                cognitiveScience: "ğŸ§  ç§‘å­¸åŸºç¤ï¼šèªçŸ¥é‡æ§‹æ˜¯èªçŸ¥è¡Œç‚ºç™‚æ³•(CBT)çš„æ ¸å¿ƒæŠ€è¡“ã€‚ç ”ç©¶è¡¨æ˜ï¼Œé€éè­˜åˆ¥å’ŒæŒ‘æˆ°ä¸æº–ç¢ºçš„ä¿¡å¿µï¼Œå¯ä»¥é¡¯è‘—æ”¹å–„ç„¦æ…®ã€æŠ‘é¬±å’Œéåº¦æ€è€ƒã€‚é€™é …ç·´ç¿’å¹«åŠ©ä½ æ‰“ç ´è² é¢æ€ç¶­å¾ªç’°ï¼Œå»ºç«‹æ›´å¥åº·çš„å¿ƒç†æ¨¡å¼ã€‚",
                cognitiveBtn: "é–‹å§‹ç·´ç¿’",
                groundingTitle: "æ¥åœ°ç·´ç¿’ (5-4-3-2-1)",
                groundingDesc: "æ„Ÿå—ç•¶ä¸‹ï¼Œå›åˆ°æ­¤åˆ»ã€‚",
                groundingScience: "ğŸ§  ç§‘å­¸åŸºç¤ï¼š5-4-3-2-1 æ¥åœ°ç·´ç¿’æ˜¯ä¸€ç¨®æ„Ÿå®˜é‡å®šå‘æŠ€è¡“ï¼Œé€éé‹ç”¨ä½ çš„äº”ç¨®æ„Ÿå®˜ï¼Œèƒ½è¿…é€Ÿå•Ÿå‹•å‰¯äº¤æ„Ÿç¥ç¶“ç³»çµ±ï¼Œå¾è€ŒæŠµæŠ—ç„¦æ…®å¼•ç™¼çš„ã€Œæˆ°é¬¥æˆ–é€ƒé¿ã€åæ‡‰ã€‚é€™å€‹æŠ€å·§åœ¨æ•¸ç§’å…§å°±èƒ½å¹«åŠ©ä½ å›åˆ°ç¾åœ¨çš„æ™‚åˆ»ã€‚",
                groundingBtn: "é–‹å§‹æ¥åœ°",
                emotionTitle: "æƒ…ç·’æ—¥èªŒ",
                emotionLogTitle: "è¨˜éŒ„æ­¤åˆ»çš„æƒ…ç·’",
                emotionBtn1: "ğŸ˜Š é–‹å¿ƒ",
                emotionBtn2: "ğŸ˜Œ å¹³éœ",
                emotionBtn3: "ğŸ˜¢ é›£é",
                emotionBtn4: "ğŸ˜° ç„¦æ…®",
                backBtn: "è¿”å›é¦–é ",
                reportTitle: "ğŸ“„ è©•ä¼°å ±å‘Š",
                historyTitle: "æ­·æ¬¡è©•ä¼°è¨˜éŒ„",
                emailWarning: "âš ï¸ é‡è¦æç¤ºï¼šç•¶å‰æ‰€æœ‰ç´€éŒ„åªæœƒå„²å­˜åœ¨æ­¤è£ç½®ã€‚å¦‚éœ€åœ¨é›»å­éƒµä»¶ä¿å­˜å ±å‘Šå‰¯æœ¬ï¼Œè«‹è¼¸å…¥æ‚¨çš„éƒµä»¶åœ°å€ä¸¦ç™¼é€å ±å‘Šã€‚ç³»çµ±æœƒè‡ªå‹•é–‹å•Ÿæ‚¨çš„éƒµä»¶æ‡‰ç”¨ç¨‹å¼ï¼Œæ‚¨å¯ä»¥æ‰‹å‹•ç™¼é€æˆ–å°‡å ±å‘Šè¤‡è£½åˆ°å‰ªè²¼æ¿ã€‚",
                emailPlaceholder: "è¼¸å…¥æ‚¨çš„éƒµç®±",
                sendReportBtn: "ç™¼é€å ±å‘Š",
                emotionReportTitle: "ğŸ“Š å®Œæ•´å ±å‘Š",
                emotionReportDesc: "ç™¼é€åŒ…å«æ‰€æœ‰æˆå°±è³‡æ–™çš„å®Œæ•´å ±å‘Šåˆ°æ‚¨çš„éƒµç®±",
                emotionEmailPlaceholder: "è¼¸å…¥æ‚¨çš„éƒµç®±",
                sendEmotionReportBtn: "ç™¼é€å ±å‘Š",
                nutritionTitle: "é£²é£Ÿå»ºè­°",
                nutritionDesc: "ç‚ºADHDé‡èº«æ‰“é€ çš„ç‡Ÿé¤Šæ–¹æ¡ˆ",
                nutritionIntro: "æ ¹æ“š2026å¹´ç¾åœ‹æœ€æ–°é£²é£ŸæŒ‡å—ï¼Œä»¥ä¸‹ç‡Ÿé¤Šå»ºè­°èƒ½å¹«åŠ©æ”¹å–„å°ˆæ³¨åŠ›å’Œæƒ…ç·’ç©©å®šã€‚",
                nutritionSection1: "ğŸ§  å„ªå…ˆæ”å–çš„ç‡Ÿé¤Š",
                nutritionSection2: "ğŸ½ï¸ é€²é£Ÿé †åºå»ºè­°",
                eatingOrderDesc: "æŠµæŠ—ç¢³æšˆç¾è±¡ï¼Œç©©å®šè¡€ç³–ï¼š",
                nutritionSection3: "âŒ æ‡‰é¿å…çš„é£Ÿç‰©",
                nutritionMessage: "æ­£ç¢ºçš„é£²é£Ÿæ˜¯ç…§é¡§è‡ªå·±çš„ç¬¬ä¸€æ­¥ã€‚æ¯ä¸€å€‹ç‡Ÿé¤Šé¸æ“‡éƒ½åœ¨å¹«åŠ©ä½ å°ˆæ³¨ã€‚",
                taskBreakdownTitle: "æ‹†åˆ†ä»»å‹™",
                taskBreakdownDesc: "å°‡å¤§ä»»å‹™æ‹†æˆå°æ­¥é©Ÿ",
                newStepPlaceholder: "è¼¸å…¥æ­¥é©Ÿ...",
                confirmTaskBtn: "ç¢ºèªåˆ†è§£",
                cancelTaskBtn: "å–æ¶ˆ",
                alarmSelectTitle: "é¸æ“‡é¬§éˆ´è²éŸ³",
                groundingTitleModal: "æ¥åœ°ç·´ç¿’ (5-4-3-2-1)",
                cognitiveResultTitle: "èªçŸ¥é‡æ§‹ç·´ç¿’",
                closeCognitiveBtn: "å®Œæˆ",
                customInputQuestion: "å‘Šè¨´æˆ‘ï¼Œä½ ç¾åœ¨çš„è² é¢æƒ³æ³•æ˜¯ä»€éº¼ï¼Ÿ",
                submitCognitiveBtn: "ç¢ºèª",
                cancelCognitiveBtn: "å–æ¶ˆ",
                deleteBtnText: "åˆªé™¤",
                noEmotionText: "é‚„æ²’æœ‰è¨˜éŒ„ã€‚é–‹å§‹è¨˜éŒ„ä½ çš„æƒ…ç·’å§ï¼",
                noTaskText: "é‚„æ²’æœ‰ä»»å‹™ã€‚æ·»åŠ ç¬¬ä¸€å€‹å§ï¼",
                noHistoryText: "ç›®å‰å°šç„¡è©•ä¼°è¨˜éŒ„ã€‚",
                deleteText: "åˆªé™¤",
                groundingCompleteMsg: "ğŸŒ æ¥åœ°å®Œæˆï¼\n\nä½ å·²ç¶“å›åˆ°æ­¤åˆ»ã€‚æ„Ÿå—ä½ çš„å‘¼å¸ï¼Œæ„Ÿå—èº«é«”èˆ‡åœ°é¢çš„é€£çµã€‚ä½ å¾ˆå®‰å…¨ã€‚",
                nextBtn: "ä¸‹ä¸€æ­¥",
                completeBtn: "å®Œæˆ",
                breatingDoneMsg: "ğŸ˜Œ ä½ åšå¾—å¾ˆå¥½",
                inhalation: "å¸æ°£...",
                hold: "å±æ°£...",
                exhalation: "å‘¼æ°£...",
                doneMsg: "å®Œæˆäº†ï¼ä¼‘æ¯ä¸€ä¸‹å§",
                emotionTime: "æ™‚é–“",
                emailInputPlaceholder: "è¼¸å…¥æ‚¨çš„éƒµç®±",
                noAssessmentText: "ç›®å‰é‚„æ²’æœ‰æ­·å²è©•ä¼°è¨˜éŒ„ã€‚"
            },
            en: {
                levelLabel: "Level",
                xpLabel: "XP",
                streakLabel: "Consecutive Days",
                minutesLabel: "Breathing Minutes",
                headerSubtitle: "Cultivate your focus rhythm with warm support",
                usageNote: "âœï¸ Tips: Use from top to bottom for best results. Each tool is customized for you.",
                tipsNote: "No need to complete everything at once. Choose the tools that help you most, start with small steps. Every choice is self-love.",
                f1Title: "Quick Assessment", 
                f1Desc: "Understand your focus state today. 10 simple questions help you know your rhythm.", 
                f1Btn: "Start Assessment â†’",
                f2Title: "Energy Check", 
                f2Desc: "Choose your energy level, get task recommendations. Thoughtful workload arrangement.", 
                f2Btn: "Check Energy â†’",
                f3Title: "Daily Rituals", 
                f3Desc: "Morning and evening gentle rituals. Build sustainable rhythm, one step at a time.", 
                f3Btn: "Build Habits â†’",
                f4Title: "Task Management", 
                f4Desc: "Break big tasks into small steps. Every check is your victory.", 
                f4Btn: "Manage Tasks â†’",
                f5Title: "Pomodoro Timer", 
                f5Desc: "Customizable focused time. Every second accumulates your achievements.", 
                f5Btn: "Start Timer â†’",
                f6Title: "Healing Tools", 
                f6Desc: "Mindful breathing, cognitive restructuring, grounding. Give yourself a hug when anxious.", 
                f6Btn: "Find Calm â†’",
                f7Title: "Emotion Journal", 
                f7Desc: "Record every moment of emotion. Understanding yourself leads to better self-care.", 
                f7Btn: "Record Emotion â†’",
                f8Title: "Nutrition Advice", 
                f8Desc: "Nutrition plan tailored for ADHD. Right diet boosts focus and mood stability.", 
                f8Btn: "Learn Nutrition â†’",
                assessTitle: "Quick Assessment",
                assessDesc1: "Understand your focus state",
                assessDesc2: "No perfect answers, only the real you. This assessment helps us understand your rhythm.",
                submitAssessmentBtn: "Submit Assessment",
                energyTitle: "Energy Check",
                energyQuestion: "What's your energy level right now?",
                energyDesc: "Based on your energy, we recommend suitable task difficulty.",
                energyLabel1: "Very Low", 
                energyLabel2: "Low", 
                energyLabel3: "Medium", 
                energyLabel4: "Sufficient", 
                energyLabel5: "Peak",
                routineTitle: "Daily Rituals",
                morningLabel: "Morning Ritual",
                morningDesc: "Gently start your day",
                eveningLabel: "Evening Ritual",
                eveningDesc: "Gently guide you into night",
                routineMessageText: "These aren't tasks, they're dates with yourself. Every step cares for you.",
                taskTitle: "Task Management",
                taskDesc1: "Break big goals into small steps",
                addTaskBtn: "Add",
                breakdownBtn: "Breakdown",
                timerTitle: "Pomodoro Timer",
                timerDesc1: "Customizable focused time",
                timerMinLabel: "Minutes:",
                resetTimerBtn: "Reset",
                startTimerBtn: "Start Timer",
                stopTimerBtn: "Stop Timer",
                healingTitle: "Healing Tools",
                breathingTitle: "Mindful Breathing",
                breathingDesc: "When anxious, breathing is the best comfort. Visualize your breathing cycle to regulate your nervous system and reduce stress.",
                breathingStart: "Click to Start\nBreathing",
                breathingRelax: "Breathe with Circle\nFully Relax",
                cognitiveTitle: "Cognitive Restructuring",
                cognitiveDesc: "Transform negative thoughts into strength.",
                cognitiveScience: "ğŸ§  Scientific Basis: Cognitive restructuring is core to CBT. Research shows that identifying and challenging inaccurate beliefs significantly improves anxiety, depression, and overthinking. This practice helps break negative thought cycles and build healthier mental patterns.",
                cognitiveBtn: "Start Practice",
                groundingTitle: "Grounding (5-4-3-2-1)",
                groundingDesc: "Feel the present, return to now.",
                groundingScience: "ğŸ§  Scientific Basis: The 5-4-3-2-1 grounding technique is a sensory redirection method that activates your parasympathetic nervous system through five senses, counteracting anxiety-induced fight-or-flight response. This technique helps return you to the present within seconds.",
                groundingBtn: "Start Grounding",
                emotionTitle: "Emotion Journal",
                emotionLogTitle: "Record your current emotion",
                emotionBtn1: "ğŸ˜Š Happy",
                emotionBtn2: "ğŸ˜Œ Calm",
                emotionBtn3: "ğŸ˜¢ Sad",
                emotionBtn4: "ğŸ˜° Anxious",
                backBtn: "Back to Home",
                reportTitle: "ğŸ“„ Assessment Report",
                historyTitle: "Assessment History",
                emailWarning: "âš ï¸ Important: All records are stored only on this device. To save a report copy via email, enter your email address. The system will open your mail app where you can send or copy to clipboard.",
                emailPlaceholder: "Enter your email",
                sendReportBtn: "Send Report",
                emotionReportTitle: "ğŸ“Š Complete Report",
                emotionReportDesc: "Send complete report with all achievements to your email",
                emotionEmailPlaceholder: "Enter your email",
                sendEmotionReportBtn: "Send Report",
                nutritionTitle: "Nutrition Advice",
                nutritionDesc: "Nutrition plan tailored for ADHD",
                nutritionIntro: "Based on 2026 latest US dietary guidelines, these nutrition tips help improve focus and emotional stability.",
                nutritionSection1: "ğŸ§  Priority Nutrients",
                nutritionSection2: "ğŸ½ï¸ Eating Order Recommendation",
                eatingOrderDesc: "Combat blood sugar crashes, stabilize glucose:",
                nutritionSection3: "âŒ Foods to Avoid",
                nutritionMessage: "Proper nutrition is the first step to self-care. Every nutrition choice helps you focus.",
                taskBreakdownTitle: "Break Down Task",
                taskBreakdownDesc: "Break big task into small steps",
                newStepPlaceholder: "Enter step...",
                confirmTaskBtn: "Confirm Breakdown",
                cancelTaskBtn: "Cancel",
                alarmSelectTitle: "Select Alarm Sound",
                groundingTitleModal: "Grounding (5-4-3-2-1)",
                cognitiveResultTitle: "Cognitive Restructuring",
                closeCognitiveBtn: "Done",
                customInputQuestion: "What negative thought are you having?",
                submitCognitiveBtn: "Confirm",
                cancelCognitiveBtn: "Cancel",
                deleteBtnText: "Delete",
                noEmotionText: "No records yet. Start logging your emotions!",
                noTaskText: "No tasks yet. Add your first one!",
                noHistoryText: "No assessment history yet.",
                deleteText: "Delete",
                groundingCompleteMsg: "ğŸŒ Grounding complete!\n\nYou are back in the present. Feel your breath, feel your body connected to the ground. You are safe.",
                nextBtn: "Next",
                completeBtn: "Complete",
                breatingDoneMsg: "ğŸ˜Œ You did great",
                inhalation: "Inhale...",
                hold: "Hold...",
                exhalation: "Exhale...",
                doneMsg: "Done! Take a break",
                emotionTime: "Time",
                emailInputPlaceholder: "Enter your email",
                noAssessmentText: "No assessment history yet."
            },
            'assessTitle': {
                'zh': 'è©•ä¼°æ¨™é¡Œ',
                'en': 'Assessment Title'
            },
            'assessDesc1': {
                'zh': 'è©•ä¼°æ¨™é¡Œ',
                'en': 'Assessment Title'
            },
            'assessDesc2': {
                'zh': 'è©•ä¼°æ¨™é¡Œ',
                'en': 'Assessment Title'
            },
            'submitAssessmentBtn': {
                'zh': 'è©•ä¼°æ¨™é¡Œ',
                'en': 'Assessment Title'
            },
            'reportTitle': {
                'zh': 'è©•ä¼°æ¨™é¡Œ',
                'en': 'Assessment Title'
            },
            'historyTitle': {
                'zh': 'è©•ä¼°æ¨™é¡Œ',
                'en': 'Assessment Title'
            },
            'emailWarning': {
                'zh': 'è©•ä¼°æ¨™é¡Œ',
                'en': 'Assessment Title'
            }
        };

        // é è¨­çš„æ—©æ™¨å„€å¼å’Œå‚æ™šå„€å¼
        const defaultMorningRoutineZh = [
            'â° èµ·åºŠ â€” è¨­å®š 3 å€‹é¬§é˜ï¼Œçµ¦è‡ªå·±å……è£•èµ·åºŠæ™‚é–“',
            'ğŸŒ¬ï¸ æ—©æ™¨å‘¼å¸ â€” å¸æ°£4ç§’ã€åœ4ç§’ã€å‘¼æ°£4ç§’ï¼Œé‡è¤‡5è¼ª',
            'ğŸ’ª ç°¡å–®ä¼¸å±•æˆ–èµ°å‹• 5â€“10 åˆ†é˜',
            'ğŸš¿ æ´—è‡‰æˆ–æ·‹æµ´ï¼Œæ›ä¸Šèˆ’é©è¡£ç‰©',
            'ğŸ¥ åƒä¸€ä»½æœ‰è›‹ç™½è³ªçš„æ—©é¤ï¼ˆè›‹ã€è±†æ¼¿ã€å„ªæ ¼ç­‰ï¼‰',
            'ğŸ“‹ å¯«ä¸‹ä»Šå¤©æƒ³å®Œæˆçš„ 1â€“3 ä»¶å°äº‹'
        ];

        const defaultMorningRoutineEn = [
            'â° Wake up â€” Set 3 alarms, give yourself time',
            'ğŸŒ¬ï¸ Morning breathing â€” Inhale 4s, hold 4s, exhale 4s, repeat 5 times',
            'ğŸ’ª Simple stretch or walk 5â€“10 minutes',
            'ğŸš¿ Wash face or shower, change into comfortable clothes',
            'ğŸ¥ Eat breakfast with protein (eggs, soy milk, yogurt, etc.)',
            'ğŸ“‹ Write down 1â€“3 things you want to complete today'
        ];

        const defaultEveningRoutineZh = [
            'ğŸ“µ æ”¾ä¸‹æ‰‹æ©Ÿæˆ–è¢å¹•ï¼Œè®“çœ¼ç›ä¼‘æ¯',
            'ğŸ§˜ åš 3â€“5 åˆ†é˜çš„æ”¾é¬†å‘¼å¸æˆ–ä¼¸å±•',
            'ğŸš¿ æ´—æ¾¡æˆ–æ´—è‡‰ï¼Œæ¸…ç†ä¸€å¤©çš„ç–²å‹',
            'ğŸ“… ç°¡å–®å¯«ä¸‹æ˜å¤©æœ€é‡è¦çš„ä¸€ä»¶äº‹',
            'ğŸ›ï¸ æ•´ç†åºŠèˆ–èˆ‡ç¡çœ ç’°å¢ƒ',
            'ğŸ˜´ ä¸ŠåºŠå‰å°ä»Šå¤©èªªä¸€å¥ã€Œè¾›è‹¦äº†ã€'
        ];

        const defaultEveningRoutineEn = [
            'ğŸ“µ Put down phone or screen, let your eyes rest',
            'ğŸ§˜ Do 3â€“5 minutes of relaxation breathing or stretching',
            'ğŸš¿ Take a bath or wash your face, clear the day\'s fatigue',
            'ğŸ“… Write down the most important thing for tomorrow',
            'ğŸ›ï¸ Organize bed and sleep environment',
            'ğŸ˜´ Say "You worked hard today" before bed'
        ];

        // è©•ä¼°å•é¡Œ
        const assessmentQuestionsZh = [
            'æˆ‘ç¶“å¸¸æ‹–å»¶ä»»å‹™ç›´åˆ°æœ€å¾Œä¸€åˆ»',
            'æˆ‘åœ¨é€²è¡Œç„¡èŠä»»å‹™æ™‚é›£ä»¥ä¿æŒå°ˆæ³¨',
            'æˆ‘å®¹æ˜“è¢«ç„¡é—œçš„æ±è¥¿åˆ†æ•£æ³¨æ„åŠ›',
            'æˆ‘å®¹æ˜“å¿˜è¨˜å›è¦†ä¿¡æ¯æˆ–å®Œæˆè¨ˆåŠƒçš„ä»»å‹™',
            'æˆ‘æœƒä¸è€ƒæ…®å¾Œæœè€Œè¡å‹•è¡Œå‹•',
            'æˆ‘å®¹æ˜“æ„Ÿåˆ°ä¸è€ç…©æˆ–æ²®å–ª',
            'æˆ‘é›£ä»¥éµå¾ªæŒ‡ç¤ºæˆ–å®Œæˆå¤šæ­¥é©Ÿä»»å‹™',
            'æˆ‘ç¶“å¸¸æ‰“æ–·åˆ¥äººæˆ–è¡å‹•èªªè©±',
            'æˆ‘çš„æƒ…ç·’è®ŠåŒ–å¾ˆå¿«',
            'æˆ‘é›£ä»¥çµ„ç¹”äº‹ç‰©æˆ–ç®¡ç†æ™‚é–“'
        ];

        const assessmentQuestionsEn = [
            'I often procrastinate on tasks until the last moment',
            'I find it difficult to focus when doing boring tasks',
            'I get easily distracted by unrelated things',
            'I forget to reply to messages or complete planned tasks',
            'I act impulsively without considering consequences',
            'I easily feel impatient or frustrated',
            'I have difficulty following instructions or completing multi-step tasks',
            'I often interrupt others or speak impulsively',
            'My mood changes quickly',
            'I have difficulty organizing things or managing time'
        ];

        // é¬§éˆ´é¸é …
        const alarmSoundsConfig = {
            default: { 
                name: { zh: 'é è¨­éŸ³ ğŸ””', en: 'Default Sound ğŸ””' },
                freq: 800, 
                duration: 0.2 
            },
            zen: {
                name: { zh: 'ç¦ªæ„éœå¿ƒ ğŸ§˜', en: 'Zen Mindfulness ğŸ§˜' },
                sequence: [{freq: 440, dur: 0.8}, {freq: 554.37, dur: 0.8}, {freq: 659.25, dur: 1.2}],
                isSequence: true
            },
            digital: {
                name: { zh: 'ç§‘æŠ€å¾‹å‹• ğŸ’»', en: 'Digital Pulse ğŸ’»' },
                sequence: [{freq: 880, dur: 0.1}, {freq: 0, dur: 0.1}, {freq: 880, dur: 0.1}, {freq: 0, dur: 0.1}, {freq: 1320, dur: 0.4}],
                isSequence: true
            },
            chime: { 
                name: { zh: 'è¯éº—å’Œå¼¦ ğŸµ', en: 'Elegant Chord ğŸµ' },
                sequence: [{freq: 1000, dur: 0.3}, {freq: 1200, dur: 0.3}, {freq: 1400, dur: 0.4}, {freq: 1200, dur: 0.3}, {freq: 1000, dur: 0.3}],
                isSequence: true
            },
            bell: { 
                name: { zh: 'å„ªé›…éˆ´è² ğŸ””', en: 'Elegant Bell ğŸ””' },
                sequence: [{freq: 800, dur: 0.4}, {freq: 1000, dur: 0.3}, {freq: 900, dur: 0.35}, {freq: 1100, dur: 0.4}],
                isSequence: true
            },
            buzz: { 
                name: { zh: 'å¾‹å‹•èœ‚é³´ âš¡', en: 'Rhythmic Buzz âš¡' },
                sequence: [{freq: 1200, dur: 0.2}, {freq: 1200, dur: 0.2}, {freq: 1500, dur: 0.3}, {freq: 1200, dur: 0.2}, {freq: 1200, dur: 0.2}, {freq: 1500, dur: 0.3}],
                isSequence: true
            }
        };

        // èƒ½é‡æ¨è–¦é…ç½®
        const energyRecommendationsZh = {
            1: ['å–æ¯å’–å•¡æˆ–èŒ¶â˜•', 'é€²è¡Œ5åˆ†é˜æ‹‰ä¼¸ğŸ§˜', 'è½æœ€å–œæ­¡çš„æ­ŒğŸµ', 'åšæ·±å‘¼å¸ç·´ç¿’ğŸŒ¬ï¸', 'æ›å€‹ç’°å¢ƒæ•£æ­¥ğŸš¶'],
            2: ['5-10åˆ†é˜æ•£æ­¥ğŸš¶', 'åšç°¡å–®æ–‡æ›¸å·¥ä½œğŸ“', 'å›è¦†çŸ­ä¿¡æ¯ğŸ’¬', 'è¼•åº¦ä¼¸å±•ğŸ¤¸', 'èª¿æ•´åå§¿ğŸ’º'],
            3: ['å®Œæˆæ—¥å¸¸å·¥ä½œâœ…', 'è™•ç†ä¸­ç­‰è¤‡é›œåº¦ä»»å‹™ğŸ¯', 'åƒåŠ æœƒè­°ğŸ¤', 'å”ä½œé …ç›®ğŸ‘¥', 'é€²åº¦æª¢æŸ¥ğŸ“Š'],
            4: ['å•Ÿå‹•å‰µæ„é …ç›®ğŸ¨', 'é€²è¡Œæ·±åº¦å·¥ä½œğŸ”', 'å­¸ç¿’æ–°æŠ€èƒ½ğŸ“š', 'è¤‡é›œå•é¡Œè§£æ±ºğŸ§©', 'ç­–ç•¥è¦åŠƒğŸ“‹'],
            5: ['å•Ÿå‹•é‡å¤§é …ç›®ğŸš€', 'è§£æ±ºè¤‡é›œå•é¡ŒğŸ’¡', 'é€²è¡Œé•·æœŸè£½ä½œğŸ¬', 'é ˜å°åœ˜éšŠğŸ‘‘', 'å‰µæ–°çªç ´â­']
        };

        const energyRecommendationsEn = {
            1: ['Have a coffee or teaâ˜•', '5-minute stretchğŸ§˜', 'Listen to favorite songsğŸµ', 'Deep breathingğŸŒ¬ï¸', 'Take a walkğŸš¶'],
            2: ['5-10 minute walkğŸš¶', 'Simple paperworkğŸ“', 'Reply short messagesğŸ’¬', 'Light stretchingğŸ¤¸', 'Adjust postureğŸ’º'],
            3: ['Complete daily tasksâœ…', 'Handle moderate complexityğŸ¯', 'Attend meetingsğŸ¤', 'CollaborationğŸ‘¥', 'Progress checkğŸ“Š'],
            4: ['Start creative projectğŸ¨', 'Deep workğŸ”', 'Learn new skillsğŸ“š', 'Solve complex problemsğŸ§©', 'Strategic planningğŸ“‹'],
            5: ['Launch major projectğŸš€', 'Solve complex issuesğŸ’¡', 'Long-term productionğŸ¬', 'Lead teamsğŸ‘‘', 'Creative breakthroughâ­']
        };

        const energyTextsZh = {
            1: 'ğŸ”´ è¶…ä½èƒ½é‡ï¼šç°¡å–®å·¥ä½œï¼ˆæŸ¥çœ‹éƒµä»¶ã€æ•´ç†æ¡Œé¢ã€å–æ°´ã€è½éŸ³æ¨‚ï¼‰',
            2: 'ğŸŸ¡ ä½-ä¸­ç­‰èƒ½é‡ï¼šä¸­ç­‰å·¥ä½œï¼ˆå›è¦†æ¶ˆæ¯ã€æ•´ç†æ–‡ä»¶ã€ç°¡å–®ç·¨è¼¯ã€è¼•åº¦é–±è®€ï¼‰',
            3: 'ğŸŸ¢ ä¸­ç­‰èƒ½é‡ï¼šä¸€èˆ¬å·¥ä½œï¼ˆå¤§å¤šæ•¸å·¥ä½œã€éŒ„è£½ã€å…§å®¹è¦åŠƒã€æœƒè­°ï¼‰',
            4: 'ğŸ’š é«˜èƒ½é‡ï¼šæœ‰æŒ‘æˆ°çš„ä»»å‹™ï¼ˆå‰µæ„é …ç›®ã€è¤‡é›œç·¨è¼¯ã€é‡è¦æœƒè­°ã€æ•™å­¸ï¼‰',
            5: 'âœ¨ è¶…å……è¶³èƒ½é‡ï¼šé«˜é›£åº¦ä»»å‹™ï¼ˆå…¨å¤©æ‹æ”ã€è¤‡é›œè£½ä½œã€å‰µæ„çªç ´ã€é ˜å°å·¥ä½œï¼‰'
        };

        const energyTextsEn = {
            1: 'ğŸ”´ Very Low Energy: Simple tasks (check email, organize desk, drink water, listen to music)',
            2: 'ğŸŸ¡ Low-Medium Energy: Moderate tasks (reply messages, organize files, simple editing, light reading)',
            3: 'ğŸŸ¢ Medium Energy: Regular work (most tasks, recording, content planning, meetings)',
            4: 'ğŸ’š High Energy: Challenging tasks (creative projects, complex editing, important meetings, teaching)',
            5: 'âœ¨ Peak Energy: High difficulty (all-day shooting, complex production, creative breakthroughs, leadership)'
        };

        // ç‡Ÿé¤Šæ•¸æ“šé…ç½®
        const nutritionDataZh = {
            priority: [
                "ğŸ  å¥§ç±³åŠ -3è„‚è‚ªé…¸ï¼ˆDHA/EPAï¼‰- æ”¹å–„èªçŸ¥åŠŸèƒ½å’Œæ³¨æ„åŠ›",
                "ğŸ¥› è›‹ç™½è³ª - ç©©å®šè¡€ç³–ï¼Œå¢å¼·å»ç”²è…ä¸Šè…ºç´ åˆ†æ³Œ",
                "ğŸ¥¬ Bæ—ç¶­ç”Ÿç´ ï¼ˆB6ã€B12ã€è‘‰é…¸ï¼‰- æ”¯æŒç¥ç¶“å‚³éç‰©è³ªåˆæˆ",
                "âš¡ é‹…å’Œé‚ - ä¿ƒé€²ç¥ç¶“å¥åº·å’Œæƒ…ç·’èª¿ç¯€",
                "ğŸ“ æŠ—æ°§åŒ–åŠ‘ï¼ˆè“æœã€æ·±è‰²è”¬èœï¼‰- ä¿è­·å¤§è…¦ç´°èƒ",
                "ğŸ¥” è¤‡é›œç¢³æ°´åŒ–åˆç‰© - æä¾›ç©©å®šçš„èƒ½é‡"
            ],
            eatingOrder: [
                "1ï¸âƒ£ å…ˆåƒçº–ç¶­ - è”¬èœã€å…¨ç©€ç‰©ã€è±†é¡",
                "2ï¸âƒ£ å†åƒè›‹ç™½è³ªå’Œè„‚è‚ª - è‚‰é¡ã€é­šã€å …æœã€ä¹³è£½å“",
                "3ï¸âƒ£ æœ€å¾Œåƒç¢³æ°´åŒ–åˆç‰© - ç±³é£¯ã€éºµæ¢ã€éºµåŒ…"
            ],
            avoid: [
                "ğŸš« é«˜ç³–é£Ÿå“ - å°è‡´è¡€ç³–æ³¢å‹•å’Œæ³¨æ„åŠ›ä¸‹é™",
                "ğŸš« éåº¦åŠ å·¥é£Ÿå“ - å«æœ‰äººå·¥æ·»åŠ åŠ‘å’Œé˜²è…åŠ‘",
                "ğŸš« å«å’–å•¡å› éå¤šé£²æ–™ - å¯èƒ½åŠ é‡ç„¦æ…®å’Œä¸ç©©å®š",
                "ğŸš« åå¼è„‚è‚ª - å°å¤§è…¦å’Œå¿ƒè‡Ÿæœ‰å®³",
                "ğŸš« äººå·¥è‰²ç´ å’Œé¦™æ–™ - å¯èƒ½è§¸ç™¼è¡Œç‚ºå•é¡Œ",
                "ğŸš« éé‡é¹½åˆ† - å½±éŸ¿è¡€å£“å’Œç¥ç¶“ç³»çµ±"
            ]
        };

        const nutritionDataEn = {
            priority: [
                "ğŸ  Omega-3 Fatty Acids (DHA/EPA) - Improve cognitive function and attention",
                "ğŸ¥› Protein - Stabilize blood sugar, enhance norepinephrine secretion",
                "ğŸ¥¬ B Vitamins (B6, B12, Folate) - Support neurotransmitter synthesis",
                "âš¡ Zinc and Magnesium - Promote brain health and mood regulation",
                "ğŸ“ Antioxidants (Berries, dark vegetables) - Protect brain cells",
                "ğŸ¥” Complex Carbohydrates - Provide stable energy"
            ],
            eatingOrder: [
                "1ï¸âƒ£ Eat fiber first - Vegetables, whole grains, legumes",
                "2ï¸âƒ£ Then eat protein and fat - Meat, fish, nuts, dairy",
                "3ï¸âƒ£ Finally eat carbohydrates - Rice, pasta, bread"
            ],
            avoid: [
                "ğŸš« High-sugar foods - Cause blood sugar spikes and attention drops",
                "ğŸš« Ultra-processed foods - Contain artificial additives and preservatives",
                "ğŸš« Excessive caffeine beverages - May worsen anxiety and instability",
                "ğŸš« Trans fats - Harmful to brain and heart",
                "ğŸš« Artificial dyes and flavorings - May trigger behavioral issues",
                "ğŸš« Excessive salt - Affects blood pressure and nervous system"
            ]
        };

        // ========== å…¨å±€è®Šé‡ ==========
        let currentLanguage = 'zh';
        let currentPage = 'homePage';
        let stats = JSON.parse(localStorage.getItem('stats')) || { level: 1, xp: 0, streak: 0, totalMinutes: 0 };
        let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        let emotionLog = JSON.parse(localStorage.getItem('emotionLog')) || [];
        let morningRoutine = JSON.parse(localStorage.getItem('morningRoutine')) || defaultMorningRoutineZh.slice();
        let eveningRoutine = JSON.parse(localStorage.getItem('eveningRoutine')) || defaultEveningRoutineZh.slice();
        let assessmentHistory = JSON.parse(localStorage.getItem('assessmentHistory')) || [];
        let isBreathingAnimating = false;
        let timerDuration = 25 * 60;
        let timeLeft = 25 * 60;
        let timerInterval = null;
        let currentAlarmSound = 'default';
        let groundingCurrentStep = 0;
        let currentBreakdownTask = null;
        let breakdownSteps = [];

        // ========== ç¿»è­¯å‡½æ•¸ ==========
        function t(key) {
            return translations[currentLanguage][key] || key;
        }

        // ========== èªè¨€åˆ‡æ› ==========
        function switchLanguage(lang) {
            currentLanguage = lang;
            document.getElementById('langZh').classList.toggle('active', lang === 'zh');
            document.getElementById('langEn').classList.toggle('active', lang === 'en');
            
            // æ›´æ–°æ—©æ™¨å’Œå‚æ™šå„€å¼
            morningRoutine = lang === 'zh' ? defaultMorningRoutineZh.slice() : defaultMorningRoutineEn.slice();
            eveningRoutine = lang === 'zh' ? defaultEveningRoutineZh.slice() : defaultEveningRoutineEn.slice();
            localStorage.setItem('morningRoutine', JSON.stringify(morningRoutine));
            localStorage.setItem('eveningRoutine', JSON.stringify(eveningRoutine));
            
            updateAllText();
            updateTopStats();
            
            // é‡æ–°æ¸²æŸ“ç•¶å‰é é¢
            if (currentPage === 'routinePage') renderRoutines();
            if (currentPage === 'taskPage') renderTasks();
            if (currentPage === 'emotionPage') renderEmotionLog();
            if (currentPage === 'nutritionPage') updateNutritionPage();
            if (currentPage === 'assessmentPage') { renderAssessmentQuestions(); renderAssessmentHistory(); }
            if (currentPage === 'healingPage') updateBreathingText();
        }

        function updateAllText() {
            // å®‰å…¨è¨­ç½®æ–‡æœ¬çš„è¼”åŠ©å‡½æ•¸
            const safeSetText = (id, key) => {
                const el = document.getElementById(id);
                if (el) el.textContent = t(key);
            };
            
            // é¦–é æ–‡æœ¬
            try {
                safeSetText('levelLabel', 'levelLabel');
                safeSetText('xpLabel', 'xpLabel');
                safeSetText('streakLabel', 'streakLabel');
                safeSetText('minutesLabel', 'minutesLabel');
            safeSetText('headerSubtitle', 'headerSubtitle');
            safeSetText('usageNote', 'usageNote');
            safeSetText('tipsNote', 'tipsNote');

            // åŠŸèƒ½å¡ç‰‡
            safeSetText('f1Title', 'f1Title');
            safeSetText('f1Desc', 'f1Desc');
            safeSetText('f1Btn', 'f1Btn');
            safeSetText('f2Title', 'f2Title');
            safeSetText('f2Desc', 'f2Desc');
            safeSetText('f2Btn', 'f2Btn');
            safeSetText('f3Title', 'f3Title');
            safeSetText('f3Desc', 'f3Desc');
            safeSetText('f3Btn', 'f3Btn');
            safeSetText('f4Title', 'f4Title');
            safeSetText('f4Desc', 'f4Desc');
            safeSetText('f4Btn', 'f4Btn');
            safeSetText('f5Title', 'f5Title');
            safeSetText('f5Desc', 'f5Desc');
            safeSetText('f5Btn', 'f5Btn');
            safeSetText('f6Title', 'f6Title');
            safeSetText('f6Desc', 'f6Desc');
            safeSetText('f6Btn', 'f6Btn');
            safeSetText('f7Title', 'f7Title');
            safeSetText('f7Desc', 'f7Desc');
            safeSetText('f7Btn', 'f7Btn');
            safeSetText('f8Title', 'f8Title');
            safeSetText('f8Desc', 'f8Desc');
            safeSetText('f8Btn', 'f8Btn');

            // è¿”å›æŒ‰éˆ•
            Array.from(document.querySelectorAll('[id^="backBtn"]')).forEach(el => {
                if (el.textContent.includes('â†')) {
                    el.textContent = 'â† ' + t('backBtn');
                }
            });

            // è©•ä¼°é é¢
            safeSetText('assessTitle', 'assessTitle');
            safeSetText('assessDesc1', 'assessDesc1');
            safeSetText('assessDesc2', 'assessDesc2');
            safeSetText('submitAssessmentBtn', 'submitAssessmentBtn');
            safeSetText('reportTitle', 'reportTitle');
            safeSetText('historyTitle', 'historyTitle');
            safeSetText('emailWarning', 'emailWarning');
            document.getElementById('emailInput').placeholder = t('emailInputPlaceholder');

            // èƒ½é‡é é¢
            safeSetText('energyTitle', 'energyTitle');
            safeSetText('energyQuestion', 'energyQuestion');
            safeSetText('energyDesc', 'energyDesc');
            safeSetText('energyLabel1', 'energyLabel1');
            safeSetText('energyLabel2', 'energyLabel2');
            safeSetText('energyLabel3', 'energyLabel3');
            safeSetText('energyLabel4', 'energyLabel4');
            safeSetText('energyLabel5', 'energyLabel5');

            // æ—¥ç¨‹é é¢
            safeSetText('routineTitle', 'routineTitle');
            safeSetText('morningLabel', 'morningLabel');
            safeSetText('morningDesc', 'morningDesc');
            safeSetText('eveningLabel', 'eveningLabel');
            safeSetText('eveningDesc', 'eveningDesc');
            document.getElementById('newMorningInput').placeholder = currentLanguage === 'zh' ? 'æ·»åŠ æ–°çš„æ—©æ™¨å„€å¼...' : 'Add a morning ritual...';
            document.getElementById('newEveningInput').placeholder = currentLanguage === 'zh' ? 'æ·»åŠ æ–°çš„å‚æ™šå„€å¼...' : 'Add an evening ritual...';
            safeSetText('routineMessageText', 'routineMessageText');

            // ä»»å‹™é é¢
            safeSetText('taskTitle', 'taskTitle');
            safeSetText('taskDesc1', 'taskDesc1');
            document.getElementById('newTaskInput').placeholder = currentLanguage === 'zh' ? 'ä¾‹ï¼šå®Œæˆå ±å‘Šã€å­¸ç¿’æ–°æŠ€èƒ½...' : 'Example: Complete report, learn new skills...';
            safeSetText('addTaskBtn', 'addTaskBtn');
            safeSetText('breakdownBtn', 'breakdownBtn');

            // è¨ˆæ™‚å™¨é é¢
            safeSetText('timerTitle', 'timerTitle');
            safeSetText('timerDesc1', 'timerDesc1');
            safeSetText('timerMinLabel', 'timerMinLabel');
            safeSetText('resetTimerBtn', 'resetTimerBtn');
            safeSetText('startTimerBtn', 'startTimerBtn');
            safeSetText('stopTimerBtn', 'stopTimerBtn');
            document.getElementById('alarmBtn').textContent = 'ğŸ””';
            document.getElementById('testAlarmBtn').textContent = 'ğŸ”Š';

            // ç™‚ç™’å·¥å…·é é¢
            safeSetText('healingTitle', 'healingTitle');
            safeSetText('breathingTitle', 'breathingTitle');
            safeSetText('breathingDesc', 'breathingDesc');
            safeSetText('cognitiveTitle', 'cognitiveTitle');
            safeSetText('cognitiveDesc', 'cognitiveDesc');
            safeSetText('cognitiveScience', 'cognitiveScience');
            safeSetText('cognitiveBtn', 'cognitiveBtn');
            safeSetText('groundingTitle', 'groundingTitle');
            safeSetText('groundingDesc', 'groundingDesc');
            safeSetText('groundingScience', 'groundingScience');
            safeSetText('groundingBtn', 'groundingBtn');

            // æƒ…ç·’é é¢
            safeSetText('emotionTitle', 'emotionTitle');
            safeSetText('emotionLogTitle', 'emotionLogTitle');
            safeSetText('emotionBtn1', 'emotionBtn1');
            safeSetText('emotionBtn2', 'emotionBtn2');
            safeSetText('emotionBtn3', 'emotionBtn3');
            safeSetText('emotionBtn4', 'emotionBtn4');
            safeSetText('emotionReportTitle', 'emotionReportTitle');
            safeSetText('emotionReportDesc', 'emotionReportDesc');
            document.getElementById('emotionEmailInput').placeholder = t('emotionEmailPlaceholder');

            // é£²é£Ÿé é¢
            safeSetText('nutritionTitle', 'nutritionTitle');
            safeSetText('nutritionDesc', 'nutritionDesc');
            safeSetText('nutritionIntro', 'nutritionIntro');
            safeSetText('nutritionSection1', 'nutritionSection1');
            safeSetText('nutritionSection2', 'nutritionSection2');
            safeSetText('eatingOrderDesc', 'eatingOrderDesc');
            safeSetText('nutritionSection3', 'nutritionSection3');
            safeSetText('nutritionMessage', 'nutritionMessage');

            // Modal
            safeSetText('alarmSelectTitle', 'alarmSelectTitle');
            safeSetText('taskBreakdownTitle', 'taskBreakdownTitle');
            safeSetText('taskBreakdownDesc', 'taskBreakdownDesc');
            document.getElementById('newStepInput').placeholder = t('newStepPlaceholder');
            safeSetText('confirmTaskBtn', 'confirmTaskBtn');
            safeSetText('cancelTaskBtn', 'cancelTaskBtn');
            safeSetText('groundingTitle', 'groundingTitle');
            safeSetText('cognitiveResultTitle', 'cognitiveResultTitle');
            safeSetText('closeCognitiveBtn', 'closeCognitiveBtn');
            safeSetText('customInputQuestion', 'customInputQuestion');
            safeSetText('submitCognitiveBtn', 'submitCognitiveBtn');
            safeSetText('cancelCognitiveBtn', 'cancelCognitiveBtn');
            } catch(e) {
                console.error('Error in updateAllText:', e);
            }
        }

        function updateBreathingText() {
            if (isBreathingAnimating) {
                document.getElementById('breathText').innerHTML = t('breathingRelax');
            } else {
                document.getElementById('breathText').innerHTML = t('breathingStart');
            }
        }

        // ========== é é¢å°èˆª ==========
        function goToPage(pageId) {
            document.getElementById(currentPage).classList.remove('active');
            document.getElementById(pageId).classList.add('active');
            currentPage = pageId;
            window.scrollTo(0, 0);
            
            // ç‰¹å®šé é¢çš„åˆå§‹åŒ–
            if (pageId === 'assessmentPage') {
                renderAssessmentQuestions();
                renderAssessmentHistory();
            }
            if (pageId === 'energyPage') {
                const rec = document.getElementById('energyRecommendation');
                if (rec) rec.style.display = 'none';
            }
        }

        function backToHomeFrom(pageId) {
            document.getElementById(currentPage).classList.remove('active');
            document.getElementById('homePage').classList.add('active');
            currentPage = 'homePage';
            updateTopStats();
            setTimeout(() => scrollToFeature(pageId), 100);
        }

        function scrollToFeature(pageId) {
            const pageToCardMap = {
                'assessmentPage': 0, 'energyPage': 1, 'routinePage': 2, 'taskPage': 3,
                'timerPage': 4, 'healingPage': 5, 'emotionPage': 6, 'nutritionPage': 7
            };
            const cardIndex = pageToCardMap[pageId];
            if (cardIndex !== undefined) {
                const cards = document.querySelectorAll('.feature-card');
                if (cards[cardIndex]) cards[cardIndex].scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        function updateTopStats() {
            document.getElementById('topLevel').textContent = 'Lv. ' + stats.level;
            document.getElementById('topXp').textContent = stats.xp;
            document.getElementById('topStreak').textContent = stats.streak;
            document.getElementById('topMinutes').textContent = stats.totalMinutes;
        }

        // ========== è©•ä¼°ç³»çµ± ==========
        function renderAssessmentQuestions() {
            const questions = currentLanguage === 'zh' ? assessmentQuestionsZh : assessmentQuestionsEn;
            const container = document.getElementById('assessmentQuestions');
            const labels = currentLanguage === 'zh' ? ['å¾ä¸', 'å¾ˆå°‘', 'æœ‰æ™‚', 'ç¶“å¸¸', 'ç¸½æ˜¯'] : ['Never', 'Rarely', 'Sometimes', 'Often', 'Always'];
            
            container.innerHTML = questions.map((q, i) => `
                <div class="question-group">
                    <label>${i + 1}. ${q}</label>
                    <input type="range" class="slider" id="q${i}" min="1" max="5" value="3" onchange="updateSliderLabel(${i})">
                    <div style="display: flex; justify-content: space-between; margin-top: 8px; color: var(--text-secondary); font-size: 0.85em;">
                        <span>${labels[0]}</span>
                        <span id="label${i}">${labels[2]}</span>
                        <span>${labels[4]}</span>
                    </div>
                </div>
            `).join('');
        }

        function updateSliderLabel(index) {
            const value = document.getElementById(`q${index}`).value;
            const labels = currentLanguage === 'zh' ? ['å¾ä¸', 'å¾ˆå°‘', 'æœ‰æ™‚', 'ç¶“å¸¸', 'ç¸½æ˜¯'] : ['Never', 'Rarely', 'Sometimes', 'Often', 'Always'];
            document.getElementById(`label${index}`).textContent = labels[value - 1];
        }

        function submitAssessment() {
            let score = 0;
            for (let i = 0; i < 10; i++) {
                score += parseInt(document.getElementById(`q${i}`).value);
            }

            let level, advice;
            if (score <= 15) {
                level = currentLanguage === 'zh' ? 'è¼•å¾®å‚¾å‘' : 'Mild Tendency';
                advice = currentLanguage === 'zh' 
                    ? 'ä½ çš„ç‹€æ…‹æ•´é«”è¡¨ç¾ä¸éŒ¯ã€‚é€éç°¡å–®çš„æ—¥å¸¸èª¿æ•´å’Œç¿’æ…£å„ªåŒ–ï¼Œå¯ä»¥é€²ä¸€æ­¥æå‡å°ˆæ³¨åŠ›å’Œç”Ÿæ´»å“è³ªã€‚'
                    : 'Your state is performing well overall. Simple daily adjustments and habit optimization can further improve focus and quality of life.';
            } else if (score <= 25) {
                level = currentLanguage === 'zh' ? 'ä¸­ç­‰å‚¾å‘' : 'Moderate Tendency';
                advice = currentLanguage === 'zh'
                    ? 'é€™äº›ç‰¹å¾µåœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­æœ‰æ‰€è¡¨ç¾ã€‚é€éæ­é…é‹å‹•ã€æ”¾é¬†ç·´ç¿’å’Œçµæ§‹åŒ–è¨ˆç•«ï¼Œé€šå¸¸å¯ä»¥çœ‹åˆ°æ˜é¡¯æ”¹å–„ã€‚'
                    : 'These characteristics show in daily life. With exercise, relaxation practices, and structured planning, you can usually see significant improvements.';
            } else if (score <= 35) {
                level = currentLanguage === 'zh' ? 'é¡¯è‘—å‚¾å‘' : 'Significant Tendency';
                advice = currentLanguage === 'zh'
                    ? 'é€™äº›ç‰¹å¾µåœ¨ä½ çš„ç”Ÿæ´»ä¸­è¼ƒç‚ºæ˜é¡¯ã€‚å»ºè­°çµåˆæœ¬å·¥å…·ä¸¦è€ƒæ…®å°‹æ±‚å°ˆæ¥­è©•ä¼°ï¼Œä»¥æ‰¾åˆ°æœ€é©åˆçš„æ”¯æŒæ–¹å¼ã€‚'
                    : 'These characteristics are more noticeable in your life. Consider combining this tool with professional evaluation to find the best support.';
            } else {
                level = currentLanguage === 'zh' ? 'é¡¯è‘—å‚¾å‘' : 'Significant Tendency';
                advice = currentLanguage === 'zh'
                    ? 'é€™äº›ç‰¹å¾µåœ¨ä½ çš„ç”Ÿæ´»ä¸­å½±éŸ¿é¡¯è‘—ã€‚å»ºè­°å„ªå…ˆé€²è¡Œå°ˆæ¥­è©•ä¼°ï¼ŒåŒæ™‚æœ¬å·¥å…·å¯ä½œç‚ºæ—¥å¸¸æ”¯æŒçš„è£œå……æ‰‹æ®µã€‚'
                    : 'These characteristics significantly impact your life. Professional evaluation is recommended, while this tool can support daily management.';
            }

            const resultHTML = `
                <div class="score-card">
                    <div class="score-level">${level}</div>
                    <div class="score-number">${score}/50</div>
                    <div class="score-advice">${advice}</div>
                </div>
            `;

            const resultDiv = document.getElementById('assessmentResult');
            resultDiv.innerHTML = resultHTML;
            resultDiv.classList.remove('hidden');

            const now = new Date();
            const dateStr = currentLanguage === 'zh' 
                ? now.toLocaleDateString('zh-TW') + ' ' + now.toLocaleTimeString('zh-TW')
                : now.toLocaleDateString('en-US') + ' ' + now.toLocaleTimeString('en-US');
            
            const record = { id: Date.now(), date: dateStr, score: score, level: level, advice: advice };
            assessmentHistory.push(record);
            localStorage.setItem('assessmentHistory', JSON.stringify(assessmentHistory));

            document.getElementById('assessmentReportSection').style.display = 'block';
            document.getElementById('reportTime').textContent = (currentLanguage === 'zh' ? 'æœ¬æ¬¡è©•ä¼°æ™‚é–“: ' : 'This Assessment Time: ') + record.date;
            document.getElementById('reportContent').innerHTML = `<strong>${level}</strong> (${score}/50)<br><p>${advice}</p>`;

            renderAssessmentHistory();
            addXP(50);
        }

        function renderAssessmentHistory() {
            const list = document.getElementById('assessmentHistoryList');
            if (!list) return;
            if (assessmentHistory.length === 0) {
                list.innerHTML = `<p style="color: var(--text-secondary); font-size:0.9em;">${t('noAssessmentText')}</p>`;
                return;
            }

            list.innerHTML = assessmentHistory.slice().reverse().map(rec => {
                return `
                    <div style="padding:12px; margin:6px 0; border-radius:8px; background:rgba(74,144,226,0.08); display:flex; flex-direction:column; gap:4px;">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <span style="font-size:0.9em; color:var(--text-secondary);">${rec.date}</span>
                            <button class="btn btn-secondary" style="padding:4px 10px; font-size:0.8em; margin:0;" onclick="deleteAssessmentRecord(${rec.id});">${t('deleteText')}</button>
                        </div>
                        <div style="font-size:0.95em;">
                            <strong>${rec.level}</strong>ã€€<strong>${rec.score}/50</strong>
                        </div>
                        <div style="font-size:0.85em; color:var(--text-secondary);">${rec.advice}</div>
                    </div>
                `;
            }).join('');
        }

        function deleteAssessmentRecord(id) {
            assessmentHistory = assessmentHistory.filter(r => r.id !== id);
            localStorage.setItem('assessmentHistory', JSON.stringify(assessmentHistory));
            renderAssessmentHistory();
        }

        function sendReportToEmail() {
            const email = document.getElementById('emailInput').value;
            if (!email) {
                alert(currentLanguage === 'zh' ? 'è«‹è¼¸å…¥éƒµç®±åœ°å€' : 'Please enter email address');
                return;
            }

            let reportContent = currentLanguage === 'zh' ? '===== ADHD å®Œæ•´è©•ä¼°å ±å‘Š =====' : '===== ADHD Complete Assessment Report =====';
            reportContent += '\n\n';

            reportContent += (currentLanguage === 'zh' ? 'ğŸ“‹ è©•ä¼°æ­·å²:\n' : 'ğŸ“‹ Assessment History:\n');
            if (assessmentHistory.length === 0) {
                reportContent += currentLanguage === 'zh' ? 'ç›®å‰å°šç„¡è©•ä¼°è¨˜éŒ„ã€‚\n' : 'No assessment records yet.\n';
            } else {
                assessmentHistory.forEach((record, idx) => {
                    reportContent += `${idx + 1}. ${record.date} - ${record.level} (${record.score}/50)\n`;
                });
            }

            reportContent += '\n' + (currentLanguage === 'zh' ? 'âœ… å·²å®Œæˆä»»å‹™: ' : 'âœ… Completed Tasks: ') + tasks.filter(t => t.completed).length + '/' + tasks.length + '\n';
            reportContent += '\n' + (currentLanguage === 'zh' ? 'â­ æˆå°±:\n' : 'â­ Achievements:\n');
            reportContent += (currentLanguage === 'zh' ? 'ç­‰ç´š: ' : 'Level: ') + stats.level + '\n';
            reportContent += 'XP: ' + stats.xp + '\n';
            reportContent += (currentLanguage === 'zh' ? 'é€£çºŒæˆåŠŸæ—¥: ' : 'Consecutive Days: ') + stats.streak + '\n';
            reportContent += (currentLanguage === 'zh' ? 'ç¸½æ­£å¿µå‘¼å¸åˆ†é˜æ•¸: ' : 'Total Breathing Minutes: ') + stats.totalMinutes;

            const mailtoLink = `mailto:${email}?subject=${encodeURIComponent(currentLanguage === 'zh' ? 'ADHDè©•ä¼°å ±å‘Š' : 'ADHD Assessment Report')}&body=${encodeURIComponent(reportContent)}`;
            window.location.href = mailtoLink;
        }

        // ========== èƒ½é‡ç³»çµ± ==========
        function setEnergy(level) {
            document.querySelectorAll('.energy-btn').forEach((btn, idx) => {
                btn.classList.remove('btn');
                btn.classList.add('btn-secondary');
            });

            document.getElementById(`energyBtn${level}`).classList.remove('btn-secondary');
            document.getElementById(`energyBtn${level}`).classList.add('btn');
            document.getElementById(`energyBtn${level}`).style.transform = 'scale(1.05)';

            const energyTexts = currentLanguage === 'zh' ? energyTextsZh : energyTextsEn;
            const recommendations = currentLanguage === 'zh' ? energyRecommendationsZh : energyRecommendationsEn;

            const html = `
                <strong>${energyTexts[level]}</strong><br><br>
                ğŸ’¡ ${currentLanguage === 'zh' ? 'å»ºè­°' : 'Recommendations'}ï¼š${recommendations[level].join(' â€¢ ')}
            `;

            document.getElementById('energyRecommendation').innerHTML = html;
            document.getElementById('energyRecommendation').style.display = 'block';
            addXP(20);
        }

        // ========== æ—¥ç¨‹ç³»çµ± ==========
        function renderRoutines() {
            morningRoutine = morningRoutine.filter(item => typeof item === 'string' && item.trim().length > 0);
            eveningRoutine = eveningRoutine.filter(item => typeof item === 'string' && item.trim().length > 0);
            localStorage.setItem('morningRoutine', JSON.stringify(morningRoutine));
            localStorage.setItem('eveningRoutine', JSON.stringify(eveningRoutine));

            document.getElementById('morningRoutine').innerHTML = morningRoutine.map((item, i) => `
                <div style="display: flex; align-items: center; gap: 8px; padding: 12px; background: rgba(80, 196, 196, 0.1); border-radius: 8px; margin: 8px 0;">
                    <input type="checkbox" onchange="handleRoutineCheck('morning', ${i})" style="width: 20px; height: 20px; cursor: pointer;">
                    <span style="flex: 1;">${item}</span>
                    <button class="btn btn-secondary" onclick="deleteMorningRoutine(${i})" style="padding: 5px 10px; margin: 0; font-size: 0.8em;">ğŸ—‘ï¸</button>
                </div>
            `).join('');

            document.getElementById('eveningRoutine').innerHTML = eveningRoutine.map((item, i) => `
                <div style="display: flex; align-items: center; gap: 8px; padding: 12px; background: rgba(80, 196, 196, 0.1); border-radius: 8px; margin: 8px 0;">
                    <input type="checkbox" onchange="handleRoutineCheck('evening', ${i})" style="width: 20px; height: 20px; cursor: pointer;">
                    <span style="flex: 1;">${item}</span>
                    <button class="btn btn-secondary" onclick="deleteEveningRoutine(${i})" style="padding: 5px 10px; margin: 0; font-size: 0.8em;">ğŸ—‘ï¸</button>
                </div>
            `).join('');
        }

        function handleRoutineCheck(type, index) {
            const messages = emotionalMessages.completion;
            const msg = messages[Math.floor(Math.random() * messages.length)][currentLanguage];
            document.getElementById('emotionalText').textContent = msg;
            document.getElementById('emotionalMessage').style.display = 'block';
            setTimeout(() => { document.getElementById('emotionalMessage').style.display = 'none'; }, 3000);
            addXP(10);
        }

        function addMorningRoutine() {
            const input = document.getElementById('newMorningInput');
            if (input.value.trim()) {
                morningRoutine.push(input.value);
                localStorage.setItem('morningRoutine', JSON.stringify(morningRoutine));
                input.value = '';
                renderRoutines();
                addXP(15);
            }
        }

        function addEveningRoutine() {
            const input = document.getElementById('newEveningInput');
            if (input.value.trim()) {
                eveningRoutine.push(input.value);
                localStorage.setItem('eveningRoutine', JSON.stringify(eveningRoutine));
                input.value = '';
                renderRoutines();
                addXP(15);
            }
        }

        function deleteMorningRoutine(index) {
            morningRoutine.splice(index, 1);
            localStorage.setItem('morningRoutine', JSON.stringify(morningRoutine));
            renderRoutines();
        }

        function deleteEveningRoutine(index) {
            eveningRoutine.splice(index, 1);
            localStorage.setItem('eveningRoutine', JSON.stringify(eveningRoutine));
            renderRoutines();
        }

        // ========== ä»»å‹™ç³»çµ± ==========
        function addTask() {
            const input = document.getElementById('newTaskInput');
            if (input.value.trim()) {
                tasks.push({ text: input.value, completed: false, date: new Date().toDateString() });
                localStorage.setItem('tasks', JSON.stringify(tasks));
                input.value = '';
                renderTasks();
                showEmotionalMessage('completion');
                addXP(10);
            }
        }

        function toggleTask(index) {
            tasks[index].completed = !tasks[index].completed;
            localStorage.setItem('tasks', JSON.stringify(tasks));
            renderTasks();
            if (tasks[index].completed) {
                showEmotionalMessage('completion');
                addXP(50);
            }
        }

        function deleteTask(index) {
            tasks.splice(index, 1);
            localStorage.setItem('tasks', JSON.stringify(tasks));
            renderTasks();
        }

        function openTaskBreakdown() {
            const selected = tasks.find((t, i) => !t.completed);
            if (!selected) {
                alert(currentLanguage === 'zh' ? 'è«‹å…ˆé¸æ“‡ä¸€å€‹æœªå®Œæˆçš„ä»»å‹™' : 'Please select an incomplete task first');
                return;
            }
            currentBreakdownTask = selected;
            breakdownSteps = [];
            document.getElementById('taskStepsList').innerHTML = '';
            document.getElementById('newStepInput').value = '';
            document.getElementById('taskBreakdownModal').style.display = 'block';
        }

        function addTaskStep() {
            const input = document.getElementById('newStepInput');
            if (input.value.trim()) {
                breakdownSteps.push(input.value.trim());
                input.value = '';
                renderTaskSteps();
            }
        }

        function renderTaskSteps() {
            const container = document.getElementById('taskStepsList');
            if (breakdownSteps.length === 0) {
                container.innerHTML = `<p style="text-align: center; color: var(--text-secondary);">${currentLanguage === 'zh' ? 'é‚„æ²’æœ‰æ­¥é©Ÿ' : 'No steps yet'}</p>`;
                return;
            }
            container.innerHTML = breakdownSteps.map((step, i) => `
                <div class="task-step-item">
                    <span>${i + 1}. ${step}</span>
                    <button class="btn btn-secondary" onclick="removeTaskStep(${i});" style="padding: 5px 10px; font-size: 0.8em;">ğŸ—‘ï¸</button>
                </div>
            `).join('');
        }

        function removeTaskStep(index) {
            breakdownSteps.splice(index, 1);
            renderTaskSteps();
        }

        function confirmTaskBreakdown() {
            if (breakdownSteps.length === 0) {
                alert(currentLanguage === 'zh' ? 'è«‹è‡³å°‘æ·»åŠ ä¸€å€‹æ­¥é©Ÿ' : 'Please add at least one step');
                return;
            }
            tasks = tasks.filter(t => t !== currentBreakdownTask);
            breakdownSteps.forEach(step => {
                tasks.push({ text: step, completed: false, date: new Date().toDateString(), parent: currentBreakdownTask.text });
            });
            localStorage.setItem('tasks', JSON.stringify(tasks));
            renderTasks();
            closeTaskBreakdown();
            addXP(20);
        }

        function closeTaskBreakdown() {
            document.getElementById('taskBreakdownModal').style.display = 'none';
            currentBreakdownTask = null;
            breakdownSteps = [];
        }

        function renderTasks() {
            const container = document.getElementById('taskList');
            if (tasks.length === 0) {
                container.innerHTML = `<p style="text-align: center; color: var(--text-secondary);">${t('noTaskText')}</p>`;
                document.getElementById('taskProgress').style.width = '0%';
                return;
            }

            const completed = tasks.filter(t => t.completed).length;
            const percentage = (completed / tasks.length) * 100;

            container.innerHTML = tasks.map((task, i) => `
                <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: ${task.completed ? 'rgba(127, 207, 192, 0.15)' : 'rgba(74, 144, 226, 0.08)'}; border-radius: 8px; margin: 8px 0; text-decoration: ${task.completed ? 'line-through' : 'none'};">
                    <input type="checkbox" ${task.completed ? 'checked' : ''} onchange="toggleTask(${i})" style="width: 18px; height: 18px; cursor: pointer;">
                    <span style="flex: 1;">${task.parent ? 'â”œâ”€ ' : ''}${task.text}</span>
                    <button class="btn btn-secondary" onclick="deleteTask(${i});" style="padding: 6px 12px; font-size: 0.85em; margin: 0;">ğŸ—‘ï¸</button>
                </div>
            `).join('');

            document.getElementById('taskProgress').style.width = percentage + '%';
        }

        // ========== è¨ˆæ™‚å™¨ç³»çµ± ==========
        function resetTimerInput() {
            document.getElementById('timerMinutes').value = '25';
            timeLeft = 25 * 60;
            updateTimerDisplay();
        }

        function openAlarmSelection() {
            const modal = document.getElementById('alarmSelectionModal');
            const listContainer = document.getElementById('alarmOptionsList');
            
            listContainer.innerHTML = Object.entries(alarmSoundsConfig).map(([key, config]) => {
                const name = config.name[currentLanguage];
                return `
                    <div class="alarm-option ${currentAlarmSound === key ? 'selected' : ''}" onclick="selectAlarm('${key}')">
                        ${name}
                    </div>
                `;
            }).join('');
            
            modal.style.display = 'block';
        }

        function selectAlarm(sound) {
            currentAlarmSound = sound;
            document.querySelectorAll('.alarm-option').forEach(el => el.classList.remove('selected'));
            event.target.classList.add('selected');
            
            // æ’­æ”¾é è¦½
            playAlarmSound();
            
            setTimeout(() => {
                document.getElementById('alarmSelectionModal').style.display = 'none';
            }, 800);
        }

        function testAlarmSound() {
            playAlarmSound();
        }

        function playAlarmSound(customVolume) {
            const config = alarmSoundsConfig[currentAlarmSound];
            if (!config) return;

            // ä½¿ç”¨æ»‘æ¡¿éŸ³é‡æˆ–å‚³å…¥çš„è‡ªè¨‚éŸ³é‡
            const volumeSlider = document.getElementById('volumeSlider');
            const volume = customVolume !== undefined ? customVolume : (volumeSlider ? volumeSlider.value / 100 * 0.5 : 0.3);

            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                if (config.isSequence) {
                    let time = audioContext.currentTime;
                    config.sequence.forEach(note => {
                        if (note.freq === 0) { // éœéŸ³
                            time += note.dur;
                            return;
                        }
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        gainNode.connect(audioContext.destination);
                        oscillator.connect(gainNode);
                        gainNode.gain.setValueAtTime(volume, time);
                        oscillator.frequency.value = note.freq;
                        oscillator.type = 'sine';
                        oscillator.start(time);
                        oscillator.stop(time + note.dur);
                        time += note.dur;
                    });
                } else {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    gainNode.connect(audioContext.destination);
                    oscillator.connect(gainNode);
                    gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
                    oscillator.frequency.value = config.freq;
                    oscillator.type = 'sine';
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + config.duration);
                }
            } catch (e) {
                console.log('Audio playback not supported');
            }
        }

        function startTimer() {
            const inputMinutes = parseInt(document.getElementById('timerMinutes').value);
            if (inputMinutes < 1 || inputMinutes > 60) {
                alert(currentLanguage === 'zh' ? 'è«‹è¼¸å…¥1-60åˆ†é˜' : 'Please enter 1-60 minutes');
                return;
            }

            timerDuration = inputMinutes * 60;
            timeLeft = timerDuration;

            document.getElementById('startTimerBtn').classList.add('hidden');
            document.getElementById('stopTimerBtn').classList.remove('hidden');
            document.getElementById('timerMinutes').disabled = true;

            updateTimerDisplay();

            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    document.getElementById('startTimerBtn').classList.remove('hidden');
                    document.getElementById('stopTimerBtn').classList.add('hidden');
                    document.getElementById('timerMinutes').disabled = false;
                    
                    const volume = document.getElementById('volumeSlider').value / 100;
                    playAlarmSound(volume * 0.5);
                    
                    document.getElementById('timerMessage').innerHTML = `<div class="emotional-feedback positive" style="display: block;">ğŸ‰ ${t('doneMsg')}</div>`;
                    
                    addXP(Math.min(100, inputMinutes * 10));
                    stats.totalMinutes += inputMinutes;
                    localStorage.setItem('stats', JSON.stringify(stats));
                    updateTopStats();
                    timeLeft = timerDuration;
                }
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
            document.getElementById('startTimerBtn').classList.remove('hidden');
            document.getElementById('stopTimerBtn').classList.add('hidden');
            document.getElementById('timerMinutes').disabled = false;
            timeLeft = timerDuration;
            updateTimerDisplay();
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timerDisplay').textContent = 
                String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0');

            const progress = ((timerDuration - timeLeft) / timerDuration) * 100;
            document.getElementById('timerProgress').style.width = progress + '%';
        }

        // ========== æƒ…ç·’ç³»çµ± ==========
        function logEmotion(emotion) {
            const now = new Date();
            emotionLog.push({ 
                emotion, 
                time: now.toLocaleTimeString(currentLanguage === 'zh' ? 'zh-TW' : 'en-US'),
                date: now.toLocaleDateString(currentLanguage === 'zh' ? 'zh-TW' : 'en-US')
            });
            localStorage.setItem('emotionLog', JSON.stringify(emotionLog));
            renderEmotionLog();
            showEmotionalMessage('completion');
            addXP(20);
        }

        function deleteEmotionLog(index) {
            emotionLog.splice(index, 1);
            localStorage.setItem('emotionLog', JSON.stringify(emotionLog));
            renderEmotionLog();
        }

        function renderEmotionLog() {
            const emotionMapZh = { happy: 'ğŸ˜Š é–‹å¿ƒ', calm: 'ğŸ˜Œ å¹³éœ', sad: 'ğŸ˜¢ é›£é', anxious: 'ğŸ˜° ç„¦æ…®' };
            const emotionMapEn = { happy: 'ğŸ˜Š Happy', calm: 'ğŸ˜Œ Calm', sad: 'ğŸ˜¢ Sad', anxious: 'ğŸ˜° Anxious' };
            const emotionMap = currentLanguage === 'zh' ? emotionMapZh : emotionMapEn;
            const container = document.getElementById('emotionLog');
            const timeLabel = currentLanguage === 'zh' ? 'æ™‚é–“: ' : 'Time: ';

            if (emotionLog.length === 0) {
                container.innerHTML = `<p style="text-align: center; color: var(--text-secondary);">${t('noEmotionText')}</p>`;
                return;
            }

            container.innerHTML = emotionLog.slice(-10).map((log, i) => `
                <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: rgba(80, 196, 196, 0.1); border-radius: 8px; margin: 8px 0;">
                    <span style="flex: 1;">${emotionMap[log.emotion]} â€” ${log.date} ${log.time}</span>
                    <button class="btn btn-secondary" onclick="deleteEmotionLog(${emotionLog.length - 10 + i});" style="padding: 5px 10px; margin: 0; font-size: 0.8em;">ğŸ—‘ï¸</button>
                </div>
            `).reverse().join('');
        }

        function sendCompletedReportToEmail() {
            const email = document.getElementById('emotionEmailInput').value;
            
            if (!email) {
                alert(currentLanguage === 'zh' ? 'è«‹è¼¸å…¥éƒµç®±åœ°å€' : 'Please enter email address');
                return;
            }

            let reportContent = currentLanguage === 'zh' ? '===== ADHD å®Œæ•´æˆå°±å ±å‘Š =====' : '===== ADHD Complete Achievement Report =====';
            reportContent += '\n\n';

            reportContent += (currentLanguage === 'zh' ? 'â­ ç•¶å‰æˆå°±:\n' : 'â­ Current Achievements:\n');
            reportContent += (currentLanguage === 'zh' ? 'ç­‰ç´š: Lv.' : 'Level: Lv.') + stats.level + '\n';
            reportContent += 'XP: ' + stats.xp + '/100\n';
            reportContent += (currentLanguage === 'zh' ? 'é€£çºŒæˆåŠŸæ—¥: ' : 'Consecutive Days: ') + stats.streak + '\n';
            reportContent += (currentLanguage === 'zh' ? 'ç¸½æ­£å¿µå‘¼å¸åˆ†é˜æ•¸: ' : 'Total Breathing Minutes: ') + stats.totalMinutes + '\n\n';

            reportContent += (currentLanguage === 'zh' ? 'âœ… ä»»å‹™ç®¡ç†:\n' : 'âœ… Task Management:\n');
            reportContent += (currentLanguage === 'zh' ? 'å·²å®Œæˆ: ' : 'Completed: ') + tasks.filter(t => t.completed).length + '\n';
            reportContent += (currentLanguage === 'zh' ? 'é€²è¡Œä¸­: ' : 'In Progress: ') + tasks.filter(t => !t.completed).length + '\n\n';

            reportContent += (currentLanguage === 'zh' ? 'ğŸ’­ æƒ…ç·’æ—¥èªŒ:\n' : 'ğŸ’­ Emotion Journal:\n');
            if (emotionLog.length > 0) {
                const emotionMapZh = { happy: 'ğŸ˜Š é–‹å¿ƒ', calm: 'ğŸ˜Œ å¹³éœ', sad: 'ğŸ˜¢ é›£é', anxious: 'ğŸ˜° ç„¦æ…®' };
                const emotionMapEn = { happy: 'ğŸ˜Š Happy', calm: 'ğŸ˜Œ Calm', sad: 'ğŸ˜¢ Sad', anxious: 'ğŸ˜° Anxious' };
                const emotionMap = currentLanguage === 'zh' ? emotionMapZh : emotionMapEn;
                const emotionCounts = {};
                emotionLog.forEach(log => {
                    emotionCounts[log.emotion] = (emotionCounts[log.emotion] || 0) + 1;
                });
                Object.keys(emotionCounts).forEach(emotion => {
                    reportContent += `${emotionMap[emotion]}: ${emotionCounts[emotion]} ${currentLanguage === 'zh' ? 'æ¬¡' : 'times'}\n`;
                });
            } else {
                reportContent += (currentLanguage === 'zh' ? 'æš«ç„¡æƒ…ç·’è¨˜éŒ„\n' : 'No emotion records\n');
            }

            const mailtoLink = `mailto:${email}?subject=${encodeURIComponent(currentLanguage === 'zh' ? 'ADHDå®Œæ•´æˆå°±å ±å‘Š' : 'ADHD Complete Report')}&body=${encodeURIComponent(reportContent)}`;
            window.location.href = mailtoLink;
        }

        // ========== ç™‚ç™’å·¥å…· ==========
        function toggleBreathing() {
            const circle = document.getElementById('breathingCircle');

            if (isBreathingAnimating) {
                isBreathingAnimating = false;
                circle.classList.remove('animating');
                updateBreathingText();
            } else {
                isBreathingAnimating = true;
                circle.classList.add('animating');
                updateBreathingText();
                startBreathingSession();
            }
        }

        function startBreathingSession() {
            const stagesZh = ['å¸æ°£...', 'å±æ°£...', 'å‘¼æ°£...'];
            const stagesEn = ['Inhale...', 'Hold...', 'Exhale...'];
            const stages = currentLanguage === 'zh' ? stagesZh : stagesEn;
            const stageClasses = ['inhale', 'hold', 'exhale'];
            let cycleCount = 0;
            let stageIndex = 0;
            const text = document.getElementById('breathText');
            const circle = document.getElementById('breathingCircle');

            function runStage() {
                if (!isBreathingAnimating) return;

                text.innerHTML = stages[stageIndex];
                
                // ç§»é™¤æ‰€æœ‰å‹•ç•«é¡åˆ¥
                circle.classList.remove('inhale', 'hold', 'exhale');
                
                // æ·»åŠ ç•¶å‰éšæ®µçš„é¡åˆ¥
                circle.classList.add(stageClasses[stageIndex]);
                
                stageIndex++;
                if (stageIndex >= 3) {
                    stageIndex = 0;
                    cycleCount++;
                }

                if (cycleCount < 5) {
                    setTimeout(runStage, 4000);
                } else {
                    isBreathingAnimating = false;
                    circle.classList.remove('animating', 'inhale', 'hold', 'exhale');
                    text.innerHTML = t('breatingDoneMsg');
                    addXP(50);
                    showEmotionalMessage('completion');
                }
            }

            runStage();
        }

        function openCognitiveRestructuring() {
            document.getElementById('customInputQuestion').textContent = t('customInputQuestion');
            document.getElementById('submitCognitiveBtn').textContent = t('submitCognitiveBtn');
            document.getElementById('cancelCognitiveBtn').textContent = t('cancelCognitiveBtn');
            document.getElementById('customInputModal').style.display = 'block';
            document.getElementById('customInputField').focus();
        }

        function submitCognitiveInput() {
            const thought = document.getElementById('customInputField').value.trim();
            if (!thought) return;

            closeCognitiveInputModal();

            const contentZh = `
                <div style="text-align: left; line-height: 1.8;">
                    <div style="margin-bottom: 20px;">
                        <strong style="color: var(--accent-teal); font-size: 1.1em;">ğŸ’­ ä½ çš„è² é¢æƒ³æ³•</strong><br/>
                        <span style="color: var(--text-primary);">${thought}</span>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <strong style="color: var(--accent-teal); font-size: 1.1em;">âœ¨ é‡æ–°æ¡†æ¶åŒ–</strong><br/>
                        <ul style="margin-left: 20px; color: var(--text-primary);">
                            <li>é€™å€‹æƒ³æ³•åªæ˜¯æš«æ™‚çš„ç‹€æ…‹ï¼Œä¸ä»£è¡¨æ°¸ä¹…äº‹å¯¦</li>
                            <li>æˆ‘æœ‰å…‹æœé¡ä¼¼å›°é›£çš„èƒ½åŠ›å’Œç¶“é©—</li>
                            <li>è¨±å¤šäººåœ¨é¡ä¼¼æƒ…æ³ä¸‹ä¹Ÿæœ‰åŒæ¨£çš„æƒ³æ³•</li>
                            <li>æˆ‘å¯ä»¥æ¡å–å¯¦éš›è¡Œå‹•ä¾†æ”¹è®Šé€™å€‹ç‹€æ³</li>
                            <li>ä¸å®Œç¾æ˜¯äººä¹‹å¸¸æƒ…ï¼Œé€™ä¸ä»£è¡¨æˆ‘å¤±æ•—äº†</li>
                        </ul>
                    </div>
                    <div>
                        <strong style="color: var(--accent-teal); font-size: 1.1em;">ğŸ’ª ä½ å¯ä»¥åšçš„</strong><br/>
                        <span style="color: var(--text-primary);">æ·±å‘¼å¸3æ¬¡ï¼Œæé†’è‡ªå·±é€™åªæ˜¯ä¸€æ™‚çš„æ„Ÿå—ã€‚ç•¶ä½ æº–å‚™å¥½æ™‚ï¼Œå¯ä»¥æ¡å–ä¸€å€‹å°æ­¥é©Ÿä¾†æ”¹è®Šé€™å€‹ç‹€æ³ã€‚</span>
                    </div>
                </div>
            `;

            const contentEn = `
                <div style="text-align: left; line-height: 1.8;">
                    <div style="margin-bottom: 20px;">
                        <strong style="color: var(--accent-teal); font-size: 1.1em;">ğŸ’­ Your Negative Thought</strong><br/>
                        <span style="color: var(--text-primary);">${thought}</span>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <strong style="color: var(--accent-teal); font-size: 1.1em;">âœ¨ Reframing</strong><br/>
                        <ul style="margin-left: 20px; color: var(--text-primary);">
                            <li>This thought is temporary, not a permanent fact</li>
                            <li>I have the ability to overcome similar challenges</li>
                            <li>Many others have similar thoughts in similar situations</li>
                            <li>I can take concrete action to improve this</li>
                            <li>Imperfection is human; it doesn't mean I've failed</li>
                        </ul>
                    </div>
                    <div>
                        <strong style="color: var(--accent-teal); font-size: 1.1em;">ğŸ’ª What You Can Do</strong><br/>
                        <span style="color: var(--text-primary);">Take 3 deep breaths and remind yourself this is temporary. When ready, take one small step to improve the situation.</span>
                    </div>
                </div>
            `;

            const content = currentLanguage === 'zh' ? contentZh : contentEn;
            document.getElementById('cognitiveResultBody').innerHTML = content;
            document.getElementById('cognitiveResultModal').classList.add('active');
            addXP(50);
        }

        function closeCognitiveInputModal() {
            document.getElementById('customInputModal').style.display = 'none';
        }

        function closeCognitiveResultModal() {
            document.getElementById('cognitiveResultModal').classList.remove('active');
        }

        function startGrounding() {
            groundingCurrentStep = 0;
            displayGroundingStep();
        }

        function displayGroundingStep() {
            const stepsZh = [
                'ğŸ‘€ çœ‹è¦‹ 5 ä»¶æ±è¥¿\nè«‹å››è™•çœ‹çœ‹ï¼Œèªªå‡º5ä»¶ä½ èƒ½çœ‹åˆ°çš„æ±è¥¿',
                'ğŸ‘‚ è½è¦‹ 4 ç¨®è²éŸ³\néœè½ç‰‡åˆ»ï¼Œå¯Ÿè¦ºå‘¨åœ4å€‹ä¸åŒçš„è²éŸ³',
                'ğŸ‘ è§¸æ‘¸ 3 æ¨£ç‰©é«”\næ¥è§¸ä¸¦æ„Ÿå—3ä»¶ä¸åŒè³ªåœ°çš„ç‰©é«”',
                'ğŸ‘ƒ èåˆ° 2 ç¨®å‘³é“\næ‰¾åˆ°2å€‹ä½ èƒ½èåˆ°çš„æ°£å‘³',
                'ğŸ‘… åšåˆ° 1 æ¨£æ±è¥¿\nå“åšä¸€å€‹é£Ÿç‰©æˆ–é£²æ–™çš„å‘³é“'
            ];

            const stepsEn = [
                'ğŸ‘€ See 5 things\nLook around and name 5 things you can see',
                'ğŸ‘‚ Hear 4 sounds\nListen and notice 4 different sounds around you',
                'ğŸ‘ Touch 3 things\nFeel and touch 3 objects with different textures',
                'ğŸ‘ƒ Smell 2 things\nFind and smell 2 different scents',
                'ğŸ‘… Taste 1 thing\nTaste a food or drink'
            ];

            const steps = currentLanguage === 'zh' ? stepsZh : stepsEn;

            if (groundingCurrentStep >= steps.length) {
                document.getElementById('groundingModal').classList.remove('active');
                alert(t('groundingCompleteMsg'));
                addXP(50);
                showEmotionalMessage('completion');
                return;
            }

            const step = steps[groundingCurrentStep];
            document.getElementById('groundingStep').textContent = step;
            document.getElementById('groundingNextBtn').textContent = 
                groundingCurrentStep === steps.length - 1 
                    ? t('completeBtn')
                    : t('nextBtn');
            
            document.getElementById('groundingModal').classList.add('active');
        }

        function nextGroundingStep() {
            groundingCurrentStep++;
            displayGroundingStep();
        }

        // ========== é£²é£Ÿç³»çµ± ==========
        function updateNutritionPage() {
            const data = currentLanguage === 'zh' ? nutritionDataZh : nutritionDataEn;

            document.getElementById('nutritionPriority').innerHTML = data.priority.map(item => 
                `<div style="padding: 12px; background: rgba(80, 196, 196, 0.1); border-radius: 8px; margin: 8px 0; color: var(--text-primary);">${item}</div>`
            ).join('');

            document.getElementById('eatingOrder').innerHTML = data.eatingOrder.map(item =>
                `<div style="padding: 12px; background: rgba(74, 144, 226, 0.1); border-radius: 8px; margin: 8px 0; color: var(--text-primary); border-left: 4px solid var(--accent-blue);">${item}</div>`
            ).join('');

            document.getElementById('nutritionAvoid').innerHTML = data.avoid.map(item =>
                `<div style="padding: 12px; background: rgba(217, 122, 147, 0.1); border-radius: 8px; margin: 8px 0; color: var(--text-primary);">${item}</div>`
            ).join('');
        }

        // ========== æƒ…ç·’åé¥‹ ==========
        function showEmotionalMessage(type) {
            const messages = emotionalMessages[type];
            const msg = messages[Math.floor(Math.random() * messages.length)][currentLanguage];
            
            document.getElementById('emotionalText').textContent = msg;
            document.getElementById('emotionalMessage').style.display = 'block';

            setTimeout(() => {
                document.getElementById('emotionalMessage').style.display = 'none';
            }, 5000);
        }

        // ========== XPé€šçŸ¥ ==========
        function showXPNotification(amount) {
            const notification = document.createElement('div');
            notification.className = 'xp-notification';
            notification.textContent = `+${amount} XP`;
            document.getElementById('xpNotificationContainer').appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // ========== é€²åº¦ç³»çµ± ==========
        function addXP(amount) {
            stats.xp += amount;
            showXPNotification(amount);

            if (stats.xp >= 100) {
                stats.level++;
                stats.xp -= 100;
                showLevelUpModal();
            }
            localStorage.setItem('stats', JSON.stringify(stats));
            updateTopStats();
        }

        function showLevelUpModal() {
            const modal = document.getElementById('levelUpModal');
            const levelText = document.getElementById('levelUpText');
            const messageText = document.getElementById('levelUpMessage');

            levelText.textContent = (currentLanguage === 'zh' ? 'å‡ç´šåˆ° ' : 'Level Up to ') + 'Lv.' + stats.level + '!';
            const levelUpMessages = emotionalMessages.levelUp;
            messageText.textContent = levelUpMessages[Math.floor(Math.random() * levelUpMessages.length)][currentLanguage];

            modal.style.display = 'block';

            setTimeout(() => {
                modal.style.display = 'none';
            }, 3000);
        }

        // ========== åˆå§‹åŒ– ==========
        updateAllText();
        updateTopStats();
        updateNutritionPage();
        renderRoutines();
        renderAssessmentQuestions();
        renderAssessmentHistory();
    </script>
</body>
</html>
