<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADHD Focus Helper Pro Max</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a0033;
            --accent: #FF8C00;
            --accent-light: #8A2BE2;
            --success: #FFD700;
            --text: #E8E8E8;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, #2d0052 50%, var(--primary) 100%);
            min-height: 100vh;
            padding: 20px;
            padding-top: 80px;
            color: var(--text);
            display: flex;
            flex-direction: column;
            transition: background 0.5s ease, color 0.5s ease;
        }

        body.theme-1 {
            --primary: #1a0033;
            --accent: #FF8C00;
            --accent-light: #8A2BE2;
            --success: #FFD700;
            --text: #E8E8E8;
            background: linear-gradient(135deg, #1a0033 0%, #2d0052 50%, #1a0033 100%);
        }

        

        body.theme-3 {
            --primary: #D3D3D3;
            --accent: #FF9940;
            --accent-light: #003D6B;
            --success: #FF9940;
            --text: #1A1A1A;
            background: 
                repeating-linear-gradient(45deg, transparent, transparent 3px, rgba(0, 0, 0, 0.02) 3px, rgba(0, 0, 0, 0.02) 6px),
                repeating-linear-gradient(-45deg, transparent, transparent 3px, rgba(255, 255, 255, 0.08) 3px, rgba(255, 255, 255, 0.08) 6px),
                linear-gradient(135deg, #E8E8E8 0%, #C0C0C0 25%, #E0E0E0 50%, #C0C0C0 75%, #E8E8E8 100%);
            background-attachment: fixed;
        }

        body.theme-4 {
            --primary: #6F8F4F;
            --accent: #C47A3A;
            --accent-light: #B08D57;
            --success: #C47A3A;
            --text: #F7F3E8;
            --border-neutral: #E6E6E6;
            --dark-support: #8A5A3B;
            --main-bg: #F7F3E8;
            background: 
                repeating-linear-gradient(45deg, transparent, transparent 4px, rgba(138, 90, 59, 0.04) 4px, rgba(138, 90, 59, 0.04) 8px),
                repeating-linear-gradient(-45deg, transparent, transparent 4px, rgba(255, 255, 255, 0.03) 4px, rgba(255, 255, 255, 0.03) 8px),
                linear-gradient(135deg, #F7F3E8 0%, #F0EBE0 50%, #F7F3E8 100%);
            background-attachment: fixed;
        }

        .control-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 8px;
            align-items: center;
            z-index: 1002;
            background: rgba(var(--primary-rgb, 26), var(--primary-grb, 0), var(--primary-brg, 51), 0.95);
            padding: 8px 12px;
            border-radius: 8px;
            border: 2px solid var(--accent);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            height: 44px;
        }

        .control-btn {
            padding: 6px 10px;
            border: none;
            background: rgba(0, 0, 0, 0.3);
            color: var(--accent);
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1em;
            transition: all 0.3s;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
            -webkit-user-select: none;
            user-select: none;
            white-space: nowrap;
            height: 30px;
        }

        .control-btn:hover {
            background: var(--accent);
            color: var(--primary);
            transform: scale(1.05);
        }

        .control-btn.active {
            background: var(--accent);
            color: var(--primary);
            box-shadow: 0 0 10px rgba(var(--accent-rgb, 255), var(--accent-grb, 140), var(--accent-brg, 0), 0.5);
        }

        .control-btn i {
            font-size: 1em;
        }

        .control-btn span {
            font-size: 0.85em;
            margin-left: 2px;
        }

        .control-separator {
            width: 1px;
            height: 16px;
            background: var(--accent);
            opacity: 0.3;
        }

        .language-toggle {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(var(--primary-rgb, 26), var(--primary-grb, 0), var(--primary-brg, 51), 0.95);
            border: 2px solid var(--accent);
            border-radius: 8px;
            padding: 0;
            z-index: 1001;
            display: flex;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            height: 44px;
        }

        .lang-btn {
            padding: 10px 16px;
            border: none;
            background: rgba(var(--primary-rgb, 26), var(--primary-grb, 0), var(--primary-brg, 51), 0.95);
            color: var(--accent);
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95em;
            transition: all 0.3s;
            border-radius: 6px;
            margin: 2px;
            display: flex;
            align-items: center;
        }

        .lang-btn.active {
            background: var(--accent);
            color: var(--primary);
        }

        .lang-btn:hover {
            background: var(--accent);
            color: var(--primary);
        }

        .container { max-width: 800px; margin: 0 auto; flex: 1; }

        header {
            text-align: center;
            color: var(--accent);
            margin-bottom: 30px;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(var(--accent-rgb, 255), var(--accent-grb, 140), var(--accent-brg, 0), 0.3);
            color: var(--accent);
            transition: all 0.3s ease;
        }

        header p { 
            font-size: 1.1em; 
            opacity: 0.9; 
            color: var(--text);
            transition: color 0.3s ease;
        }

        .level-badge {
            position: fixed;
            top: 25px;
            right: 20px;
            background: linear-gradient(135deg, var(--accent-light), rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.8));
            color: var(--text);
            padding: 15px 20px;
            border-radius: 10px;
            font-weight: bold;
            z-index: 999;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            font-size: 0.9em;
            animation: levelBadgeEntry 2s cubic-bezier(0.34, 1.56, 0.64, 1);
            transition: all 0.3s ease;
        }

        @keyframes levelBadgeEntry {
            0% {
                transform: scale(0) rotate(-180deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.15) rotate(10deg);
                opacity: 1;
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        .nav-scroll {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(var(--primary-rgb, 26), var(--primary-grb, 0), var(--primary-brg, 51), 0.9);
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            z-index: 998;
            display: flex;
            flex-direction: column;
            gap: 5px;
            transition: background 0.3s ease;
        }

        .nav-scroll-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: linear-gradient(135deg, var(--accent), rgba(var(--accent-rgb, 255), var(--accent-grb, 140), var(--accent-brg, 0), 0.8));
            color: var(--primary);
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            -webkit-user-select: none;
            user-select: none;
        }

        .nav-scroll-btn:active { transform: scale(0.95); }
        .nav-scroll-btn:hover { transform: scale(1.1); box-shadow: 0 4px 15px rgba(var(--accent-rgb, 255), var(--accent-grb, 140), var(--accent-brg, 0), 0.4); }

        .nav-scroll-label {
            position: absolute;
            right: 50px;
            background: var(--accent);
            color: var(--primary);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            white-space: nowrap;
            display: none;
            z-index: 999;
            font-weight: 600;
        }

        .nav-scroll-btn:hover .nav-scroll-label { display: block; }

        .section {
            background: linear-gradient(135deg, rgba(var(--primary-rgb, 26), var(--primary-grb, 0), var(--primary-brg, 51), 0.8), rgba(45, 0, 82, 0.8));
            padding: 30px;
            margin: 20px 0;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            animation: slideIn 0.5s ease;
            border-left: 4px solid var(--accent);
            backdrop-filter: blur(10px);
            transition: background 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 { 
            color: var(--accent); 
            margin-bottom: 20px; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            text-shadow: 0 0 10px rgba(var(--accent-rgb, 255), var(--accent-grb, 140), var(--accent-brg, 0), 0.2);
            transition: color 0.3s ease;
        }
        
        h3 { 
            color: var(--accent); 
            margin-top: 20px; 
            margin-bottom: 15px; 
            text-shadow: 0 0 10px rgba(var(--accent-rgb, 255), var(--accent-grb, 140), var(--accent-brg, 0), 0.2);
            transition: color 0.3s ease;
        }

        h4 {
            color: var(--accent);
            text-shadow: 0 0 10px rgba(var(--accent-rgb, 255), var(--accent-grb, 140), var(--accent-brg, 0), 0.2);
            transition: color 0.3s ease;
        }

        .btn {
            background: linear-gradient(135deg, var(--accent), rgba(var(--accent-rgb, 255), var(--accent-grb, 140), var(--accent-brg, 0), 0.9));
            color: var(--primary);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            margin: 10px 10px 10px 0;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
            font-weight: 600;
        }

        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(var(--accent-rgb, 255), var(--accent-grb, 140), var(--accent-brg, 0), 0.4); }
        .btn:active { transform: translateY(0px); }
        .btn-success { background: linear-gradient(135deg, var(--success), rgba(var(--success-rgb, 255), var(--success-grb, 215), var(--success-brg, 0), 0.9)); color: var(--primary); }
        .btn-success:hover { box-shadow: 0 5px 20px rgba(var(--success-rgb, 255), var(--success-grb, 215), var(--success-brg, 0), 0.4); }
        .btn-danger { background: linear-gradient(135deg, var(--accent-light), rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.9)); color: var(--text); }
        .btn-danger:hover { box-shadow: 0 5px 20px rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.4); }
        .btn-small { padding: 8px 16px; font-size: 0.9em; }

        .question-group { 
            background: rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.2); 
            padding: 15px; 
            margin: 15px 0; 
            border-radius: 8px; 
            border-left: 4px solid var(--accent-light);
            transition: background 0.3s ease;
        }
        
        .question-group label { display: block; margin: 10px 0; font-weight: 500; color: var(--text); transition: color 0.3s ease; }

        .tip { 
            background: rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.2); 
            padding: 15px; 
            border-radius: 8px; 
            margin: 15px 0; 
            border-left: 4px solid var(--accent-light); 
            display: flex; 
            gap: 10px; 
            color: var(--text);
            transition: all 0.3s ease;
        }
        
        .tip i { color: var(--accent-light); font-size: 1.3em; flex-shrink: 0; }

        .score-card { 
            background: linear-gradient(135deg, var(--accent-light), rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.8)); 
            color: var(--text); 
            padding: 25px; 
            border-radius: 12px; 
            text-align: center; 
            margin: 20px 0; 
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        .score-card .number { font-size: 3em; font-weight: bold; margin: 10px 0; color: var(--success); }
        .score-card .level { font-size: 1.3em; opacity: 0.9; }

        .task-list { list-style: none; }
        
        .task-item { 
            background: rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.1); 
            padding: 15px; 
            margin: 12px 0; 
            border-radius: 8px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border-left: 4px solid var(--accent); 
            transition: all 0.3s; 
            color: var(--text);
        }
        
        .task-item.completed { 
            background: rgba(var(--success-rgb, 255), var(--success-grb, 215), var(--success-brg, 0), 0.15); 
            opacity: 0.7; 
            border-left-color: var(--success); 
        }
        
        .task-item.completed span { text-decoration: line-through; }
        .task-item:hover { transform: translateX(5px); box-shadow: 0 2px 10px rgba(var(--accent-rgb, 255), var(--accent-grb, 140), var(--accent-brg, 0), 0.2); }
        .task-actions { display: flex; gap: 8px; }

        #timer { 
            text-align: center; 
            font-size: 5em; 
            font-weight: bold; 
            color: var(--accent); 
            margin: 30px 0; 
            font-family: 'Courier New', monospace; 
            animation: pulse 1s infinite; 
            text-shadow: 0 0 20px rgba(var(--accent-rgb, 255), var(--accent-grb, 140), var(--accent-brg, 0), 0.3);
            transition: color 0.3s ease;
        }
        
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }

        .timer-display { 
            text-align: center; 
            background: linear-gradient(135deg, rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.2), rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.15));
            padding: 25px;
            border-radius: 12px;
            border: 2px solid var(--accent-light);
            transition: all 0.3s ease;
        }

        #progress { 
            width: 100%; 
            height: 30px; 
            background: rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.2); 
            border-radius: 15px; 
            overflow: hidden; 
            margin: 20px 0; 
        }
        
        .bar { 
            height: 100%; 
            background: linear-gradient(90deg, var(--accent), var(--success)); 
            width: 0%; 
            transition: width 0.5s ease; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: var(--primary); 
            font-weight: bold; 
            font-size: 0.9em; 
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
        }

        .progress-summary { 
            background: linear-gradient(135deg, rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.2), rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.15)); 
            padding: 20px; 
            border-radius: 8px; 
            text-align: center; 
            margin: 20px 0; 
            border: 2px solid var(--accent-light);
            color: var(--text);
            transition: all 0.3s ease;
        }
        
        .progress-summary .percentage { 
            font-size: 2em; 
            color: var(--success); 
            font-weight: bold; 
        }

        .input-group { display: flex; gap: 10px; margin: 20px 0; }
        
        input[type="text"], input[type="email"], select { 
            flex: 1; 
            padding: 12px; 
            border: 2px solid var(--accent); 
            border-radius: 8px; 
            font-size: 16px; 
            transition: border-color 0.3s;
            background: rgba(var(--primary-rgb, 26), var(--primary-grb, 0), var(--primary-brg, 51), 0.8);
            color: var(--text);
        }
        
        input[type="text"]:focus, input[type="email"]:focus, select:focus { 
            outline: none; 
            border-color: var(--accent-light); 
            box-shadow: 0 0 10px rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.3);
        }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 20px 0; }
        
        .stat-card { 
            background: linear-gradient(135deg, rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.2), rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.15)); 
            padding: 20px; 
            border-radius: 10px; 
            text-align: center; 
            border: 2px solid var(--accent-light);
            color: var(--text);
            transition: all 0.3s ease;
        }
        
        .stat-card .value { 
            font-size: 2em; 
            font-weight: bold; 
            color: var(--success); 
        }
        
        .stat-card .label { 
            color: var(--text); 
            margin-top: 5px; 
            font-size: 0.9em; 
        }

        .mindfulness-section { 
            background: linear-gradient(135deg, var(--accent-light), rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.8)); 
            color: var(--text); 
            padding: 25px; 
            border-radius: 12px; 
            margin: 20px 0; 
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .mindfulness-section h3 {
            color: var(--text);
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
        }

        .mindfulness-section h4 {
            color: var(--text);
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
        }

        .breath-circle { 
            width: 150px; 
            height: 150px; 
            border-radius: 50%; 
            background: rgba(var(--accent-rgb, 255), var(--accent-grb, 140), var(--accent-brg, 0), 0.2); 
            margin: 20px auto; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-weight: bold; 
            cursor: pointer; 
            transition: all 0.3s; 
            user-select: none; 
            color: var(--text);
        }
        
        .breath-circle:hover { background: rgba(var(--accent-rgb, 255), var(--accent-grb, 140), var(--accent-brg, 0), 0.4); transform: scale(1.05); }
        
        @keyframes breathPulse { 
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(var(--accent-rgb, 255), var(--accent-grb, 140), var(--accent-brg, 0), 0.7); } 
            50% { transform: scale(1.15); box-shadow: 0 0 0 10px rgba(var(--accent-rgb, 255), var(--accent-grb, 140), var(--accent-brg, 0), 0); } 
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(var(--accent-rgb, 255), var(--accent-grb, 140), var(--accent-brg, 0), 0); } 
        }
        
        .breath-circle.breathing { animation: breathPulse 4s infinite; }

        .hidden { display: none; }
        
        .success-message { 
            background: rgba(var(--success-rgb, 255), var(--success-grb, 215), var(--success-brg, 0), 0.2); 
            border-left: 4px solid var(--success); 
            padding: 15px; 
            border-radius: 8px; 
            color: var(--text); 
            margin: 15px 0; 
            transition: all 0.3s ease;
        }

        .energy-indicator { display: flex; gap: 5px; margin: 10px 0; }
        
        .energy-bar { 
            flex: 1; 
            height: 10px; 
            border-radius: 5px; 
            background: rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.3); 
            cursor: pointer; 
            transition: all 0.3s; 
        }
        
        .energy-bar.active { 
            background: linear-gradient(to right, var(--accent), var(--success)); 
            box-shadow: 0 0 10px rgba(var(--accent-rgb, 255), var(--accent-grb, 140), var(--accent-brg, 0), 0.4); 
        }

        .emotion-log { 
            background: rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.2); 
            padding: 15px; 
            border-radius: 8px; 
            margin: 10px 0; 
            color: var(--text);
            transition: all 0.3s ease;
        }
        
        .info-text { 
            font-size: 0.85em; 
            color: var(--text); 
            margin-top: 10px; 
            padding: 10px; 
            background: rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.2); 
            border-radius: 6px; 
            border-left: 3px solid var(--accent); 
            transition: all 0.3s ease;
        }

        footer { 
            background: transparent; 
            text-align: center; 
            padding: 30px 20px 20px; 
            color: rgba(var(--text-rgb, 232), var(--text-grb, 232), var(--text-brg, 232), 0.5); 
            font-size: 0.75em; 
            line-height: 1.6; 
            margin-top: 20px; 
            transition: color 0.3s ease;
        }
        
        footer a { 
            color: var(--accent); 
            text-decoration: none; 
            transition: color 0.3s; 
        }
        
        footer a:hover { color: var(--success); }

        .routine-item-edit { display: flex; gap: 5px; margin-top: 8px; }
        
        .routine-item-edit input { 
            flex: 1; 
            padding: 6px; 
            border: 1px solid var(--accent); 
            border-radius: 4px; 
            font-size: 0.9em; 
            background: rgba(var(--primary-rgb, 26), var(--primary-grb, 0), var(--primary-brg, 51), 0.8);
            color: var(--text);
            transition: all 0.3s ease;
        }
        
        .routine-item-edit button { padding: 4px 8px; font-size: 0.8em; margin: 0; }

        .edit-routine-modal { 
            position: fixed; 
            top: 0; 
            left: 0; 
            right: 0; 
            bottom: 0; 
            background: rgba(0, 0, 0, 0.7); 
            display: none; 
            align-items: center; 
            justify-content: center; 
            z-index: 1000; 
        }
        
        .edit-routine-content { 
            background: linear-gradient(135deg, var(--primary), rgba(45, 0, 82, 0.8)); 
            padding: 30px; 
            border-radius: 15px; 
            max-width: 600px; 
            width: 90%; 
            max-height: 90vh; 
            overflow-y: auto; 
            border: 2px solid var(--accent);
            color: var(--text);
            transition: all 0.3s ease;
        }

        .task-management-section {
            background: linear-gradient(135deg, rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.2), rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.15));
            border: 2px solid var(--accent-light);
            transition: all 0.3s ease;
        }

        .timer-section {
            background: linear-gradient(135deg, rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.2), rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.15));
            border: 2px solid var(--accent-light);
            padding: 20px;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .emotion-section {
            background: linear-gradient(135deg, rgba(var(--primary-rgb, 26), var(--primary-grb, 0), var(--primary-brg, 51), 0.8), rgba(45, 0, 82, 0.8));
            border: 2px solid var(--accent);
            transition: all 0.3s ease;
        }

        .energy-hint {
            font-size: 0.85em;
            color: var(--text);
            opacity: 0.8;
            margin-top: 8px;
            font-style: italic;
            transition: color 0.3s ease;
        }

        .decompose-btn {
            background: linear-gradient(135deg, var(--accent-light), rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.8));
            color: var(--text);
        }

        .decompose-btn:hover {
            box-shadow: 0 5px 20px rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.4);
        }

        /* æ™¨å¤œè¡Œç¨‹å®¹å™¨ */
        .morning-routine-container {
            background: linear-gradient(135deg, var(--morning-accent) 0%, var(--morning-accent-light) 100%);
            color: var(--primary);
            padding: 20px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .morning-routine-container #morningTitle {
            color: #FFFFFF;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }

        .evening-routine-container {
            background: linear-gradient(135deg, var(--evening-accent) 0%, var(--evening-accent-light) 100%);
            color: var(--text);
            padding: 20px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .evening-routine-container #eveningTitle {
            color: #FFFFFF;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }

        /* é…è‰²ä¸€ (è¡åˆº) */
        body.theme-1 .morning-routine-container {
            --morning-accent: #FF8C00;
            --morning-accent-light: #FFB84D;
        }

        body.theme-1 .evening-routine-container {
            --evening-accent: #8A2BE2;
            --evening-accent-light: #5A0BA2;
        }

        
        

        

        /* é…è‰²ä¸‰ (iPhone 17 Pro) */
        body.theme-3 .morning-routine-container {
            --morning-accent: #FF6B00;
            --morning-accent-light: #FF8C33;
            color: #1a1a1a;
        }

        body.theme-3 .morning-routine-container #morningTitle {
            color: #FFFFFF;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }

        body.theme-3 .evening-routine-container {
            --evening-accent: #1a3a4d;
            --evening-accent-light: #1a3a4d;
            color: #FFFFFF;
        }

        body.theme-3 .evening-routine-container #eveningTitle {
            color: #FFFFFF;
        }

        /* é…è‰²å›› (ç”Ÿæ…‹ç¶ ) */
        body.theme-4 .morning-routine-container {
            --morning-accent: #C47A3A;
            --morning-accent-light: #D99A5A;
            color: #1a1a1a;
        }

        body.theme-4 .morning-routine-container #morningTitle {
            color: #FFFFFF;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }

        body.theme-4 .evening-routine-container {
            --evening-accent: #B08D57;
            --evening-accent-light: #8A5A3B;
            color: #FFFFFF;
        }

        body.theme-4 .evening-routine-container #eveningTitle {
            color: #FFFFFF;
        }

        @media (max-width: 600px) {
            body {
                padding-top: 120px;
            }

            .control-panel {
                width: calc(100% - 40px);
                left: 20px;
                right: 20px;
                top: 80px;
                justify-content: center;
                flex-wrap: wrap;
            }

            header h1 { font-size: 1.8em; }
            #timer { font-size: 3em; }
            .section { padding: 20px; }
            footer { font-size: 0.7em; }
        }
    </style>
</head>
<body class="theme-1">
    <!-- Control Panel - å››é…è‰²é¸æ“‡ -->
    <div class="control-panel">
        <button class="control-btn active" id="themeBtn1" onclick="switchTheme(1); event.preventDefault(); return false;" title="è¡åˆºé…è‰²">
            âš¡
        </button>
        
        <button class="control-btn" id="themeBtn3" onclick="switchTheme(3); event.preventDefault(); return false;" title="iPhone 17 Pro é…è‰²">
            ğŸ <span>17 Pro</span>
        </button>
        <button class="control-btn" id="themeBtn4" onclick="switchTheme(4); event.preventDefault(); return false;" title="ç”Ÿæ…‹ç¶ é…è‰²">
            ğŸŒ³
        </button>
        <div class="control-separator"></div>
    </div>

    <!-- Language Toggle - Fixed at top center -->
    <div class="language-toggle">
        <button class="lang-btn active" id="zhBtn" onclick="switchLanguage('zh')">ä¸­æ–‡</button>
        <button class="lang-btn" id="enBtn" onclick="switchLanguage('en')">English</button>
    </div>

    <div class="container">
        
            <h1><i class="fas fa-brain"></i> ADHD Focus Helper Pro Max</h1>
            <p id="appSubtitle" data-zh="åŸºæ–¼CBTçš„ç„¦é»è¨“ç·´ â€¢ ç¿’æ…£é¤Šæˆ â€¢ é€²åº¦è¿½è¹¤" data-en="CBT-based Focus Training â€¢ Habit Building â€¢ Progress Tracking">åŸºæ–¼CBTçš„ç„¦é»è¨“ç·´ â€¢ ç¿’æ…£é¤Šæˆ â€¢ é€²åº¦è¿½è¹¤</p>
            <div class="level-badge"><i class="fas fa-gamepad"></i> <span id="levelDisplay">Lv.1</span> | <span id="xpDisplay">0 XP</span></div>
        </header>

        <!-- Quiz Section -->
        <div id="quiz" class="section">
            <h2><i class="fas fa-clipboard-list"></i> <span id="quizTitle" data-zh="ADHDå¿«é€Ÿè©•ä¼°" data-en="ADHD Quick Assessment">ADHDå¿«é€Ÿè©•ä¼°</span></h2>
            <p id="quizDesc" style="margin-bottom: 20px; color: var(--text);" data-zh="å›ç­”10å€‹å•é¡Œ (1=å¾ä¸, 5=ç¸½æ˜¯)ï¼Œç­è§£ä½ çš„å°ˆæ³¨åŠ›ç‹€æ…‹" data-en="Answer 10 questions (1=Never, 5=Always) to understand your focus status">å›ç­”10å€‹å•é¡Œ (1=å¾ä¸, 5=ç¸½æ˜¯)ï¼Œç­è§£ä½ çš„å°ˆæ³¨åŠ›ç‹€æ…‹</p>
            <div id="questions"></div>
            <button class="btn" id="startQuizBtn" onclick="startQuiz(); event.preventDefault(); return false;"><i class="fas fa-play"></i> <span id="startQuizText" data-zh="é–‹å§‹è©•ä¼°" data-en="Start Assessment">é–‹å§‹è©•ä¼°</span></button>
            <button class="btn btn-success hidden" id="submitQuiz" onclick="generatePlan(); event.preventDefault(); return false;"><i class="fas fa-check"></i> <span id="submitQuizText" data-zh="ç”Ÿæˆå€‹äººè¨ˆåŠƒ" data-en="Generate Personal Plan">ç”Ÿæˆå€‹äººè¨ˆåŠƒ</span></button>
        </div>

        <!-- Plan Section -->
        <div id="plan" class="section hidden">
            <h2><i class="fas fa-target"></i> <span id="planTitle" data-zh="ä½ çš„å€‹äººç„¦é»è¨ˆåŠƒ" data-en="Your Personal Focus Plan">ä½ çš„å€‹äººç„¦é»è¨ˆåŠƒ</span></h2>
            
            <div class="score-card">
                <div id="scoreCardTitle" data-zh="ADHDå‚¾å‘è©•åˆ†" data-en="ADHD Tendency Score">ADHDå‚¾å‘è©•åˆ†</div>
                <div class="number" id="score">--</div>
                <div class="level" id="level" data-zh="è©•ä¼°ä¸­..." data-en="Assessing...">è©•ä¼°ä¸­...</div>
            </div>

            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap;">
                <h3 id="tipsTitle" style="margin: 0;" data-zh="ä»Šæ—¥ç·´ç¿’é‡é»" data-en="Today's Practice Focus">ä»Šæ—¥ç·´ç¿’é‡é»</h3>
                <button class="btn btn-success" onclick="retakeQuiz()" style="margin: 0;"><i class="fas fa-redo"></i> <span id="retakeText" data-zh="é‡æ–°æ¸¬é©—" data-en="Retake Quiz">é‡æ–°æ¸¬é©—</span></button>
            </div>
            <div id="dailyTips"></div>

            <!-- Energy Level & Task Difficulty -->
            <h3 id="energySection" data-zh="è‡ªæˆ‘æª¢æ¸¬ç•¶å‰ç²¾åŠ›æ°´å¹³" data-en="Check Your Current Energy Level">è‡ªæˆ‘æª¢æ¸¬ç•¶å‰ç²¾åŠ›æ°´å¹³</h3>
            <div class="energy-hint" id="energyHint" data-zh="é»é¸ç›®å‰ç‹€æ…‹ç­‰ç´šä»¥å–å¾—å»ºè­°" data-en="Click your current energy level for suggestions">é»é¸ç›®å‰ç‹€æ…‹ç­‰ç´šä»¥å–å¾—å»ºè­°</div>
            <div class="energy-indicator" id="energyLevel"></div>
            <p id="energyNote" style="color: var(--text); font-size: 0.9em; margin-top: 10px;" data-zh="æ ¹æ“šä½ çš„ç²¾åŠ›æ°´å¹³ï¼Œæ¨è–¦ä»¥ä¸‹ä»»å‹™é›£åº¦ï¼š" data-en="Based on your energy level, recommended task difficulty:">æ ¹æ“šä½ çš„ç²¾åŠ›æ°´å¹³ï¼Œæ¨è–¦ä»¥ä¸‹ä»»å‹™é›£åº¦ï¼š</p>
            <div id="taskRecommendation" style="background: rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.2); padding: 15px; border-radius: 8px; margin: 10px 0; border: 2px solid var(--accent-light); color: var(--text);"></div>

            <!-- Morning & Evening Routines -->
            <h3 id="routineSection" data-zh="æ¨è–¦æ¯æ—¥è¡Œç¨‹" data-en="Recommended Daily Schedule">æ¨è–¦æ¯æ—¥è¡Œç¨‹</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;">
                <div class="morning-routine-container">
                    <h4><i class="fas fa-sunrise"></i> <span id="morningTitle" data-zh="æ™¨é–“è¡Œç¨‹" data-en="Morning Schedule">æ™¨é–“è¡Œç¨‹</span> <span id="morningProgress" style="font-size: 0.8em; opacity: 0.8;"></span>
                    <button class="btn btn-small" onclick="openEditRoutine('morning')" style="float: right; margin: 0; background: rgba(0, 0, 0, 0.3); color: inherit; font-size: 0.75em; padding: 4px 8px;"><i class="fas fa-edit"></i> <span class="editBtnText" data-zh="ç·¨è¼¯" data-en="Edit">ç·¨è¼¯</span></button></h4>
                    <div id="morningRoutine"></div>
                </div>
                <div class="evening-routine-container">
                    <h4><i class="fas fa-moon"></i> <span id="eveningTitle" data-zh="æ™šé–“è¡Œç¨‹" data-en="Evening Schedule">æ™šé–“è¡Œç¨‹</span> <span id="eveningProgress" style="font-size: 0.8em; opacity: 0.8;"></span>
                    <button class="btn btn-small" onclick="openEditRoutine('evening')" style="float: right; margin: 0; background: rgba(0, 0, 0, 0.3); color: inherit; font-size: 0.75em; padding: 4px 8px;"><i class="fas fa-edit"></i> <span class="editBtnText" data-zh="ç·¨è¼¯" data-en="Edit">ç·¨è¼¯</span></button></h4>
                    <div id="eveningRoutine"></div>
                </div>
            </div>

            <!-- Edit Routine Modal -->
            <div id="editRoutineModal" class="edit-routine-modal">
                <div class="edit-routine-content">
                    <h2 style="color: var(--accent); margin-bottom: 20px;"><span id="editRoutineTitle">ç·¨è¼¯æ™¨é–“è¡Œç¨‹</span></h2>
                    <div id="editRoutineItems"></div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn btn-success" onclick="saveEditRoutine()" style="flex: 1;"><i class="fas fa-save"></i> <span id="saveRoutineBtn" data-zh="ä¿å­˜" data-en="Save">ä¿å­˜</span></button>
                        <button class="btn" onclick="closeEditRoutine()" style="flex: 1; background: #999;"><i class="fas fa-times"></i> <span id="closeEditBtn" data-zh="å–æ¶ˆ" data-en="Cancel">å–æ¶ˆ</span></button>
                    </div>
                </div>
            </div>

            <!-- CBT Practices -->
            <div class="mindfulness-section" id="cbtSection">
                <h3 style="color: var(--text); display: flex; align-items: center; gap: 10px; margin-top: 0;">
                    <i class="fas fa-spa"></i> <span id="cbtTitle" data-zh="CBTç„¦é»ç·´ç¿’å·¥å…·" data-en="CBT Focus Practice Tools">CBTç„¦é»ç·´ç¿’å·¥å…·</span>
                </h3>
                
                <div style="background: rgba(var(--accent-rgb, 255), var(--accent-grb, 140), var(--accent-brg, 0), 0.2); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <h4 style="color: var(--text); margin-bottom: 10px; margin-top: 0;"><i class="fas fa-wind"></i> <span id="breathTitle" data-zh="æ­£å¿µå‘¼å¸ç·´ç¿’" data-en="Mindfulness Breathing">æ­£å¿µå‘¼å¸ç·´ç¿’</span></h4>
                    <p id="breathDesc" style="font-size: 0.95em; margin-bottom: 10px; color: rgba(232, 232, 232, 0.9);" data-zh="é»æ“Šåœ“åœˆé–‹å§‹å‘¼å¸ç·´ç¿’ï¼Œè·Ÿè‘—è„ˆè¡ç¯€å¥é™ä½ç„¦æ…®ã€‚" data-en="Click the circle to start breathing practice and follow the pulse rhythm to reduce anxiety.">é»æ“Šåœ“åœˆé–‹å§‹å‘¼å¸ç·´ç¿’ï¼Œè·Ÿè‘—è„ˆè¡ç¯€å¥é™ä½ç„¦æ…®ã€‚</p>
                    <div id="breathCircle" class="breath-circle" onclick="startBreathPractice(); event.preventDefault(); return false;">
                        <span id="breathText" data-zh="é»æ“Šé–‹å§‹" data-en="Click to Start">é»æ“Šé–‹å§‹</span>
                    </div>
                </div>

                <div style="background: rgba(var(--accent-rgb, 255), var(--accent-grb, 140), var(--accent-brg, 0), 0.2); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <h4 style="color: var(--text); margin-bottom: 10px; margin-top: 0;"><i class="fas fa-brain"></i> <span id="thoughtTitle" data-zh="èªçŸ¥é‡æ§‹ç·´ç¿’" data-en="Cognitive Restructuring">èªçŸ¥é‡æ§‹ç·´ç¿’</span></h4>
                    <button class="btn" onclick="openThoughtRecord()" style="background: rgba(var(--accent-rgb, 255), var(--accent-grb, 140), var(--accent-brg, 0), 0.9); color: var(--primary); width: 100%;"><i class="fas fa-edit"></i> <span id="thoughtStartBtn" data-zh="é–‹å§‹ç·´ç¿’" data-en="Start Practice">é–‹å§‹ç·´ç¿’</span></button>
                </div>

                <div style="background: rgba(var(--accent-rgb, 255), var(--accent-grb, 140), var(--accent-brg, 0), 0.2); padding: 15px; border-radius: 8px; margin-bottom: 0;">
                    <h4 style="color: var(--text); margin-bottom: 10px; margin-top: 0;"><i class="fas fa-leaf"></i> <span id="groundingTitle" data-zh="5-4-3-2-1æ¥åœ°æŠ€å·§" data-en="5-4-3-2-1 Grounding">5-4-3-2-1æ¥åœ°æŠ€å·§</span></h4>
                    <button class="btn" onclick="startGrounding()" style="background: rgba(var(--accent-rgb, 255), var(--accent-grb, 140), var(--accent-brg, 0), 0.9); color: var(--primary); width: 100%;"><i class="fas fa-play"></i> <span id="groundingStartBtn" data-zh="é–‹å§‹æ¥åœ°" data-en="Start Grounding">é–‹å§‹æ¥åœ°</span></button>
                </div>
            </div>

            <!-- Modals -->
            <div id="thoughtRecordModal" class="hidden" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); display: none; align-items: center; justify-content: center; z-index: 1000;">
                <div style="background: linear-gradient(135deg, var(--primary), rgba(45, 0, 82, 0.8)); padding: 30px; border-radius: 15px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; border: 2px solid var(--accent); color: var(--text);">
                    <h2 style="color: var(--accent); margin-bottom: 20px;" id="thoughtModalTitle" data-zh="èªçŸ¥é‡æ§‹ç·´ç¿’" data-en="Cognitive Restructuring Practice">èªçŸ¥é‡æ§‹ç·´ç¿’</h2>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; font-weight: 500; margin-bottom: 5px; color: var(--text);" id="negativeLabel" data-zh="è² é¢æƒ³æ³•ï¼š" data-en="Negative Thought:">è² é¢æƒ³æ³•ï¼š</label>
                        <textarea id="negativThought" placeholder="ä¾‹å¦‚ï¼šæˆ‘æ°¸é ç„¡æ³•å®Œæˆé€™å€‹ä»»å‹™..." style="width: 100%; padding: 10px; border: 2px solid var(--accent); border-radius: 6px; font-family: inherit; font-size: 1em; background: rgba(var(--primary-rgb, 26), var(--primary-grb, 0), var(--primary-brg, 51), 0.8); color: var(--text);" rows="3"></textarea>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; font-weight: 500; margin-bottom: 5px; color: var(--text);" id="evidenceLabel" data-zh="è­‰æ“šæ”¯æŒé€™å€‹æƒ³æ³•ï¼š" data-en="Evidence supporting this thought:">è­‰æ“šæ”¯æŒé€™å€‹æƒ³æ³•ï¼š</label>
                        <textarea id="evidence" placeholder="åˆ—èˆ‰äº‹å¯¦è­‰æ“š..." style="width: 100%; padding: 10px; border: 2px solid var(--accent); border-radius: 6px; font-family: inherit; font-size: 1em; background: rgba(var(--primary-rgb, 26), var(--primary-grb, 0), var(--primary-brg, 51), 0.8); color: var(--text);" rows="3"></textarea>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; font-weight: 500; margin-bottom: 5px; color: var(--text);" id="realisticLabel" data-zh="æ›´ç¾å¯¦çš„æƒ³æ³•ï¼š" data-en="More realistic thought:">æ›´ç¾å¯¦çš„æƒ³æ³•ï¼š</label>
                        <textarea id="realisticThought" placeholder="ä¾‹å¦‚ï¼šæˆ‘å¯ä»¥åˆ†å°æ­¥é©Ÿå®Œæˆ..." style="width: 100%; padding: 10px; border: 2px solid var(--accent); border-radius: 6px; font-family: inherit; font-size: 1em; background: rgba(var(--primary-rgb, 26), var(--primary-grb, 0), var(--primary-brg, 51), 0.8); color: var(--text);" rows="3"></textarea>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-success" onclick="saveThoughtRecord()" style="flex: 1;"><i class="fas fa-check"></i> <span id="thoughtCompleteBtn" data-zh="ç·´ç¿’å®Œæˆ" data-en="Complete">ç·´ç¿’å®Œæˆ</span></button>
                        <button class="btn" onclick="closeThoughtRecord()" style="flex: 1; background: #999;"><i class="fas fa-times"></i> <span id="closeBtn" data-zh="é—œé–‰" data-en="Close">é—œé–‰</span></button>
                    </div>
                </div>
            </div>

            <div id="groundingModal" class="hidden" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); display: none; align-items: center; justify-content: center; z-index: 1000;">
                <div style="background: linear-gradient(135deg, var(--primary), rgba(45, 0, 82, 0.8)); padding: 30px; border-radius: 15px; max-width: 500px; width: 90%; text-align: center; border: 2px solid var(--accent); color: var(--text);">
                    <h2 style="color: var(--accent); margin-bottom: 20px;"><span id="groundingModalTitle">5-4-3-2-1</span> <span id="groundingModalSubtitle" data-zh="æ¥åœ°æŠ€å·§" data-en="Grounding">æ¥åœ°æŠ€å·§</span></h2>
                    <div id="groundingSteps" style="margin: 20px 0;"></div>
                    <button class="btn" onclick="closeGrounding()" style="width: 100%;"><i class="fas fa-times"></i> <span id="groundingCompleteBtn" data-zh="å®Œæˆç·´ç¿’" data-en="Complete">å®Œæˆç·´ç¿’</span></button>
                </div>
            </div>

            <!-- Task Decomposition & Management -->
            <h3 id="taskSection" data-zh="æ™ºèƒ½ä»»å‹™ç®¡ç†" data-en="Smart Task Management">æ™ºèƒ½ä»»å‹™ç®¡ç†</h3>
            <div class="task-management-section" style="padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                <p id="taskDesc" style="color: var(--text); font-size: 0.95em; margin-bottom: 15px;" data-zh="å°‡å¤§ä»»å‹™è‡ªå‹•åˆ†è§£ï¼Œæˆ–æ‰‹å‹•æ·»åŠ å°æ­¥é©Ÿ" data-en="Automatically break down large tasks or manually add small steps">å°‡å¤§ä»»å‹™è‡ªå‹•åˆ†è§£ï¼Œæˆ–æ‰‹å‹•æ·»åŠ å°æ­¥é©Ÿ</p>
                
                <div class="input-group">
                    <input type="text" id="newTask" style="flex: 1; border-color: var(--accent);">
                    <button class="btn btn-success" onclick="addTask()"><i class="fas fa-plus"></i> <span id="addTaskBtn" data-zh="æ–°å¢" data-en="Add">æ–°å¢</span></button>
                    <button class="btn decompose-btn" onclick="openTaskDecompose()" title="è‡ªå‹•åˆ†è§£ä»»å‹™"><i class="fas fa-sitemap"></i> <span id="decomposeBtn" data-zh="åˆ†è§£" data-en="Decompose">åˆ†è§£</span></button>
                </div>

                <!-- Task Decompose Modal -->
                <div id="decomposeModal" class="hidden" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); display: none; align-items: center; justify-content: center; z-index: 1000;">
                    <div style="background: linear-gradient(135deg, var(--primary), rgba(45, 0, 82, 0.8)); padding: 30px; border-radius: 15px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; border: 2px solid var(--accent); color: var(--text);">
                        <h2 style="color: var(--accent); margin-bottom: 20px;" id="decomposeTitle" data-zh="ä»»å‹™åˆ†è§£è¨­å®š" data-en="Task Decomposition Settings">ä»»å‹™åˆ†è§£è¨­å®š</h2>
                        <p id="decomposeDesc" style="color: var(--text); margin-bottom: 15px;" data-zh="ç·¨è¼¯æ¯å€‹æ­¥é©Ÿçš„å…§å®¹ï¼š" data-en="Edit each step:">ç·¨è¼¯æ¯å€‹æ­¥é©Ÿçš„å…§å®¹ï¼š</p>
                        <div id="decomposeStepsContainer"></div>
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button class="btn btn-success" onclick="confirmTaskDecompose()" style="flex: 1;"><i class="fas fa-check"></i> <span id="confirmDecomposeBtn" data-zh="ç¢ºèªåˆ†è§£" data-en="Confirm">ç¢ºèªåˆ†è§£</span></button>
                            <button class="btn" onclick="closeTaskDecompose()" style="flex: 1; background: #999;"><i class="fas fa-times"></i> <span id="closeDecomposeBtn" data-zh="é—œé–‰" data-en="Close">é—œé–‰</span></button>
                        </div>
                    </div>
                </div>

                <ul class="task-list" id="tasks"></ul>

                <div class="progress-summary" id="progressSummary">
                    <div id="progressLabel" style="font-size: 0.9em; color: var(--text);" data-zh="é€²åº¦" data-en="Progress">é€²åº¦</div>
                    <div class="percentage" id="percentage">0%</div>
                    <div id="progressText" style="color: var(--text); font-size: 0.9em; margin-top: 5px;"></div>
                </div>
            </div>

            <!-- Pomodoro Timer -->
            <h3 id="timerSection" data-zh="ç•ªèŒ„ç„¦é»è¨ˆæ™‚" data-en="Pomodoro Timer">ç•ªèŒ„ç„¦é»è¨ˆæ™‚</h3>
            <div class="timer-section">
                <div style="display: flex; align-items: center; gap: 15px; margin: 20px 0; background: rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.2); padding: 15px; border-radius: 8px; flex-wrap: wrap;">
                    <label style="font-weight: 500; color: var(--text); min-width: 100px;" id="timerLabel" data-zh="è¨ˆæ™‚åˆ†é˜æ•¸ï¼š" data-en="Minutes:">è¨ˆæ™‚åˆ†é˜æ•¸ï¼š</label>
                    <input type="range" id="timerMinutes" min="1" max="60" value="25" step="1" style="flex: 1; cursor: pointer; height: 8px; border-radius: 5px; background: linear-gradient(to right, var(--accent), var(--success)); min-width: 100px;">
                    <span id="timerMinutesDisplay" style="min-width: 50px; text-align: center; font-weight: bold; color: var(--success); font-size: 1.2em;">25</span>
                    <span id="timerMinLabel" style="color: var(--text);" data-zh="åˆ†é˜" data-en="min">åˆ†é˜</span>
                </div>

                <!-- Timer Sound Settings -->
                <div style="background: rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.2); padding: 15px; border-radius: 8px; margin: 15px 0; border: 2px solid var(--accent-light);">
                    <h4 style="margin-bottom: 15px; color: var(--text);"><i class="fas fa-volume-up"></i> <span id="timerSoundTitle" data-zh="è¨ˆæ™‚å™¨é¬§é˜è¨­å®š" data-en="Timer Alarm Settings">è¨ˆæ™‚å™¨é¬§é˜è¨­å®š</span></h4>
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px; flex-wrap: wrap;">
                        <label style="font-weight: 500; color: var(--text);" id="soundToggleLabel" data-zh="é¬§é˜é–‹é—œï¼š" data-en="Sound:">é¬§é˜é–‹é—œï¼š</label>
                        <button class="btn btn-small" id="timerSoundToggle" onclick="toggleTimerSound()" style="margin: 0;">
                            <i class="fas fa-volume-up"></i> <span id="timerSoundStatus" data-zh="é–‹å•Ÿ" data-en="On">é–‹å•Ÿ</span>
                        </button>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px; flex-wrap: wrap;">
                        <label style="font-weight: 500; min-width: 80px; color: var(--text);" id="volumeLabel" data-zh="éŸ³é‡èª¿æ•´ï¼š" data-en="Volume:">éŸ³é‡èª¿æ•´ï¼š</label>
                        <input type="range" id="timerVolume" min="0" max="100" value="50" style="flex: 1; cursor: pointer; min-width: 100px;">
                        <span id="timerVolumeDisplay" style="min-width: 50px; text-align: center; font-weight: bold; color: var(--success);">50%</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px; flex-wrap: wrap;">
                        <label style="font-weight: 500; min-width: 80px; color: var(--text);" id="soundTypeLabel" data-zh="é¬§éˆ´è²éŸ³ï¼š" data-en="Alarm Sound:">é¬§éˆ´è²éŸ³ï¼š</label>
                        <select id="timerSoundType" style="flex: 1; padding: 8px; border: 2px solid var(--accent); border-radius: 6px; min-width: 150px; background: rgba(var(--primary-rgb, 26), var(--primary-grb, 0), var(--primary-brg, 51), 0.8); color: var(--text);">
                        </select>
                        <button class="btn btn-small" onclick="testTimerSound()" style="margin: 0; background: var(--accent-light);"><i class="fas fa-play"></i> <span id="testBtn" data-zh="æ¸¬è©¦" data-en="Test">æ¸¬è©¦</span></button>
                    </div>
                </div>
                
                <div class="timer-display">
                    <div id="timer">25:00</div>
                    <div id="progress"><div class="bar" id="progressBar"><span id="timerPercent">0%</span></div></div>
                    
                    <button class="btn btn-success" id="startTimer" onclick="startTimer()"><i class="fas fa-play"></i> <span id="startTimerBtn" data-zh="é–‹å§‹è¨ˆæ™‚" data-en="Start">é–‹å§‹è¨ˆæ™‚</span></button>
                    <button class="btn btn-danger hidden" id="stopTimer" onclick="stopTimer()"><i class="fas fa-stop"></i> <span id="stopTimerBtn" data-zh="åœæ­¢" data-en="Stop">åœæ­¢</span></button>
                    
                    <div id="timerMessage"></div>
                </div>
            </div>

            <!-- Emotion Tracking -->
            <h3 id="emotionSection" data-zh="æƒ…ç·’è¿½è¹¤æ—¥èªŒ" data-en="Emotion Tracking Log">æƒ…ç·’è¿½è¹¤æ—¥èªŒ</h3>
            <div class="emotion-section" style="padding: 20px; border-radius: 12px; border: 2px solid var(--accent);">
                <div style="display: flex; gap: 10px; margin: 10px 0; justify-content: space-around; flex-wrap: wrap;">
                    <button class="btn btn-small" onclick="logEmotion('ğŸ˜„', 'happy'); event.preventDefault(); return false;"><span style="font-size: 1.5em;">ğŸ˜„</span> <span class="emotionLabel-happy" data-zh="é«˜èˆˆ" data-en="Happy">é«˜èˆˆ</span></button>
                    <button class="btn btn-small" onclick="logEmotion('ğŸ˜', 'calm'); event.preventDefault(); return false;"><span style="font-size: 1.5em;">ğŸ˜</span> <span class="emotionLabel-calm" data-zh="å¹³éœ" data-en="Calm">å¹³éœ</span></button>
                    <button class="btn btn-small" onclick="logEmotion('ğŸ˜', 'sad'); event.preventDefault(); return false;"><span style="font-size: 1.5em;">ğŸ˜</span> <span class="emotionLabel-sad" data-zh="æ²®å–ª" data-en="Sad">æ²®å–ª</span></button>
                    <button class="btn btn-small" onclick="logEmotion('ğŸ˜°', 'anxious'); event.preventDefault(); return false;"><span style="font-size: 1.5em;">ğŸ˜°</span> <span class="emotionLabel-anxious" data-zh="ç„¦æ…®" data-en="Anxious">ç„¦æ…®</span></button>
                </div>
                <div id="emotionLog"></div>
            </div>

            <!-- Daily Streak -->
            <h3 id="streakSection" data-zh="é€£çºŒæ‰“å¡" data-en="Daily Streak">é€£çºŒæ‰“å¡</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="value" id="streak">0</div>
                    <div class="label" id="streakLabel" data-zh="å¤©é€£çºŒä½¿ç”¨" data-en="Days in a Row">å¤©é€£çºŒä½¿ç”¨</div>
                </div>
                <div class="stat-card">
                    <div class="value" id="totalMinutes">0</div>
                    <div class="label" id="minutesLabel" data-zh="å°ˆæ³¨åˆ†é˜" data-en="Focus Minutes">å°ˆæ³¨åˆ†é˜</div>
                </div>
            </div>

            <!-- Quiz History -->
            <h3 id="historySection" data-zh="æ¸¬é©—æ­·å²è¨˜éŒ„" data-en="Quiz History">æ¸¬é©—æ­·å²è¨˜éŒ„</h3>
            <div id="quizHistory" style="background: rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.2); padding: 20px; border-radius: 8px; max-height: 300px; overflow-y: auto; border: 2px solid var(--accent-light); color: var(--text);"></div>

            <!-- Email Report Section -->
            <h3 id="emailSection" data-zh="å‚³é€å ±å‘Šåˆ°Email" data-en="Send Report to Email">å‚³é€å ±å‘Šåˆ°Email</h3>
            <div style="background: rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.2); padding: 20px; border-radius: 8px; margin: 15px 0; border: 2px solid var(--accent-light);">
                <p id="emailDesc" style="color: var(--text); margin-bottom: 15px;" data-zh="å°‡æ‚¨çš„é€²åº¦å ±å‘Šç™¼é€åˆ°é›»å­éƒµä»¶ï¼Œä»¥ä¾¿å‚™ä»½å’Œè¿½è¹¤ã€‚" data-en="Send your progress report to email for backup and tracking.">å°‡æ‚¨çš„é€²åº¦å ±å‘Šç™¼é€åˆ°é›»å­éƒµä»¶ï¼Œä»¥ä¾¿å‚™ä»½å’Œè¿½è¹¤ã€‚</p>
                <div class="input-group">
                    <input type="email" id="userEmail" placeholder="example@email.com" style="flex: 1; border-color: var(--accent);">
                    <button class="btn btn-success" onclick="sendReportToEmail(); event.preventDefault(); return false;" style="margin: 0;"><i class="fas fa-paper-plane"></i> <span id="sendReportBtn" data-zh="ç™¼é€å ±å‘Š" data-en="Send Report">ç™¼é€å ±å‘Š</span></button>
                </div>
                <div id="emailStatus" style="margin-top: 10px; color: var(--text); font-size: 0.9em;"></div>
                <div class="info-text">
                    <i class="fas fa-info-circle"></i> <strong id="importantLabel" data-zh="é‡è¦æç¤ºï¼š" data-en="Important:">é‡è¦æç¤ºï¼š</strong><span id="importantText" data-zh="ç•¶å‰æ‰€æœ‰ç´€éŒ„åªæœƒå„²å­˜åœ¨æ­¤è£ç½®ã€‚å¦‚éœ€åœ¨é›»å­éƒµä»¶ä¿å­˜å ±å‘Šå‰¯æœ¬ï¼Œè«‹è¼¸å…¥æ‚¨çš„éƒµä»¶åœ°å€ä¸¦ç™¼é€å ±å‘Šã€‚ç³»çµ±æœƒè‡ªå‹•é–‹å•Ÿæ‚¨çš„éƒµä»¶æ‡‰ç”¨ç¨‹å¼ï¼Œæ‚¨å¯ä»¥æ‰‹å‹•ç™¼é€æˆ–å°‡å ±å‘Šè¤‡è£½åˆ°å‰ªè²¼æ¿ã€‚" data-en="All records are currently only stored on this device. To save a copy of your report in email, enter your email address and send the report. The system will automatically open your email application where you can send it or copy the report to clipboard.">ç•¶å‰æ‰€æœ‰ç´€éŒ„åªæœƒå„²å­˜åœ¨æ­¤è£ç½®ã€‚å¦‚éœ€åœ¨é›»å­éƒµä»¶ä¿å­˜å ±å‘Šå‰¯æœ¬ï¼Œè«‹è¼¸å…¥æ‚¨çš„éƒµä»¶åœ°å€ä¸¦ç™¼é€å ±å‘Šã€‚ç³»çµ±æœƒè‡ªå‹•é–‹å•Ÿæ‚¨çš„éƒµä»¶æ‡‰ç”¨ç¨‹å¼ï¼Œæ‚¨å¯ä»¥æ‰‹å‹•ç™¼é€æˆ–å°‡å ±å‘Šè¤‡è£½åˆ°å‰ªè²¼æ¿ã€‚</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer id="footerContent">
        <p id="footerText">
            é€™å€‹å·¥å…·æ˜¯ Nelson Hsu ç”¨ vibe coding çš„æ–¹å¼ ç”¨ <i class="fas fa-heart" style="color: var(--accent);"></i> æ“å‡ºä¾†çš„ï¼Œé›†çµäº†ç¶²è·¯ä¸Šæˆæ•ˆä¸éŒ¯çš„ç³»çµ±ä»¥åŠæˆ‘çš„ä¸€äº›æƒ³æ³•ã€‚<br>
            å¦‚æœæœ‰ä»»ä½•å»ºè­°æˆ–æ˜¯æ„Ÿè¬æ­¡è¿ç§è¨Šè·Ÿæˆ‘èªªã€‚æˆ‘çš„IG: <strong>nelson.love.captue</strong>
        </p>
    </footer>

    <!-- Navigation Scroll -->
    <div class="nav-scroll">
        <button class="nav-scroll-btn" onclick="scrollToSection('energySection')">
            <i class="fas fa-battery-three-quarters"></i>
            <span class="nav-scroll-label" data-zh="ç²¾åŠ›æª¢æ¸¬" data-en="Energy Check">ç²¾åŠ›æª¢æ¸¬</span>
        </button>
        <button class="nav-scroll-btn" onclick="scrollToSection('routineSection')">
            <i class="fas fa-calendar-check"></i>
            <span class="nav-scroll-label" data-zh="æ¯æ—¥è¡Œç¨‹" data-en="Schedule">æ¯æ—¥è¡Œç¨‹</span>
        </button>
        <button class="nav-scroll-btn" onclick="scrollToSection('cbtSection')">
            <i class="fas fa-spa"></i>
            <span class="nav-scroll-label" data-zh="å¿ƒç†å·¥å…·" data-en="CBT Tools">å¿ƒç†å·¥å…·</span>
        </button>
        <button class="nav-scroll-btn" onclick="scrollToSection('taskSection')">
            <i class="fas fa-tasks"></i>
            <span class="nav-scroll-label" data-zh="ä»»å‹™ç®¡ç†" data-en="Tasks">ä»»å‹™ç®¡ç†</span>
        </button>
        <button class="nav-scroll-btn" onclick="scrollToSection('timerSection')">
            <i class="fas fa-hourglass-start"></i>
            <span class="nav-scroll-label" data-zh="è¨ˆæ™‚å™¨" data-en="Timer">è¨ˆæ™‚å™¨</span>
        </button>
        <button class="nav-scroll-btn" onclick="scrollToSection('emotionSection')">
            <i class="fas fa-heart"></i>
            <span class="nav-scroll-label" data-zh="æƒ…ç·’è¿½è¹¤" data-en="Emotions">æƒ…ç·’è¿½è¹¤</span>
        </button>
        <button class="nav-scroll-btn" onclick="scrollToSection('streakSection')">
            <i class="fas fa-fire"></i>
            <span class="nav-scroll-label" data-zh="é€£çºŒæ‰“å¡" data-en="Streak">é€£çºŒæ‰“å¡</span>
        </button>
        <button class="nav-scroll-btn" onclick="scrollToSection('historySection')">
            <i class="fas fa-history"></i>
            <span class="nav-scroll-label" data-zh="æ­·å²è¨˜éŒ„" data-en="History">æ­·å²è¨˜éŒ„</span>
        </button>
        <button class="nav-scroll-btn" onclick="scrollToSection('emailSection')">
            <i class="fas fa-envelope"></i>
            <span class="nav-scroll-label" data-zh="ç™¼é€å ±å‘Š" data-en="Report">ç™¼é€å ±å‘Š</span>
        </button>
    </div>

    <script>
        // ===== é…è‰²ç³»çµ± (å››é…è‰²) =====
        let currentTheme = localStorage.getItem('currentTheme') || 'theme-1';
        let currentLanguage = localStorage.getItem('language') || 'zh';

        function switchTheme(themeNum) {
            const body = document.body;
            body.classList.remove('theme-1', 'theme-3', 'theme-4');
            body.classList.add(`theme-${themeNum}`);
            
            currentTheme = `theme-${themeNum}`;
            localStorage.setItem('currentTheme', currentTheme);
            
            document.getElementById('themeBtn1').classList.toggle('active', themeNum === 1);
            document.getElementById('themeBtn3').classList.toggle('active', themeNum === 3);
            document.getElementById('themeBtn4').classList.toggle('active', themeNum === 4);
            
            document.querySelectorAll('[style*="transition"]').forEach(el => {
                el.style.transition = 'all 0.3s ease';
            });
        }

        // ===== èªè¨€ç³»çµ± =====
        const alarmSoundOptions = {
            zh: {
                bell: 'æ¸…è„†éˆ´è² ğŸ””',
                chime: 'æ‚…è€³éŸ³è‰² âœ¨',
                alert: 'è­¦å‘Šè² âš ï¸',
                digital: 'ç§‘æŠ€æ„Ÿ ğŸ¤–'
            },
            en: {
                bell: 'Crisp Bell ğŸ””',
                chime: 'Pleasant Chime âœ¨',
                alert: 'Alert Sound âš ï¸',
                digital: 'Digital Sound ğŸ¤–'
            }
        };

        const emotionTranslations = {
            happy: { zh: 'é«˜èˆˆ', en: 'Happy' },
            calm: { zh: 'å¹³éœ', en: 'Calm' },
            sad: { zh: 'æ²®å–ª', en: 'Sad' },
            anxious: { zh: 'ç„¦æ…®', en: 'Anxious' }
        };

        const taskInputPlaceholders = {
            zh: 'ä¾‹å¦‚ï¼šç·¨è¼¯å½±ç‰‡ç‰‡æ®µ...',
            en: 'Example: Edit video clips...'
        };

        const footerContent = {
            zh: 'é€™å€‹å·¥å…·æ˜¯ Nelson Hsu ç”¨ vibe coding çš„æ–¹å¼ ç”¨ <i class="fas fa-heart" style="color: var(--accent);"></i> æ“å‡ºä¾†çš„ï¼Œé›†çµäº†ç¶²è·¯ä¸Šæˆæ•ˆä¸éŒ¯çš„ç³»çµ±ä»¥åŠæˆ‘çš„ä¸€äº›æƒ³æ³•ã€‚<br>å¦‚æœæœ‰ä»»ä½•å»ºè­°æˆ–æ˜¯æ„Ÿè¬æ­¡è¿ç§è¨Šè·Ÿæˆ‘èªªã€‚æˆ‘çš„IG: <strong>nelson.love.captue</strong>',
            en: 'This tool was whipped up by Nelson Hsu through vibe coding (with lots of <i class="fas fa-heart" style="color: var(--accent);"></i>), mixing together some solid systems I found online with my own ideas. Got feedback or just wanna say thanks? Shoot me a DM! My IG is <strong>nelson.love.captue</strong>'
        };

        const defaultMorningRoutine = [
            { text: { zh: 'èµ·åºŠ', en: 'Wake Up' }, icon: 'â°', hint: { zh: 'è¨­å®šä¸‰å€‹é¬§é˜', en: 'Set 3 alarms' } },
            { text: { zh: 'æ­£å¿µå‘¼å¸', en: 'Breathing' }, icon: 'ğŸ§˜', hint: { zh: '', en: '' } },
            { text: { zh: '30åˆ†é˜ä¸­é«˜å¼·åº¦é‹å‹•', en: '30 min High-Intensity Exercise' }, icon: 'ğŸ’ª', hint: { zh: '', en: '' } },
            { text: { zh: 'æ´—æ¾¡å’Œæ¢³æ´—', en: 'Shower & Groom' }, icon: 'ğŸš¿', hint: { zh: '', en: '' } },
            { text: { zh: 'å¥åº·æ—©é¤', en: 'Breakfast' }, icon: 'ğŸ½ï¸', hint: { zh: '', en: '' } },
            { text: { zh: 'æª¢æŸ¥å„ªå…ˆä»»å‹™', en: 'Check Priorities' }, icon: 'ğŸ“', hint: { zh: '', en: '' } }
        ];

        const defaultEveningRoutine = [
            { text: { zh: 'æ”¾ä¸‹æ‰‹æ©Ÿ', en: 'Put Phone Away' }, icon: 'ğŸ“±', hint: { zh: '', en: '' } },
            { text: { zh: 'æ”¾é¬†å‘¼å¸', en: 'Relax Breathing' }, icon: 'ğŸ§˜', hint: { zh: '', en: '' } },
            { text: { zh: 'æ´—æ¾¡å’Œæ¢³æ´—', en: 'Shower & Groom' }, icon: 'ğŸš¿', hint: { zh: '', en: '' } },
            { text: { zh: 'å¯«ä¸‹æ˜å¤©è¨ˆåŠƒ', en: 'Plan Tomorrow' }, icon: 'ğŸ“”', hint: { zh: '', en: '' } },
            { text: { zh: 'æº–å‚™ç¡çœ ç’°å¢ƒ', en: 'Prepare Sleep' }, icon: 'ğŸ›ï¸', hint: { zh: '', en: '' } },
            { text: { zh: 'æŒ‰æ™‚ç¡çœ ', en: 'Go to Bed' }, icon: 'ğŸ˜´', hint: { zh: '', en: '' } }
        ];

        const assessmentLevels = {
            zh: {
                mild: { title: 'è¼•å¾®å‚¾å‘', advice: 'å¾ˆå¥½ï¼ä½ çš„ADHDå‚¾å‘è¼•å¾®ã€‚é€éæ—¥å¸¸ç¿’æ…£å„ªåŒ–ï¼Œå°ˆæ³¨åŠ›å¯å¿«é€Ÿæ”¹å–„ã€‚' },
                moderate: { title: 'ä¸­ç­‰å‚¾å‘', advice: 'ä¸­ç­‰ç¨‹åº¦ADHDç—‡ç‹€ã€‚çµåˆé‹å‹•ã€å†¥æƒ³èˆ‡çµæ§‹åŒ–è¨ˆåŠƒï¼Œ6é€±å…§å¯è¦‹é¡¯è‘—é€²å±•ã€‚' },
                significant: { title: 'è¼ƒæ˜é¡¯å‚¾å‘', advice: 'è¼ƒæ˜é¡¯ADHDç—‡ç‹€ã€‚å»ºè­°åŒæ™‚é€²è¡Œæœ¬è¨ˆåŠƒèˆ‡å°ˆæ¥­è©•ä¼°ï¼ˆèº«å¿ƒç§‘/ç²¾ç¥ç§‘ï¼‰ã€‚' },
                severe: { title: 'åš´é‡å‚¾å‘', advice: 'ç—‡ç‹€è¼ƒåš´é‡ï¼Œè«‹å„ªå…ˆå°‹æ±‚å°ˆæ¥­é†«ç™‚è©•ä¼°ã€‚æ­¤å·¥å…·å¯ä½œç‚ºè¼”åŠ©ã€‚' }
            },
            en: {
                mild: { title: 'Mild Tendency', advice: 'Great! Your ADHD tendency is mild. Your focus can improve quickly through daily habit optimization.' },
                moderate: { title: 'Moderate Tendency', advice: 'Moderate ADHD symptoms. With exercise, meditation and structured planning, significant progress can be seen in 6 weeks.' },
                significant: { title: 'Significant Tendency', advice: 'Significant ADHD symptoms. It is recommended to combine this program with professional evaluation (psychiatry/psychology).' },
                severe: { title: 'Severe Tendency', advice: 'More severe symptoms. Please prioritize seeking professional medical evaluation. This tool can serve as a supplement.' }
            }
        };

        const dailyTipsData = {
            zh: [
                'åˆ†è§£ä»»å‹™æˆ5-10åˆ†é˜å°æ­¥é©Ÿï¼Œé¿å…éè¼‰ã€‚',
                'æ¯æ—¥ç·´ç¿’æ­£å¿µå‘¼å¸ï¼šå¸4ç§’ã€æ†‹4ç§’ã€å4ç§’ï¼Œé‡è¤‡5æ¬¡ã€‚',
                'è¨­å®šç’°å¢ƒï¼šç§»é™¤æ‰‹æ©Ÿé€šçŸ¥ï¼Œå°ˆæ³¨ç•¶å‰ä»»å‹™ã€‚',
                'æ…¶ç¥å°å‹åˆ©ï¼šå®Œæˆä»»å‹™å¾Œè¨˜éŒ„æˆå°±ã€‚',
                'çµåˆé‹å‹•ï¼šè¨ˆæ™‚å¾Œæ•£æ­¥5åˆ†é˜ã€‚',
                'ç¢ºä¿æ¯æ™š8å°æ™‚é€£çºŒç¡çœ ï¼Œè¦å¾‹ä¸‰é¤ã€‚',
                'æ¯é€±é‹å‹•3-5æ¬¡ï¼Œä¸­ç­‰å¼·åº¦æœ‰æ°§é‹å‹•æœ€æœ‰æ•ˆã€‚'
            ],
            en: [
                'Break tasks into 5-10 minute steps to avoid overload.',
                'Practice mindfulness breathing daily: Inhale for 4 seconds, hold for 4 seconds, exhale for 4 seconds, repeat 5 times.',
                'Set your environment: Remove phone notifications and focus on the current task.',
                'Celebrate small wins: Record achievements after completing tasks.',
                'Combine with exercise: Take a 5-minute walk after timing.',
                'Ensure 8 hours of continuous sleep per night and regular meals.',
                'Exercise 3-5 times per week; moderate intensity aerobic exercise is most effective.'
            ]
        };

        function switchLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('language', lang);
            
            document.getElementById('zhBtn').classList.toggle('active', lang === 'zh');
            document.getElementById('enBtn').classList.toggle('active', lang === 'en');
            
            document.querySelectorAll('[data-zh][data-en]').forEach(el => {
                el.textContent = el.dataset[lang];
            });

            document.querySelectorAll('.editBtnText').forEach(el => {
                el.textContent = el.dataset[lang];
            });

            updateFooterContent();
            updateTaskInputPlaceholder();
            updateSoundTypeOptions();
            updateEmotionButtons();
            updateEnergyRecommendations();
            updateBreathingText();
            updateGroundingSteps();
            
            if (hasCompletedQuiz && lastAssessmentScore > 0) {
                regenerateDailyTips();
            }
            
            if (hasCompletedQuiz) {
                renderQuizHistory();
                renderEmotionLog();
                renderRoutines();
            }
            
            if (document.getElementById('questions').innerHTML) {
                renderQuestions();
            }
        }

        function updateFooterContent() {
            const footerText = document.getElementById('footerText');
            if (footerText) {
                footerText.innerHTML = footerContent[currentLanguage];
            }
        }

        function getText(zhText, enText) {
            return currentLanguage === 'zh' ? zhText : enText;
        }

        function updateTaskInputPlaceholder() {
            const input = document.getElementById('newTask');
            if (input) {
                input.placeholder = taskInputPlaceholders[currentLanguage];
            }
        }

        function updateSoundTypeOptions() {
            const select = document.getElementById('timerSoundType');
            if (select) {
                const currentValue = select.value || timerSoundType;
                select.innerHTML = '';
                const options = alarmSoundOptions[currentLanguage];
                Object.entries(options).forEach(([value, label]) => {
                    const option = document.createElement('option');
                    option.value = value;
                    option.textContent = label;
                    if (value === currentValue || value === timerSoundType) {
                        option.selected = true;
                    }
                    select.appendChild(option);
                });
            }
        }

        function updateEmotionButtons() {
            Object.entries(emotionTranslations).forEach(([emotion, translations]) => {
                const elements = document.querySelectorAll(`.emotionLabel-${emotion}`);
                elements.forEach(el => {
                    el.textContent = translations[currentLanguage];
                });
            });
        }

        function updateEnergyRecommendations() {
            if (currentEnergy) {
                renderEnergyLevel();
            }
        }

        function updateBreathingText() {
            const breathText = document.getElementById('breathText');
            if (breathText && !isBreathing) {
                breathText.textContent = getText('é»æ“Šé–‹å§‹', 'Click to Start');
            }
        }

        function updateGroundingSteps() {
            // æ¥åœ°æ­¥é©Ÿæœƒåœ¨startGrounding()æ™‚é‡æ–°ç”Ÿæˆ
        }

        function regenerateDailyTips() {
            const tipsData = dailyTipsData[currentLanguage];
            const tipCount = Math.min(5, Math.ceil(lastAssessmentScore / 10));
            const selectedTips = tipsData.slice(0, tipCount);
            
            const adviceText = lastAssessmentAdvice;
            document.getElementById('dailyTips').innerHTML = 
                `<div class="success-message"><i class="fas fa-info-circle"></i> ${adviceText}</div>` +
                selectedTips.map(t => 
                    `<div class="tip"><i class="fas fa-star"></i> <div>${t}</div></div>`
                ).join('');
        }

        window.addEventListener('load', () => {
            if (currentTheme === 'theme-3') {
                switchTheme(3);
            } else if (currentTheme === 'theme-4') {
                switchTheme(4);
            } else {
                switchTheme(1);
            }
            
            document.getElementById(currentLanguage === 'zh' ? 'zhBtn' : 'enBtn').classList.add('active');
            document.getElementById(currentLanguage === 'zh' ? 'enBtn' : 'zhBtn').classList.remove('active');
            updateTaskInputPlaceholder();
            updateSoundTypeOptions();
            updateFooterContent();
            triggerLevelBadgeAnimation();
        });

        function triggerLevelBadgeAnimation() {
            const badge = document.querySelector('.level-badge');
            if (badge) {
                badge.style.animation = 'none';
                setTimeout(() => {
                    badge.style.animation = 'levelBadgeEntry 2s cubic-bezier(0.34, 1.56, 0.64, 1)';
                }, 10);
            }
        }

        // ===== ä¾‹è¡Œç¨‹åºç·¨è¼¯åŠŸèƒ½ =====
        let editingRoutineType = '';
        let editingRoutine = [];

        function openEditRoutine(type) {
            editingRoutineType = type;
            const routines = type === 'morning' ? JSON.parse(localStorage.getItem('morningRoutine')) || defaultMorningRoutine : JSON.parse(localStorage.getItem('eveningRoutine')) || defaultEveningRoutine;
            editingRoutine = JSON.parse(JSON.stringify(routines));

            const title = type === 'morning' ? getText('ç·¨è¼¯æ™¨é–“è¡Œç¨‹', 'Edit Morning Schedule') : getText('ç·¨è¼¯æ™šé–“è¡Œç¨‹', 'Edit Evening Schedule');
            document.getElementById('editRoutineTitle').textContent = title;

            const itemsDiv = document.getElementById('editRoutineItems');
            itemsDiv.innerHTML = editingRoutine.map((item, index) => `
                <div style="margin-bottom: 15px; padding: 12px; background: rgba(var(--accent-light-rgb, 138), var(--accent-light-grb, 43), var(--accent-light-brg, 226), 0.2); border-radius: 8px; border: 1px solid var(--accent-light);">
                    <div style="display: flex; gap: 10px; margin-bottom: 8px;">
                        <span style="font-size: 1.5em;">${item.icon}</span>
                        <input type="text" id="routine_item_${index}" value="${item.text[currentLanguage]}" style="flex: 1; padding: 8px; border: 1px solid var(--accent); border-radius: 4px; background: rgba(var(--primary-rgb, 26), var(--primary-grb, 0), var(--primary-brg, 51), 0.8); color: var(--text);" />
                        <button class="btn btn-small btn-danger" onclick="deleteRoutineItem(${index})" style="margin: 0;"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
            `).join('');

            document.getElementById('editRoutineModal').style.display = 'flex';
        }

        function deleteRoutineItem(index) {
            if (confirm(getText('ç¢ºå®šè¦åˆªé™¤é€™é …å—ï¼Ÿ', 'Delete this item?'))) {
                editingRoutine.splice(index, 1);
                openEditRoutine(editingRoutineType);
            }
        }

        function saveEditRoutine() {
            editingRoutine.forEach((item, index) => {
                const inputValue = document.getElementById(`routine_item_${index}`).value;
                item.text[currentLanguage] = inputValue;
            });

            const storageKey = editingRoutineType === 'morning' ? 'morningRoutine' : 'eveningRoutine';
            localStorage.setItem(storageKey, JSON.stringify(editingRoutine));
            
            closeEditRoutine();
            renderRoutines();
            addXP(10, 'âœ… ' + getText('ç·¨è¼¯è¡Œç¨‹', 'Edit Schedule'));
        }

        function closeEditRoutine() {
            document.getElementById('editRoutineModal').style.display = 'none';
        }

        // ===== æ¸¬é©—ç³»çµ± =====
        const questions = [
            { zh: 'æˆ‘ç¶“å¸¸æ‹–å»¶ä»»å‹™ç›´åˆ°æœ€å¾Œä¸€åˆ»ã€‚', en: 'I often procrastinate tasks until the last minute.' },
            { zh: 'æˆ‘é›£ä»¥ç¶­æŒæ³¨æ„åŠ›åœ¨ç„¡è¶£å·¥ä½œä¸Šã€‚', en: 'I have difficulty maintaining focus on boring tasks.' },
            { zh: 'æˆ‘å®¹æ˜“åˆ†å¿ƒæ–¼ç„¡é—œäº‹ç‰©ã€‚', en: 'I am easily distracted by irrelevant things.' },
            { zh: 'æˆ‘å®¹æ˜“å¿˜è¨˜å›è¦†è¨Šæ¯ã€æ”¯ä»˜å¸³å–®æˆ–å®Œæˆé å®šä»»å‹™ã€‚', en: 'I easily forget to reply to messages, pay bills, or complete scheduled tasks.' },
            { zh: 'æˆ‘è¡å‹•è¡Œäº‹è€Œä¸è€ƒæ…®å¾Œæœã€‚', en: 'I act impulsively without considering the consequences.' },
            { zh: 'æˆ‘å®¹æ˜“æ„Ÿåˆ°ä¸è€ç…©æˆ–æŒ«æŠ˜ã€‚', en: 'I easily feel impatient or frustrated.' },
            { zh: 'æˆ‘é›£ä»¥éµå¾ªæŒ‡ç¤ºæˆ–å®Œæˆå¤šæ­¥é©Ÿä»»å‹™ã€‚', en: 'I have difficulty following instructions or completing multi-step tasks.' },
            { zh: 'æˆ‘ç¶“å¸¸ä¸­æ–·ä»–äººæˆ–è¡å‹•èªªè©±ã€‚', en: 'I often interrupt others or speak impulsively.' },
            { zh: 'æˆ‘çš„æƒ…ç·’è®ŠåŒ–å¾ˆå¿«ã€‚', en: 'My emotions change very quickly.' },
            { zh: 'æˆ‘é›£ä»¥çµ„ç¹”æ±è¥¿æˆ–ç®¡ç†æ™‚é–“ã€‚', en: 'I have difficulty organizing things or managing time.' }
        ];

        let score = 0;
        let answers = [];
        let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        let stats = JSON.parse(localStorage.getItem('stats')) || { streak: 0, totalSessions: 0, totalMinutes: 0, lastDate: null, level: 1, xp: 0 };
        let quizHistory = JSON.parse(localStorage.getItem('quizHistory')) || [];
        let emotionHistory = JSON.parse(localStorage.getItem('emotionHistory')) || [];
        let routineCompletedToday = JSON.parse(localStorage.getItem('routineCompletedToday')) || { morning: false, evening: false, date: new Date().toDateString() };
        let currentEnergy = 3;
        let timerInterval;
        let timerDuration = 25 * 60;
        let timeLeft = 25 * 60;
        let isRunning = false;
        let isBreathing = false;
        let hasCompletedQuiz = localStorage.getItem('hasCompletedQuiz') === 'true';
        let timerSoundEnabled = localStorage.getItem('timerSoundEnabled') !== 'false';
        let timerVolume = parseInt(localStorage.getItem('timerVolume')) || 50;
        let timerSoundType = localStorage.getItem('timerSoundType') || 'bell';
        let lastAssessmentScore = 0;
        let lastAssessmentLevel = '';
        let lastAssessmentAdvice = '';
        let lastAssessmentTips = [];
        let audioContext;

        function renderQuestions() {
            const qDiv = document.getElementById('questions');
            qDiv.innerHTML = '';
            
            questions.forEach((q, i) => {
                const groupDiv = document.createElement('div');
                groupDiv.className = 'question-group';
                
                const label = document.createElement('label');
                label.textContent = `${i + 1}. ${q[currentLanguage]}`;
                
                const sliderContainer = document.createElement('div');
                sliderContainer.style.cssText = 'display: flex; align-items: center; gap: 10px; margin-top: 10px;';
                
                const sliderInput = document.createElement('input');
                sliderInput.type = 'range';
                sliderInput.id = `q${i}`;
                sliderInput.min = '1';
                sliderInput.max = '5';
                sliderInput.value = '3';
                sliderInput.style.cssText = 'flex: 1; cursor: pointer; height: 8px; border-radius: 5px; background: linear-gradient(to right, var(--accent-light), var(--accent));';
                
                const valueDisplay = document.createElement('span');
                valueDisplay.id = `val${i}`;
                valueDisplay.textContent = '3';
                valueDisplay.style.cssText = 'min-width: 40px; text-align: center; font-weight: bold; color: var(--success); font-size: 1.2em;';
                
                const labels = currentLanguage === 'zh' 
                    ? ['å¾ä¸', 'å°‘æœ‰', 'æœ‰æ™‚', 'ç¶“å¸¸', 'ç¸½æ˜¯']
                    : ['Never', 'Rarely', 'Sometimes', 'Often', 'Always'];
                const labelDisplay = document.createElement('span');
                labelDisplay.id = `label${i}`;
                labelDisplay.textContent = labels[2];
                labelDisplay.style.cssText = 'min-width: 60px; text-align: left; font-size: 0.9em; color: var(--text);';
                
                sliderInput.addEventListener('input', (e) => {
                    const val = e.target.value;
                    valueDisplay.textContent = val;
                    labelDisplay.textContent = labels[val - 1];
                });
                
                sliderContainer.appendChild(sliderInput);
                sliderContainer.appendChild(valueDisplay);
                sliderContainer.appendChild(labelDisplay);
                
                groupDiv.appendChild(label);
                groupDiv.appendChild(sliderContainer);
                qDiv.appendChild(groupDiv);
            });
        }

        function startQuiz() {
            renderQuestions();
            document.querySelector('#quiz .btn').style.display = 'none';
            document.getElementById('submitQuiz').classList.remove('hidden');
        }

        function retakeQuiz() {
            document.getElementById('quiz').classList.remove('hidden');
            document.getElementById('plan').classList.add('hidden');
            startQuiz();
        }

        function generatePlan() {
            answers = [];
            let allAnswered = true;
            
            for (let i = 0; i < 10; i++) {
                const slider = document.getElementById(`q${i}`);
                if (!slider) {
                    allAnswered = false;
                    break;
                }
                const value = parseInt(slider.value) || 3;
                answers.push(value);
            }
            
            if (!allAnswered || answers.length !== 10) {
                alert(getText('è«‹å…ˆå›ç­”æ‰€æœ‰10å€‹å•é¡Œï¼', 'Please answer all 10 questions first!'));
                return;
            }
            
            score = answers.reduce((a, b) => a + b, 0);
            lastAssessmentScore = score;

            const testRecord = {
                date: new Date().toLocaleString('zh-TW'),
                score: score
            };
            quizHistory.push(testRecord);
            localStorage.setItem('quizHistory', JSON.stringify(quizHistory));
            localStorage.setItem('hasCompletedQuiz', 'true');
            hasCompletedQuiz = true;

            document.getElementById('quiz').classList.add('hidden');
            document.getElementById('plan').classList.remove('hidden');

            let level, advice;
            if (score < 15) {
                level = assessmentLevels[currentLanguage].mild.title;
                advice = assessmentLevels[currentLanguage].mild.advice;
            } else if (score < 25) {
                level = assessmentLevels[currentLanguage].moderate.title;
                advice = assessmentLevels[currentLanguage].moderate.advice;
            } else if (score < 35) {
                level = assessmentLevels[currentLanguage].significant.title;
                advice = assessmentLevels[currentLanguage].significant.advice;
            } else {
                level = assessmentLevels[currentLanguage].severe.title;
                advice = assessmentLevels[currentLanguage].severe.advice;
            }

            lastAssessmentLevel = level;
            lastAssessmentAdvice = advice;

            document.getElementById('score').textContent = score + '/50';
            document.getElementById('level').textContent = level;

            const tips = dailyTipsData[currentLanguage];
            const tipCount = Math.min(5, Math.ceil(score / 10));
            const selectedTips = tips.slice(0, tipCount);
            lastAssessmentTips = selectedTips;

            document.getElementById('dailyTips').innerHTML = 
                `<div class="success-message"><i class="fas fa-info-circle"></i> ${advice}</div>` +
                selectedTips.map(t => 
                    `<div class="tip"><i class="fas fa-star"></i> <div>${t}</div></div>`
                ).join('');

            addXP(50, 'ğŸ“‹ ' + getText('å®Œæˆæ¸¬é©—', 'Complete Quiz'));
            updateStats();
            renderQuizHistory();
            renderEnergyLevel();
            renderRoutines();
            loadTasks();
            updateProgress();
        }

        function renderEnergyLevel() {
            const energyDiv = document.getElementById('energyLevel');
            let html = '';
            for (let i = 1; i <= 5; i++) {
                html += `<div class="energy-bar ${i <= currentEnergy ? 'active' : ''}" onclick="setEnergy(${i})" title="é»æ“Šè¨­å®šç²¾åŠ›æ°´å¹³"></div>`;
            }
            energyDiv.innerHTML = html;

            const recommendations = {
                1: currentLanguage === 'zh' ? 'ğŸ”´ ä½èƒ½é‡ â†’ ç°¡å–®ä»»å‹™ï¼šæª¢æŸ¥éƒµä»¶ã€æ•´ç†æ¡Œå­ã€å–æ°´ä¼‘æ¯' : 'ğŸ”´ Low â†’ Simple: Check email, organize desk, drink water',
                2: currentLanguage === 'zh' ? 'ğŸŸ  ç•¥ä½èƒ½é‡ â†’ ä¸­ç­‰ä»»å‹™ï¼šå›è¦†è¨Šæ¯ã€æ•´ç†æ–‡ä»¶ã€ç°¡å–®ç·¨è¼¯' : 'ğŸŸ  Low-Medium â†’ Moderate: Reply to messages, organize files, simple editing',
                3: currentLanguage === 'zh' ? 'ğŸŸ¡ ä¸­ç­‰èƒ½é‡ â†’ å¸¸è¦ä»»å‹™ï¼šå¤§å¤šæ•¸å·¥ä½œã€éŒ„éŸ³ã€å…§å®¹ç­–åŠƒ' : 'ğŸŸ¡ Medium â†’ Regular: Most work, recording, content planning',
                4: currentLanguage === 'zh' ? 'ğŸŸ¢ é«˜èƒ½é‡ â†’ å›°é›£ä»»å‹™ï¼šå‰µæ„é …ç›®ã€è¤‡é›œç·¨è¼¯ã€é‡è¦æœƒè­°' : 'ğŸŸ¢ High â†’ Challenging: Creative projects, complex editing, important meetings',
                5: currentLanguage === 'zh' ? 'ğŸŸ¢ è¶…é«˜èƒ½é‡ â†’ æŒ‘æˆ°ä»»å‹™ï¼šå…¨å¤©æ‹æ”ã€è¤‡é›œè£½ä½œã€å‰µæ„çªç ´' : 'ğŸŸ¢ Very High â†’ Demanding: All-day shoots, complex production, creative breakthroughs'
            };
            
            const energyTasks = {
                1: currentLanguage === 'zh' 
                    ? ['âœ… å–ä¸€æ¯å’–å•¡æˆ–èŒ¶', 'âœ… åš5åˆ†é˜ä¼¸å±•é‹å‹•', 'âœ… è½å–œæ­¡çš„æ­Œæ›²']
                    : ['âœ… Have a cup of coffee or tea', 'âœ… Do 5 minutes of stretching', 'âœ… Listen to your favorite song'],
                2: currentLanguage === 'zh'
                    ? ['âœ… æ•£æ­¥5åˆ†é˜', 'âœ… åšç°¡å–®çš„æ–‡æ›¸å·¥ä½œ', 'âœ… å›è¦†ç°¡çŸ­è¨Šæ¯']
                    : ['âœ… Take a 5-minute walk', 'âœ… Do simple paperwork', 'âœ… Reply to short messages'],
                3: currentLanguage === 'zh'
                    ? ['âœ… å®Œæˆæ—¥å¸¸å·¥ä½œ', 'âœ… é€²è¡Œä¸­ç­‰è¤‡é›œåº¦ä»»å‹™', 'âœ… åƒåŠ æœƒè­°']
                    : ['âœ… Complete daily work', 'âœ… Tackle moderate complexity tasks', 'âœ… Attend meetings'],
                4: currentLanguage === 'zh'
                    ? ['âœ… é–‹å§‹å‰µæ„é …ç›®', 'âœ… é€²è¡Œæ·±åº¦å·¥ä½œ', 'âœ… å­¸ç¿’æ–°æŠ€èƒ½']
                    : ['âœ… Start creative projects', 'âœ… Do deep work', 'âœ… Learn new skills'],
                5: currentLanguage === 'zh'
                    ? ['âœ… å•Ÿå‹•é‡å¤§é …ç›®', 'âœ… è§£æ±ºè¤‡é›œå•é¡Œ', 'âœ… é€²è¡Œé•·æ™‚é–“è£½ä½œ']
                    : ['âœ… Launch major projects', 'âœ… Solve complex problems', 'âœ… Do long production sessions']
            };

            const recommendation = recommendations[currentEnergy];
            const suggestedTasks = energyTasks[currentEnergy].join(' | ');
            document.getElementById('taskRecommendation').innerHTML = `
                <div style="margin-bottom: 10px;"><strong>${recommendation}</strong></div>
                <div style="font-size: 0.9em; color: var(--text);">${suggestedTasks}</div>
            `;
        }

        function setEnergy(level) {
            currentEnergy = level;
            localStorage.setItem('currentEnergy', level);
            renderEnergyLevel();
            addXP(5, 'âš¡ ' + getText('è¨­å®šç²¾åŠ›æ°´å¹³', 'Set Energy Level'));
        }

        function renderRoutines() {
            const morningRoutines = JSON.parse(localStorage.getItem('morningRoutine')) || defaultMorningRoutine;
            const eveningRoutines = JSON.parse(localStorage.getItem('eveningRoutine')) || defaultEveningRoutine;

            const today = new Date().toDateString();
            if (routineCompletedToday.date !== today) {
                routineCompletedToday = { morning: false, evening: false, steps: {}, date: today };
            }

            let morningCompleted = 0;
            document.getElementById('morningRoutine').innerHTML = morningRoutines.map((r, i) => {
                const stepKey = `morning_${i}`;
                const isCompleted = routineCompletedToday.steps && routineCompletedToday.steps[stepKey];
                if (isCompleted) morningCompleted++;
                return `
                <div style="margin: 8px 0; padding: 12px; background: rgba(255, 255, 255, ${isCompleted ? '0.2' : '0.1'}); border-radius: 4px; display: flex; justify-content: space-between; align-items: center; opacity: ${isCompleted ? '0.7' : '1'};">
                    <div>
                        <div style="font-weight: bold; ${isCompleted ? 'text-decoration: line-through;' : ''}">${r.icon} ${r.text[currentLanguage]}</div>
                        ${r.hint[currentLanguage] ? `<div style="font-size: 0.85em; opacity: 0.8;">${r.hint[currentLanguage]}</div>` : ''}
                    </div>
                    <button class="btn btn-small" onclick="completeRoutineStep('morning', ${i})" style="background: rgba(255, 255, 255, 0.3); color: inherit; margin: 0;"><i class="fas ${isCompleted ? 'fa-check-circle' : 'fa-circle'}"></i></button>
                </div>
            `}).join('');
            document.getElementById('morningProgress').textContent = `(${morningCompleted}/${morningRoutines.length})`;

            let eveningCompleted = 0;
            document.getElementById('eveningRoutine').innerHTML = eveningRoutines.map((r, i) => {
                const stepKey = `evening_${i}`;
                const isCompleted = routineCompletedToday.steps && routineCompletedToday.steps[stepKey];
                if (isCompleted) eveningCompleted++;
                return `
                <div style="margin: 8px 0; padding: 12px; background: rgba(255, 255, 255, ${isCompleted ? '0.2' : '0.1'}); border-radius: 4px; display: flex; justify-content: space-between; align-items: center; opacity: ${isCompleted ? '0.7' : '1'};">
                    <div>
                        <div style="font-weight: bold; ${isCompleted ? 'text-decoration: line-through;' : ''}">${r.icon} ${r.text[currentLanguage]}</div>
                        ${r.hint[currentLanguage] ? `<div style="font-size: 0.85em; opacity: 0.8;">${r.hint[currentLanguage]}</div>` : ''}
                    </div>
                    <button class="btn btn-small" onclick="completeRoutineStep('evening', ${i})" style="background: rgba(255, 255, 255, 0.3); color: inherit; margin: 0;"><i class="fas ${isCompleted ? 'fa-check-circle' : 'fa-circle'}"></i></button>
                </div>
            `}).join('');
            document.getElementById('eveningProgress').textContent = `(${eveningCompleted}/${eveningRoutines.length})`;
        }

        function completeRoutineStep(type, index) {
            const today = new Date().toDateString();
            if (routineCompletedToday.date !== today) {
                routineCompletedToday = { morning: false, evening: false, steps: {}, date: today };
            }

            const stepKey = `${type}_${index}`;
            if (!routineCompletedToday.steps) {
                routineCompletedToday.steps = {};
            }

            if (!routineCompletedToday.steps[stepKey]) {
                routineCompletedToday.steps[stepKey] = true;
                addXP(10, 'âœ… ' + getText('å®Œæˆè¡Œç¨‹æ­¥é©Ÿ', 'Complete Schedule Step'));
            } else {
                routineCompletedToday.steps[stepKey] = false;
            }

            renderRoutines();
            localStorage.setItem('routineCompletedToday', JSON.stringify(routineCompletedToday));
        }

        function addTask() {
            const input = document.getElementById('newTask');
            if (input.value.trim()) {
                tasks.push({ text: input.value, completed: false, date: new Date().toDateString() });
                input.value = '';
                saveTasks();
                renderTasks();
                updateProgress();
            }
        }

        function deleteTask(index) {
            tasks.splice(index, 1);
            saveTasks();
            renderTasks();
            updateProgress();
        }

        function toggleTask(index) {
            tasks[index].completed = !tasks[index].completed;
            saveTasks();
            renderTasks();
            updateProgress();
            if (tasks[index].completed) {
                addXP(50, 'âœ… ' + getText('å®Œæˆä»»å‹™', 'Complete Task'));
                showLevelUpAnimation();
            }
        }

        function renderTasks() {
            const ul = document.getElementById('tasks');
            if (tasks.length === 0) {
                ul.innerHTML = `<li style="text-align: center; color: var(--text); border: none; opacity: 0.6; list-style: none;">${getText('é‚„æœªæ–°å¢ä»»å‹™ï¼Œé–‹å§‹åŠ å…¥ç¬¬ä¸€å€‹å§ï¼', 'No tasks yet. Add your first one!')}</li>`;
                return;
            }
            ul.innerHTML = tasks.map((task, i) => {
                const doneText = getText('å®Œæˆ', 'Done');
                const undoText = getText('å–æ¶ˆ', 'Undo');
                return `<li class="task-item ${task.completed ? 'completed' : ''}">
                    <span><i class="fas ${task.completed ? 'fa-check-circle' : 'fa-circle'}"></i> ${task.text}</span>
                    <div class="task-actions">
                        <button class="btn btn-small ${task.completed ? 'btn-danger' : 'btn-success'}" onclick="toggleTask(${i})">
                            ${task.completed ? undoText : doneText}
                        </button>
                        <button class="btn btn-small btn-danger" onclick="deleteTask(${i})"><i class="fas fa-trash"></i></button>
                    </div>
                </li>`
            }).join('');
        }

        function saveTasks() {
            localStorage.setItem('tasks', JSON.stringify(tasks));
        }

        function loadTasks() {
            renderTasks();
        }

        function updateProgress() {
            const completed = tasks.filter(t => t.completed).length;
            const total = tasks.length || 1;
            const percentage = Math.round(completed / total * 100);
            
            document.getElementById('percentage').textContent = percentage + '%';
            const label = getText('ä»»å‹™å®Œæˆ', 'tasks completed');
            document.getElementById('progressText').textContent = `${completed} / ${total} ${label}`;
        }

        function openTaskDecompose() {
            const taskInput = document.getElementById('newTask').value;
            if (!taskInput) {
                alert(getText('è«‹å…ˆè¼¸å…¥ä¸€å€‹ä»»å‹™ï¼', 'Please enter a task first!'));
                return;
            }

            const defaultSteps = [
                `${taskInput} - ${getText('ç¬¬1æ­¥ï¼šæº–å‚™å·¥ä½œ', 'Step 1: Preparation')}`,
                `${taskInput} - ${getText('ç¬¬2æ­¥ï¼šä¸»è¦å…§å®¹', 'Step 2: Main Content')}`,
                `${taskInput} - ${getText('ç¬¬3æ­¥ï¼šæª¢æŸ¥å’Œèª¿æ•´', 'Step 3: Review & Adjust')}`,
                `${taskInput} - ${getText('ç¬¬4æ­¥ï¼šå®Œæˆå’Œä¿å­˜', 'Step 4: Complete & Save')}`
            ];

            const container = document.getElementById('decomposeStepsContainer');
            container.innerHTML = defaultSteps.map((step, i) => `
                <div style="margin-bottom: 15px;">
                    <label style="display: block; font-weight: 500; margin-bottom: 5px; color: var(--text);">${getText('æ­¥é©Ÿ', 'Step')} ${i + 1}ï¼š</label>
                    <input type="text" id="decompose_step_${i}" value="${step}" style="width: 100%; padding: 10px; border: 2px solid var(--accent); border-radius: 6px; font-size: 1em; background: rgba(var(--primary-rgb, 26), var(--primary-grb, 0), var(--primary-brg, 51), 0.8); color: var(--text);" />
                </div>
            `).join('');

            window.decomposeSteps = defaultSteps;
            document.getElementById('decomposeModal').style.display = 'flex';
        }

        function confirmTaskDecompose() {
            const steps = [];
            for (let i = 0; i < 4; i++) {
                const input = document.getElementById(`decompose_step_${i}`);
                if (input) {
                    steps.push(input.value || window.decomposeSteps[i]);
                }
            }

            steps.forEach(step => {
                tasks.push({ text: step, completed: false, date: new Date().toDateString() });
            });

            saveTasks();
            renderTasks();
            updateProgress();
            document.getElementById('newTask').value = '';
            closeTaskDecompose();
            alert(getText('âœ… ä»»å‹™å·²åˆ†è§£ç‚º4å€‹å°æ­¥é©Ÿï¼', 'âœ… Task decomposed into 4 steps!'));
        }

        function closeTaskDecompose() {
            document.getElementById('decomposeModal').style.display = 'none';
        }

        function startTimer() {
            if (!isRunning) {
                isRunning = true;
                document.getElementById('startTimer').classList.add('hidden');
                document.getElementById('stopTimer').classList.remove('hidden');
                timerInterval = setInterval(updateTimer, 1000);
            }
        }

        function stopTimer() {
            isRunning = false;
            clearInterval(timerInterval);
            document.getElementById('startTimer').classList.remove('hidden');
            document.getElementById('stopTimer').classList.add('hidden');
            timeLeft = timerDuration;
            updateTimerDisplay();
            document.getElementById('timerMessage').innerHTML = '';
        }

        function updateTimer() {
            timeLeft--;
            updateTimerDisplay();

            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                isRunning = false;
                document.getElementById('startTimer').classList.remove('hidden');
                document.getElementById('stopTimer').classList.add('hidden');
                
                stats.totalSessions++;
                stats.totalMinutes += Math.floor(timerDuration / 60);
                updateStats();

                if (timerSoundEnabled) {
                    playSound(timerSoundType, timerVolume);
                }

                const mins = Math.floor(timerDuration / 60);
                const message = getText(
                    `<div class="success-message"><i class="fas fa-check-circle"></i> ${mins}åˆ†é˜è¨ˆæ™‚å®Œæˆï¼åšå¾—å¾ˆå¥½ï¼</div>`,
                    `<div class="success-message"><i class="fas fa-check-circle"></i> ${mins} minutes completed! Great job!</div>`
                );
                document.getElementById('timerMessage').innerHTML = message;
                
                timeLeft = timerDuration;
                updateTimerDisplay();
            }
        }

        function updateTimerDisplay() {
            const min = Math.floor(timeLeft / 60);
            const sec = timeLeft % 60;
            document.getElementById('timer').textContent = `${min}:${sec.toString().padStart(2, '0')}`;
            
            const percentComplete = Math.round(((timerDuration - timeLeft) / timerDuration) * 100);
            document.getElementById('progressBar').style.width = percentComplete + '%';
            document.getElementById('timerPercent').textContent = percentComplete + '%';
        }

        function startBreathPractice() {
            if (!isBreathing) {
                isBreathing = true;
                const breathCircle = document.getElementById('breathCircle');
                const breathText = document.getElementById('breathText');
                
                breathCircle.classList.add('breathing');
                
                let cycleCount = 0;
                const maxCycles = 4;
                
                const phases = [
                    { text: getText('å¸æ°£...', 'Inhale...'), duration: 4 },
                    { text: getText('å±ä½...', 'Hold...'), duration: 4 },
                    { text: getText('åæ°£...', 'Exhale...'), duration: 4 },
                    { text: getText('æš«åœ...', 'Pause...'), duration: 4 }
                ];
                
                let currentPhase = 0;
                
                const updatePhase = () => {
                    if (cycleCount >= maxCycles) {
                        breathText.textContent = getText('ç·´ç¿’å®Œæˆï¼âœ…', 'Complete! âœ…');
                        breathCircle.classList.remove('breathing');
                        isBreathing = false;
                        addXP(25, 'ğŸ§˜ ' + getText('å®Œæˆå‘¼å¸ç·´ç¿’', 'Complete Breathing'));
                        return;
                    }
                    
                    const phase = phases[currentPhase];
                    breathText.textContent = phase.text;
                    
                    currentPhase++;
                    if (currentPhase >= phases.length) {
                        currentPhase = 0;
                        cycleCount++;
                    }
                    
                    setTimeout(updatePhase, phase.duration * 1000);
                };
                
                updatePhase();
            }
        }

        function openThoughtRecord() {
            document.getElementById('thoughtRecordModal').style.display = 'flex';
        }

        function closeThoughtRecord() {
            document.getElementById('thoughtRecordModal').style.display = 'none';
        }

        function saveThoughtRecord() {
            const negative = document.getElementById('negativThought').value;
            const evidence = document.getElementById('evidence').value;
            const realistic = document.getElementById('realisticThought').value;
            
            if (!negative || !evidence || !realistic) {
                alert(getText('è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½ï¼', 'Please fill in all fields!'));
                return;
            }

            document.getElementById('negativThought').value = '';
            document.getElementById('evidence').value = '';
            document.getElementById('realisticThought').value = '';
            closeThoughtRecord();
            addXP(30, 'ğŸ§  ' + getText('å®ŒæˆèªçŸ¥é‡æ§‹', 'Complete Cognitive'));
        }

        function startGrounding() {
            document.getElementById('groundingModal').style.display = 'flex';
            const steps = [
                { title: getText('çœ‹5æ¨£æ±è¥¿', 'See 5 Things'), icon: 'ğŸ‘€', instruction: getText('å‘¨åœæœ‰ä»€éº¼ä½ èƒ½çœ‹åˆ°çš„ï¼Ÿ', 'What can you see around you?') },
                { title: getText('è½4æ¨£è²éŸ³', 'Hear 4 Sounds'), icon: 'ğŸ‘‚', instruction: getText('ä½ èƒ½è½åˆ°ä»€éº¼è²éŸ³ï¼Ÿ', 'What sounds can you hear?') },
                { title: getText('è§¸æ‘¸3æ¨£ç‰©å“', 'Touch 3 Objects'), icon: 'âœ‹', instruction: getText('æ‘¸æ‘¸å‘¨åœçš„ç‰©å“ï¼Œæ„Ÿå—å®ƒå€‘çš„è³ªåœ°', 'Touch objects around you and feel their texture') },
                { title: getText('è2æ¨£æ°£å‘³', 'Smell 2 Things'), icon: 'ğŸ‘ƒ', instruction: getText('ä½ èƒ½èåˆ°ä»€éº¼æ°£å‘³ï¼Ÿ', 'What can you smell?') },
                { title: getText('åš1æ¨£å‘³é“', 'Taste 1 Thing'), icon: 'ğŸ‘…', instruction: getText('å–å£æ°´æˆ–åƒé»æ±è¥¿', 'Drink water or eat something') }
            ];

            let currentStep = 0;
            const stepsDiv = document.getElementById('groundingSteps');
            
            function showStep() {
                if (currentStep < steps.length) {
                    const step = steps[currentStep];
                    stepsDiv.innerHTML = `
                        <div style="font-size: 3em; margin-bottom: 10px;">${step.icon}</div>
                        <h3 style="color: var(--text); margin-bottom: 10px;">${step.title}</h3>
                        <p style="font-size: 1.1em; margin-bottom: 20px; color: var(--text);">${step.instruction}</p>
                        <button class="btn btn-success" onclick="nextGroundingStep()" style="width: 100%;">${getText('ä¸‹ä¸€æ­¥', 'Next')}</button>
                    `;
                    currentStep++;
                } else {
                    stepsDiv.innerHTML = `
                        <div style="font-size: 2em; margin-bottom: 20px;">âœ…</div>
                        <h3 style="color: var(--success);">${getText('æ¥åœ°å®Œæˆï¼', 'Complete!')}</h3>
                        <p style="color: var(--text);">${getText('ä½ ç¾åœ¨æ‡‰è©²æ„Ÿåˆ°æ›´åŠ æ”¾é¬†å’Œå°ˆæ³¨ã€‚', 'You should feel more relaxed and focused now.')}</p>
                    `;
                    addXP(35, 'ğŸŒ¿ ' + getText('å®Œæˆæ¥åœ°æŠ€å·§', 'Complete Grounding'));
                }
            }
            
            window.nextGroundingStep = showStep;
            showStep();
        }

        function closeGrounding() {
            document.getElementById('groundingModal').style.display = 'none';
        }

        function logEmotion(emoji, emotionKey) {
            const emotion = emotionTranslations[emotionKey][currentLanguage];
            const record = {
                time: new Date().toLocaleString('zh-TW'),
                emotion: emotion,
                emoji: emoji
            };
            emotionHistory.push(record);
            localStorage.setItem('emotionHistory', JSON.stringify(emotionHistory));
            renderEmotionLog();
            addXP(15, 'ğŸ“Š ' + getText('è¨˜éŒ„æƒ…ç·’', 'Log Emotion'));
        }

        function renderEmotionLog() {
            const logDiv = document.getElementById('emotionLog');
            if (emotionHistory.length === 0) {
                logDiv.innerHTML = `<p style="color: var(--text); opacity: 0.6;">${getText('å°šç„¡æƒ…ç·’è¨˜éŒ„', 'No emotion records')}</p>`;
                return;
            }
            const recent = emotionHistory.slice(-5);
            logDiv.innerHTML = recent.map((record, idx) => {
                const actualIndex = emotionHistory.length - 5 + idx;
                return `<div class="emotion-log" style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="flex: 1;">
                        <span style="font-size: 1.5em; margin-right: 10px;">${record.emoji}</span>
                        <strong style="color: var(--text);">${record.emotion}</strong> - <span style="color: var(--text); opacity: 0.7;">${record.time}</span>
                    </div>
                    <div style="display: flex; gap: 5px;">
                        <button class="btn btn-small btn-danger" onclick="deleteEmotion(${actualIndex})" style="padding: 4px 8px; margin: 0;"><i class="fas fa-trash"></i></button>
                    </div>
                </div>`;
            }).join('');
        }

        function deleteEmotion(index) {
            if (confirm(getText('ç¢ºå®šè¦åˆªé™¤é€™æ¢æƒ…ç·’è¨˜éŒ„å—ï¼Ÿ', 'Delete this record?'))) {
                emotionHistory.splice(index, 1);
                localStorage.setItem('emotionHistory', JSON.stringify(emotionHistory));
                renderEmotionLog();
            }
        }

        function updateStats() {
            const today = new Date().toDateString();
            if (stats.lastDate !== today) {
                stats.streak = (stats.lastDate === new Date(Date.now() - 86400000).toDateString()) ? stats.streak + 1 : 1;
                stats.lastDate = today;
            }
            
            document.getElementById('streak').textContent = stats.streak;
            document.getElementById('totalMinutes').textContent = stats.totalMinutes;
            
            if (document.getElementById('levelDisplay')) {
                document.getElementById('levelDisplay').textContent = `Lv.${stats.level}`;
                document.getElementById('xpDisplay').textContent = `${stats.xp} XP`;
            }
            
            localStorage.setItem('stats', JSON.stringify(stats));
        }

        function addXP(amount, reason) {
            stats.xp += amount;
            const xpPerLevel = 500;
            
            while (stats.xp >= xpPerLevel) {
                stats.xp -= xpPerLevel;
                stats.level++;
                showLevelUpAnimation();
                playLevelUpSound();
            }
            
            updateStats();
        }

        function showLevelUpAnimation() {
            const div = document.createElement('div');
            div.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, var(--accent), var(--success));
                color: var(--primary);
                padding: 40px;
                border-radius: 15px;
                font-size: 2em;
                font-weight: bold;
                z-index: 10000;
                text-align: center;
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            `;
            div.innerHTML = `ğŸ‰ ${getText('å‡ç´šåˆ°', 'Level Up to')} Lv.${stats.level}ï¼`;
            document.body.appendChild(div);
            
            setTimeout(() => div.remove(), 2000);
        }

        function playLevelUpSound() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }

            const ctx = audioContext;
            const gainNode = ctx.createGain();
            gainNode.gain.value = 0.3;
            gainNode.connect(ctx.destination);

            const freqs = [523.25, 659.25, 783.99];
            const now = ctx.currentTime;

            freqs.forEach((freq, i) => {
                const osc = ctx.createOscillator();
                osc.frequency.value = freq;
                osc.connect(gainNode);
                osc.start(now + i * 0.15);
                osc.stop(now + i * 0.15 + 0.2);
            });
        }

        function renderQuizHistory() {
            const historyDiv = document.getElementById('quizHistory');
            if (quizHistory.length === 0) {
                historyDiv.innerHTML = `<p style="text-align: center; color: var(--text); opacity: 0.6;">${getText('æš«ç„¡æ¸¬é©—è¨˜éŒ„', 'No quiz records')}</p>`;
                return;
            }

            historyDiv.innerHTML = quizHistory.map((record, idx) => {
                let level;
                if (currentLanguage === 'zh') {
                    level = record.score < 15 ? 'è¼•å¾®å‚¾å‘' : record.score < 25 ? 'ä¸­ç­‰å‚¾å‘' : record.score < 35 ? 'è¼ƒæ˜é¡¯å‚¾å‘' : 'åš´é‡å‚¾å‘';
                } else {
                    level = record.score < 15 ? 'Mild' : record.score < 25 ? 'Moderate' : record.score < 35 ? 'Significant' : 'Severe';
                }

                const scoreLabel = getText('åˆ†æ•¸', 'Score');
                return `
                    <div style="background: rgba(var(--accent-rgb, 255), var(--accent-grb, 140), var(--accent-brg, 0), 0.2); padding: 12px; margin-bottom: 10px; border-radius: 6px; border-left: 4px solid var(--accent); display: flex; justify-content: space-between; align-items: center;">
                        <div style="flex: 1;">
                            <strong style="color: var(--text);">${record.date}</strong>
                            <div style="color: var(--text); font-size: 0.9em; opacity: 0.8;">${scoreLabel}: ${record.score}/50 - ${level}</div>
                        </div>
                        <button class="btn btn-small btn-danger" onclick="deleteQuizRecord(${idx})" style="margin: 0;"><i class="fas fa-trash"></i></button>
                    </div>
                `;
            }).join('');
        }

        function deleteQuizRecord(index) {
            if (confirm(getText('ç¢ºå®šè¦åˆªé™¤é€™ç­†æ¸¬é©—è¨˜éŒ„å—ï¼Ÿ', 'Delete this record?'))) {
                quizHistory.splice(index, 1);
                localStorage.setItem('quizHistory', JSON.stringify(quizHistory));
                renderQuizHistory();
            }
        }

        function sendReportToEmail() {
            const userEmail = document.getElementById('userEmail').value.trim();
            const emailStatus = document.getElementById('emailStatus');
            
            if (!userEmail || !userEmail.includes('@')) {
                emailStatus.innerHTML = `<span style="color: var(--accent);"><i class="fas fa-times"></i> ${getText('è«‹è¼¸å…¥æœ‰æ•ˆçš„ Email åœ°å€', 'Please enter a valid email')}</span>`;
                return;
            }

            const completedTasks = tasks.filter(t => t.completed).length;
            const totalTasks = tasks.length;
            const taskProgress = totalTasks > 0 ? Math.round(completedTasks / totalTasks * 100) : 0;
            
            const report = {
                timestamp: new Date().toLocaleString('zh-TW'),
                email: userEmail,
                userStats: {
                    level: stats.level,
                    xp: stats.xp,
                    streak: stats.streak,
                    totalMinutes: stats.totalMinutes
                },
                tasks: {
                    completed: completedTasks,
                    total: totalTasks,
                    percentage: taskProgress,
                    list: tasks.map(t => ({ text: t.text, completed: t.completed }))
                },
                emotions: emotionHistory.slice(-10),
                quizHistory: quizHistory,
                currentEnergy: currentEnergy
            };

            const reportText = currentLanguage === 'zh' ? `ADHD Focus Helper Pro Max - é€²åº¦å ±å‘Š
==============================
ç”Ÿæˆæ™‚é–“: ${report.timestamp}
Email: ${userEmail}

ã€ä½¿ç”¨è€…çµ±è¨ˆã€‘
ç­‰ç´š: Lv.${report.userStats.level}
ç¶“é©—å€¼ (XP): ${report.userStats.xp}
é€£çºŒä½¿ç”¨å¤©æ•¸: ${report.userStats.streak}
å°ˆæ³¨ç¸½åˆ†é˜æ•¸: ${report.userStats.totalMinutes}

ã€ä»»å‹™é€²åº¦ã€‘
å®Œæˆ: ${report.tasks.completed}/${report.tasks.total} (${report.tasks.percentage}%)
${report.tasks.list.map(t => `- ${t.completed ? 'âœ…' : 'â­•'} ${t.text}`).join('\n')}

ã€æœ€è¿‘æƒ…ç·’è¨˜éŒ„ã€‘
${report.emotions.length > 0 ? report.emotions.map(e => `${e.emoji} ${e.emotion} (${e.time})`).join('\n') : 'æš«ç„¡è¨˜éŒ„'}

ã€æ¸¬é©—æ­·å²ã€‘
${report.quizHistory.length > 0 ? report.quizHistory.map(h => `${h.date} - åˆ†æ•¸: ${h.score}/50`).join('\n') : 'æš«ç„¡è¨˜éŒ„'}

ã€ç•¶å‰ç²¾åŠ›æ°´å¹³ã€‘
${['ğŸ”´ ä½', 'ğŸŸ  ç•¥ä½', 'ğŸŸ¡ ä¸­ç­‰', 'ğŸŸ¢ é«˜', 'ğŸŸ¢ è¶…é«˜'][report.currentEnergy - 1]} (${report.currentEnergy}/5)` : `ADHD Focus Helper Pro Max - Progress Report
==============================
Generated: ${report.timestamp}
Email: ${userEmail}

ã€User Statisticsã€‘
Level: Lv.${report.userStats.level}
Experience (XP): ${report.userStats.xp}
Consecutive Days: ${report.userStats.streak}
Total Focus Minutes: ${report.userStats.totalMinutes}

ã€Task Progressã€‘
Completed: ${report.tasks.completed}/${report.tasks.total} (${report.tasks.percentage}%)
${report.tasks.list.map(t => `- ${t.completed ? 'âœ…' : 'â­•'} ${t.text}`).join('\n')}

ã€Recent Emotionsã€‘
${report.emotions.length > 0 ? report.emotions.map(e => `${e.emoji} ${e.emotion} (${e.time})`).join('\n') : 'No records'}

ã€Quiz Historyã€‘
${report.quizHistory.length > 0 ? report.quizHistory.map(h => `${h.date} - Score: ${h.score}/50`).join('\n') : 'No records'}

ã€Current Energy Levelã€‘
${['ğŸ”´ Low', 'ğŸŸ  Low-Medium', 'ğŸŸ¡ Medium', 'ğŸŸ¢ High', 'ğŸŸ¢ Very High'][report.currentEnergy - 1]} (${report.currentEnergy}/5)`;

            const subject = encodeURIComponent(`ADHD Focus Helper Pro Max - ${getText('é€²åº¦å ±å‘Š', 'Progress Report')} ${new Date().toLocaleDateString('zh-TW')}`);
            const body = encodeURIComponent(reportText);
            const mailtoLink = `mailto:${userEmail}?subject=${subject}&body=${body}`;
            
            navigator.clipboard.writeText(reportText).then(() => {
                emailStatus.innerHTML = `<span style="color: var(--success);"><i class="fas fa-check"></i> ${getText('å ±å‘Šå·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼æ­£åœ¨é–‹å•Ÿéƒµä»¶æ‡‰ç”¨ç¨‹å¼...', 'Report copied! Opening email...')}</span>`;
                
                setTimeout(() => {
                    window.location.href = mailtoLink;
                }, 800);
                
                setTimeout(() => {
                    emailStatus.innerHTML = `<span style="color: var(--success);"><i class="fas fa-check"></i> ${getText('å ±å‘Šå·²ç”Ÿæˆï¼è«‹åœ¨éƒµä»¶ä¸­ç²˜è²¼æˆ–æ‰‹å‹•ç™¼é€ã€‚', 'Report generated! Paste or send in email.')}</span>`;
                    document.getElementById('userEmail').value = '';
                }, 2000);
            }).catch(() => {
                emailStatus.innerHTML = `<span style="color: var(--accent);"><i class="fas fa-info-circle"></i> ${getText('ç„¡æ³•è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼Œè«‹æ‰‹å‹•è¤‡è£½ä¸‹æ–¹å…§å®¹', 'Cannot copy to clipboard. Please copy manually.')}</span>`;
                alert(reportText);
                document.getElementById('userEmail').value = '';
            });
        }

        document.getElementById('timerMinutes')?.addEventListener('input', (e) => {
            const minutes = parseInt(e.target.value);
            document.getElementById('timerMinutesDisplay').textContent = minutes;
            timerDuration = minutes * 60;
            timeLeft = timerDuration;
            updateTimerDisplay();
        });

        function initializeApp() {
            currentEnergy = parseInt(localStorage.getItem('currentEnergy')) || 3;
            if (hasCompletedQuiz) {
                document.getElementById('quiz').classList.add('hidden');
                document.getElementById('plan').classList.remove('hidden');
                loadTasks();
                updateProgress();
                renderQuizHistory();
                renderEnergyLevel();
                renderRoutines();
                renderEmotionLog();
                updateStats();
            }
        }

        if (!stats.level) {
            stats.level = 1;
            stats.xp = 0;
        }

        function scrollToSection(sectionId) {
            const element = document.getElementById(sectionId);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        function playSound(type, volume) {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }

            const ctx = audioContext;
            const gainNode = ctx.createGain();
            gainNode.gain.value = volume / 100;
            gainNode.connect(ctx.destination);

            const duration = 0.5;
            const now = ctx.currentTime;

            if (type === 'bell') {
                const osc1 = ctx.createOscillator();
                const osc2 = ctx.createOscillator();
                osc1.frequency.value = 800;
                osc2.frequency.value = 600;
                osc1.connect(gainNode);
                osc2.connect(gainNode);
                osc1.start(now);
                osc2.start(now);
                osc1.stop(now + duration);
                osc2.stop(now + duration);
            } else if (type === 'chime') {
                const osc = ctx.createOscillator();
                osc.frequency.setValueAtTime(1000, now);
                osc.frequency.exponentialRampToValueAtTime(400, now + duration);
                osc.connect(gainNode);
                osc.start(now);
                osc.stop(now + duration);
            } else if (type === 'alert') {
                const osc = ctx.createOscillator();
                osc.frequency.setValueAtTime(700, now);
                osc.frequency.setValueAtTime(900, now + duration / 2);
                osc.frequency.setValueAtTime(700, now + duration);
                osc.connect(gainNode);
                osc.start(now);
                osc.stop(now + duration);
            } else if (type === 'digital') {
                const osc = ctx.createOscillator();
                osc.frequency.setValueAtTime(1200, now);
                osc.frequency.setValueAtTime(1000, now + duration / 3);
                osc.frequency.setValueAtTime(1200, now + 2 * duration / 3);
                osc.connect(gainNode);
                osc.start(now);
                osc.stop(now + duration);
            }
        }

        function testTimerSound() {
            if (timerSoundEnabled) {
                playSound(timerSoundType, timerVolume);
            }
        }

        function toggleTimerSound() {
            timerSoundEnabled = !timerSoundEnabled;
            localStorage.setItem('timerSoundEnabled', timerSoundEnabled);
            const btn = document.getElementById('timerSoundToggle');
            const status = document.getElementById('timerSoundStatus');
            if (timerSoundEnabled) {
                btn.style.background = 'linear-gradient(135deg, var(--success), rgba(var(--success-rgb, 255), var(--success-grb, 215), var(--success-brg, 0), 0.9))';
                status.textContent = getText('é–‹å•Ÿ', 'On');
            } else {
                btn.style.background = '#999';
                status.textContent = getText('é—œé–‰', 'Off');
            }
        }

        function initializeSoundSettings() {
            document.getElementById('timerVolume')?.addEventListener('input', (e) => {
                timerVolume = parseInt(e.target.value);
                document.getElementById('timerVolumeDisplay').textContent = timerVolume + '%';
                localStorage.setItem('timerVolume', timerVolume);
            });

            document.getElementById('timerSoundType')?.addEventListener('change', (e) => {
                timerSoundType = e.target.value;
                localStorage.setItem('timerSoundType', timerSoundType);
            });

            if (timerSoundEnabled) {
                document.getElementById('timerSoundToggle').style.background = 'linear-gradient(135deg, var(--success), rgba(var(--success-rgb, 255), var(--success-grb, 215), var(--success-brg, 0), 0.9))';
            } else {
                document.getElementById('timerSoundToggle').style.background = '#999';
            }
        }

        updateStats();
        initializeApp();
        initializeSoundSettings();
    </script>
</body>
</html>
